{"version":2,"kind":"Notebook","sha256":"88ab12786bedbe8fe7f803596bbfb072bd4f12c6db5d084aacc130c8115d21c8","slug":"math.reductions.montgomery-reduction","location":"/math/reductions/montgomery_reduction.ipynb","dependencies":[],"frontmatter":{"title":"Understanding Montgomery Reduction","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/executablebooks/jupyter-book/blob/main/math/reductions/montgomery_reduction.ipynb","exports":[{"format":"ipynb","filename":"montgomery_reduction.ipynb","url":"/montgomery_reduction-559b68e8aa3fe5247389824e4f5d1dab.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1. Introduction: The Problem with Modular Division","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X0gEy3q59S"}],"identifier":"id-1-introduction-the-problem-with-modular-division","label":"1. Introduction: The Problem with Modular Division","html_id":"id-1-introduction-the-problem-with-modular-division","implicit":true,"key":"dJa0MNUE0J"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Modular arithmetic often involves computing remainders: for integers ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RRjHt9w7JV"},{"type":"inlineCode","value":"a","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ggmxtkqUi5"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BRZze17Enz"},{"type":"inlineCode","value":"n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FMpkJm1PKj"},{"type":"text","value":", we find ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"nlbsqUVNOf"},{"type":"inlineCode","value":"q","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Trje9HwcyK"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ewMMuJI3xI"},{"type":"inlineCode","value":"r","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"iG7hIzAGe0"},{"type":"text","value":" such that:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"InTpCiYxoH"}],"key":"uMRSXbJRpB"},{"type":"math","value":"a = qn + r,\\quad \\text{where} \\quad 0 \\leq r < |n|","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><mi>q</mi><mi>n</mi><mo>+</mo><mi>r</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>where</mtext><mspace width=\"1em\"/><mn>0</mn><mo>≤</mo><mi>r</mi><mo>&lt;</mo><mi mathvariant=\"normal\">∣</mi><mi>n</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">a = qn + r,\\quad \\text{where} \\quad 0 \\leq r &lt; |n|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">where</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">∣</span></span></span></span></span>","enumerator":"1","key":"FHSGV54BYU"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Here, ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ADYely1160"},{"type":"inlineCode","value":"r = a mod n","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"j7xRRyjeIE"},{"type":"text","value":". While this is straightforward for small numbers, it becomes inefficient at scale, especially in cryptographic computations with large integers.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"vO8NBav9TJ"}],"key":"d1KnZRcygd"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For example, to compute:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"QWZdHJWp6r"}],"key":"pWoh87AuME"},{"type":"math","value":"(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>12</mn><mo>×</mo><mn>15</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo>=</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><mn>15</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mo stretchy=\"false\">(</mo><mn>5</mn><mo>×</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">12</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">15</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">((</span><span class=\"mord\">12</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">15</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">))</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span></span>","enumerator":"2","key":"pJwdouGHDJ"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"We still need to perform ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Qfs2khOoiN"},{"type":"inlineCode","value":"mod","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"DjUA1QRRmR"},{"type":"text","value":" operations (i.e., division), which are costly for large numbers. Since cryptographic systems rely heavily on modular multiplication, this repeated division becomes a bottleneck.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"cvTVK4ekyA"}],"key":"AQW0EeGZTR"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Montgomery reduction","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ARXtoey4D7"}],"key":"Qg0pVtJqlc"},{"type":"text","value":" addresses this by avoiding direct division, making modular multiplication more efficient for large integers.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"AwoqszDLyu"}],"key":"bZwzwVeto8"}],"key":"a9tHKW7oFe"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. The Core Idea: A New Domain for Faster Math","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FS6TfNgBXD"}],"identifier":"id-2-the-core-idea-a-new-domain-for-faster-math","label":"2. The Core Idea: A New Domain for Faster Math","html_id":"id-2-the-core-idea-a-new-domain-for-faster-math","implicit":true,"key":"u9WzlI3nRp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery reduction speeds up modular arithmetic by moving calculations into a special ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uDyegu2nor"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery domain","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VD55Nk1J7p"}],"key":"IWuFSFeLlF"},{"type":"text","value":", avoiding costly division by ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AFASCsxTAC"},{"type":"inlineCode","value":"n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UozlfvdFX0"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mvA4WRnx4G"}],"key":"sqaRqVezXN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This is done using a new modulus ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YaRsDbz5RW"},{"type":"inlineCode","value":"R","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NhZP7shgFd"},{"type":"text","value":", typically a power of 2 (like  ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZGtU6r21L7"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"quoPLUAGWa"},{"type":"superscript","children":[{"type":"text","value":"32","key":"rFuLXVHvEr"}],"key":"dbO4a68zes"}],"key":"ytIXr3s4Vw"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TJzdHzJLHW"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"yP3LWPUhcj"},{"type":"superscript","children":[{"type":"text","value":"64","key":"J4XAfCoBg0"}],"key":"d70swF8CEc"}],"key":"AkbdAwFvsb"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hbQAyQbFOd"}],"key":"bdu2eYPboc"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Why Use a Power of 2?","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JLmB6plxMu"}],"identifier":"why-use-a-power-of-2","label":"Why Use a Power of 2?","html_id":"why-use-a-power-of-2","implicit":true,"key":"Sw1AyRkjFD"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Because computers handle powers of 2 efficiently:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"xVvsDb3HMO"}],"key":"iCTeUHr8HM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Division by ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"zpWBoqQn84"},{"type":"inlineCode","value":"R","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"YGi1TItUSV"}],"key":"EhR5mGM7WV"},{"type":"text","value":" → simple ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gQaQVdB2wa"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"right shift","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gbWXHcTeyK"}],"key":"cPMzMRx5IH"}],"key":"K3xWWOQ5Kc"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Modulo ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"QvzU61nQ9Q"},{"type":"inlineCode","value":"R","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"psjyBxmMf2"}],"key":"dPTbAIYoEj"},{"type":"text","value":" → fast ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"g1ATNUgdYs"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"bitwise AND","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"VVIGLWHBuU"}],"key":"DeDLrn8mKR"}],"key":"YMrrRY1SCr"}],"key":"rXyCzYmMS0"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"This makes reductions much faster than regular division.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"KzB4jeNbQc"}],"key":"Ta8wAMcmOH"}],"key":"GRn14jZfdH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. The Montgomery Algorithm: Setup and Multiplication","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MdKN3KwIcM"}],"identifier":"id-3-the-montgomery-algorithm-setup-and-multiplication","label":"3. The Montgomery Algorithm: Setup and Multiplication","html_id":"id-3-the-montgomery-algorithm-setup-and-multiplication","implicit":true,"key":"OhULlC6t71"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tQwsGzVwGh"},{"type":"inlineCode","value":"R","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w4uEVsEJaQ"},{"type":"text","value":" as a power of 2, we set up the Montgomery system through a one-time preparation:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vosbRQ9D9L"}],"key":"o55kUUHULc"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Setup Phase","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"t35r1BoUva"}],"identifier":"setup-phase","label":"Setup Phase","html_id":"setup-phase","implicit":true,"key":"wHrcq6Qu5h"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Choose ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xn4JtnFkTh"},{"type":"inlineCode","value":"R","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ze4pmKRzOJ"}],"key":"pfoyebN8jR"},{"type":"text","value":":","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lMT0hXDY7A"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dK0lRPD7Uq"},{"type":"text","value":"A power of 2 greater than ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hTbptbzHTV"},{"type":"inlineCode","value":"n","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uvi2sSu74p"},{"type":"text","value":", enabling fast bitwise operations.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"skg6KdVqZR"}],"key":"u0D5bRgBT9"}],"key":"jzsqRTYVJY"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qvPZ2fxriC"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"dXGd10Qfxy"}],"key":"xow1287EKh"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"S3c3PZHGxx"},{"type":"break","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"C81S7sJuUw"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"H97h9BpkTk"},{"type":"inlineCode","value":"R","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"CJHoJInGWl"},{"type":"text","value":" such that:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"MYoskD5Bga"}],"key":"ndcp9RLdZq"},{"type":"math","value":"R \\cdot R^{-1} \\equiv 1 \\pmod{n}","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>R</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R \\cdot R^{-1} \\equiv 1 \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"Qp9wOBAA5u"}],"key":"CLMlziHJaZ"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"RHVfzYorgO"},{"type":"inlineCode","value":"n'","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BPubnqwIey"}],"key":"fcdF1C0eAt"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"CA9ID2mUwg"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ZRL3GCmk93"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"WMgTEBg1Kk"},{"type":"inlineCode","value":"-n","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"PI2C5xQcoC"},{"type":"text","value":" modulo ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"FTfUfiwNdN"},{"type":"inlineCode","value":"R","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"TJx4DOLBUN"},{"type":"text","value":", satisfying:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"TdFo9aUyND"}],"key":"zHodPoXwQz"},{"type":"math","value":"-n \\cdot n' \\equiv 1 \\pmod{R}","position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo>−</mo><mi>n</mi><mo>⋅</mo><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">-n \\cdot n&#x27; \\equiv 1 \\pmod{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"4","key":"rThVZ1L8vq"}],"key":"D4yzYdTtj0"}],"key":"JfWTW2BRe1"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"The values ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"yByEQ4R7p4"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"iKvcxdh0R0"},{"type":"text","value":" and ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"jrJbm5Cm7u"},{"type":"inlineCode","value":"n'","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"iqJ4GzPY8e"},{"type":"text","value":" are precomputed once and used in all Montgomery operations.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"tdfDiLrTVO"}],"key":"efiBuhhXXB"}],"key":"mVhXDQu5DE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Conversion to Montgomery Form","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RKAU9WgxeF"}],"identifier":"conversion-to-montgomery-form","label":"Conversion to Montgomery Form","html_id":"conversion-to-montgomery-form","implicit":true,"key":"uTHAHmkLP3"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To work in the Montgomery domain, convert a number ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"leHEI05HFQ"},{"type":"inlineCode","value":"a","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oI2C1TFtIT"},{"type":"text","value":" to its Montgomery form ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"EcqvDetmlJ"},{"type":"inlineCode","value":"a'","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vGzNpMlcp8"},{"type":"text","value":":","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RxcUkjoD4P"}],"key":"ofKqiTZ9tT"},{"type":"math","value":"a' = a \\cdot R \\pmod{n}","position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>a</mi><mo>⋅</mo><mi>R</mi><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a&#x27; = a \\cdot R \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"5","key":"RjYWFUDqS3"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"This step is a one-time, regular modular multiplication—our “entry fee” to faster computation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KtWecNKtPu"}],"key":"SgIFWJisEi"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Multiplication in the Montgomery Domain","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"WfoEQIwxe0"}],"identifier":"multiplication-in-the-montgomery-domain","label":"Multiplication in the Montgomery Domain","html_id":"multiplication-in-the-montgomery-domain","implicit":true,"key":"i3JGXaGd9t"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Given ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"JzLZPuj0ln"},{"type":"inlineCode","value":"a'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"cBGXC7DYWL"},{"type":"text","value":" and ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"HRSU7O6zrQ"},{"type":"inlineCode","value":"b'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"AQ18q11zPo"},{"type":"text","value":" in Montgomery form, their product ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"qsxBdwKPHO"},{"type":"inlineCode","value":"c'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"p3hRUjL8AO"},{"type":"text","value":" is:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"lid4B6by0D"}],"key":"qEbagf4lja"},{"type":"math","value":"c' = a' \\cdot b' \\cdot R^{-1} \\pmod{n}","position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c&#x27; = a&#x27; \\cdot b&#x27; \\cdot R^{-1} \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"6","key":"yOIRci6d6U"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"While this still looks like it needs division by ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Ra4oHZio0c"},{"type":"inlineCode","value":"n","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"kL2GKK6Ghd"},{"type":"text","value":", the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"uovaAfA8hw"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Montgomery Reduction (","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"T0rZcekPQL"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"SXoVRdVDi2"},{"type":"text","value":")","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"RcxiNbpkID"}],"key":"EM7fCdhQMW"},{"type":"text","value":" algorithm efficiently handles this without actual division.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"BrsTOKyk53"}],"key":"fDu5VFwDkh"}],"key":"mKHgMezta3"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. The REDC Algorithm and Final Conversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fFix46bvuQ"}],"identifier":"id-4-the-redc-algorithm-and-final-conversion","label":"4. The REDC Algorithm and Final Conversion","html_id":"id-4-the-redc-algorithm-and-final-conversion","implicit":true,"key":"Nkbb9fPytf"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To compute the Montgomery product","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dxZLqVioU6"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DW9IA3bSsD"},{"type":"inlineCode","value":"c' = a' · b' · R⁻¹ mod(n)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JZQVOCVIRJ"},{"type":"text","value":",","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"C8YoPih5xd"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"qRpnnsKv4U"},{"type":"text","value":"we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uzzESLOYXA"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"REDC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OwDNBWY5jI"}],"key":"CDuMAC153u"},{"type":"text","value":" function, which efficiently calculates","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Mjx5AlMCkp"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DoSHNbfusQ"},{"type":"inlineMath","value":"T \\cdot R^{-1} \\mod n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"0.6667em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">T \\cdot R^{-1} \\mod n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6667em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"KmZhtHF1wa"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"z2PSHrXjxT"},{"type":"text","value":"for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w3ZnWjqrsS"},{"type":"inlineMath","value":"T = a' \\cdot b'","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">T = a&#x27; \\cdot b&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"KV0xBRAtsj"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T38XqFybrx"}],"key":"zTudoK3Zk7"},{"type":"heading","depth":3,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"BmNPZOG4ww"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jNb85n7XXt"},{"type":"text","value":" Algorithm","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"niy9EdgMo1"}],"identifier":"the-redc-algorithm","label":"The REDC Algorithm","html_id":"the-redc-algorithm","implicit":true,"key":"YkKas300uj"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"rtjD8BLXLk"},{"type":"inlineCode","value":"m","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Q1N9zVlHjF"},{"type":"text","value":":","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"KklA9J0zqv"}],"key":"mh9qBllr7l"}],"key":"EYGKZnBQun"},{"type":"math","value":"m = T \\bmod R \\cdot n’ \\bmod R","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>m</mi><mo>=</mo><mi>T</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi><mo>⋅</mo><mi>n</mi><mtext>’</mtext><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">m = T \\bmod R \\cdot n’ \\bmod R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">’</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span></span>","enumerator":"7","key":"UCPJBD4C2M"}],"key":"HT2dwRPvIN"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"PEg2Wn5SJM"},{"type":"inlineCode","value":"t","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"V45izlZmvs"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"qrDL4lfQvt"}],"key":"JxIXzr2i7c"}],"key":"SJPLyssxRQ"},{"type":"math","value":"t = \\frac{T + m \\cdot n}{R}","position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mo>+</mo><mi>m</mi><mo>⋅</mo><mi>n</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">t = \\frac{T + m \\cdot n}{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0463em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"8","key":"uZUoY0xamR"}],"key":"m4PorLs04P"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Final correction:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"uREz8TcxqS"}],"key":"OBO9rSdCYi"}],"key":"swvn9SRunZ"},{"type":"math","value":"\\text{If } t \\geq n, \\quad \\text{then } t = t - n","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>If </mtext><mi>t</mi><mo>≥</mo><mi>n</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>then </mtext><mi>t</mi><mo>=</mo><mi>t</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\text{If } t \\geq n, \\quad \\text{then } t = t - n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.136em;\"></span><span class=\"mord text\"><span class=\"mord\">If </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">then </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>","enumerator":"9","key":"ryfrZBYySV"}],"key":"jIm8HZuX46"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Return ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"SlwJKotcBv"},{"type":"inlineCode","value":"t","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"wgtrIXL5NH"},{"type":"text","value":" as the result.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"SJTkI2luVx"}],"key":"NdJUxRb71P"}],"key":"wZzf5AWolj"}],"key":"izQrhDusRS"}],"key":"GJqnU2pjxr"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"The speed boost comes from dividing by ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"jxhGuMocqt"},{"type":"inlineCode","value":"R","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"THJdSuRWU9"},{"type":"text","value":" (a power of 2), which is just a fast bit shift.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"b0QKO2FQJK"}],"key":"PvnZhh76qH"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Conversion Back to Standard Form","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"AsKpA6gCOy"}],"identifier":"conversion-back-to-standard-form","label":"Conversion Back to Standard Form","html_id":"conversion-back-to-standard-form","implicit":true,"key":"zcrzrWIziM"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"After all operations, the result ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"YBaSSUvyHz"},{"type":"inlineCode","value":"c'","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"bWWlfZ4bYf"},{"type":"text","value":" is still in Montgomery form.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"DjTwn6Rqly"},{"type":"break","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"AFjhkce19W"},{"type":"text","value":"To convert back, apply one last ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"pAJHQ8yM9b"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"MiVvvwIGVv"},{"type":"text","value":":","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"GTPtZW6Gc3"}],"key":"LdGTZqWJf6"},{"type":"math","value":"c = \\text{REDC}(c')","position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>c</mi><mo>=</mo><mtext>REDC</mtext><mo stretchy=\"false\">(</mo><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c = \\text{REDC}(c&#x27;)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">REDC</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"10","key":"hh4iChLVKf"}],"key":"wcPH3HrhHX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0:\n            raise ValueError(\"Modulus n must be odd.\")\n        \n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        \n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0:\n            return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1:\n            raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        \n        if t >= self.n:\n            return t - self.n\n        else:\n            return t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        T = a_mont * b_mont\n        return self._reduce(T), T\n\n# --- Usage Example ---\n# 1. One-time setup\nmonty_system = Montgomery(n=13)\nprint(f\"System Initialized for n={monty_system.n}\")\nprint(f\"Calculated R={monty_system.R}, n'={monty_system.n_prime}\")\nprint(\"-\" * 30)\n\n# 2. Convert numbers to Montgomery form\na = 7\nb = 8\na_mont = monty_system.convert_in(a)\nb_mont = monty_system.convert_in(b)\nprint(f\"{a} in Montgomery form is: {a_mont}\")\nprint(f\"{b} in Montgomery form is: {b_mont}\")\nprint(\"-\" * 30)\n\n# 3. Perform multiplication in the Montgomery domain\nproduct_mont, intermediate_T = monty_system.multiply(a_mont, b_mont)\nprint(f\"Intermediate product T = {a_mont} * {b_mont} = {intermediate_T}\")\nprint(f\"REDC(T) -> Product in Montgomery form: {product_mont}\")\nprint(\"-\" * 30)\n\n# 4. Convert the result back to a standard number\nfinal_result = monty_system.convert_out(product_mont)\nprint(f\"Final Result (after converting back): {final_result}\")\nprint(f\"Standard Check: (7 * 8) % 13 = {(7 * 8) % 13}\")","key":"GG7K81EXnh"},{"type":"output","id":"vkpbUy9z1ojz7JVD6RheD","data":[{"name":"stdout","output_type":"stream","text":"System Initialized for n=13\nCalculated R=16, n'=11\n------------------------------\n7 in Montgomery form is: 8\n8 in Montgomery form is: 11\n------------------------------\nIntermediate product T = 8 * 11 = 88\nREDC(T) -> Product in Montgomery form: 12\n------------------------------\nFinal Result (after converting back): 4\nStandard Check: (7 * 8) % 13 = 4\n"}],"key":"k29Ff6sMzQ"}],"key":"Z5VHjP164u"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sSmajasLoP"}],"identifier":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","label":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","html_id":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","implicit":true,"key":"PldGGCd6yR"},{"type":"blockquote","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Question:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"AHMgR6NIZZ"}],"key":"PUZZYfBn4s"},{"type":"break","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JMJLwdcX1u"},{"type":"text","value":"Montgomery starts with divisions like 112 mod 13 or 128 mod 13, which look slower than a simple 56 mod 13. So why is it still preferred—and actually faster—when working with large numbers?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HMn5A08Pcj"}],"key":"b2NaZYX9PH"}],"key":"l0qXaje2J1"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For a single, small calculation, the setup cost of Montgomery reduction makes it ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JkKMdKzzAU"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"slower","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GVI7aXdvjA"}],"key":"tq5xKuY8Ec"},{"type":"text","value":" than the standard method.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zfeAlVhU5h"}],"key":"H7KaSkNFRj"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The performance boost isn’t for one-off calculations; it’s for ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"j8w75pWD8d"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"chains of multiplications","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"PwHzGXYzRW"}],"key":"pDH8vlTLoP"},{"type":"text","value":" performed with the same modulus, which is extremely common in cryptography. The classic use case is ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"byUu7TrAak"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"modular exponentiation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"xYt9OiOJXH"}],"key":"iCgdaq20Um"},{"type":"text","value":" (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Zr8wmoo1Ne"},{"type":"inlineCode","value":"a^e mod n","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zPQj2c91pg"},{"type":"text","value":"), which is the core of RSA and the example we will explore next.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CVjmXr53V4"}],"key":"AmAPaBqYrb"}],"key":"GYuFVYicvW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Re-using our clean Montgomery class\nclass Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0: raise ValueError(\"Modulus n must be odd.\")\n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0: return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1: raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        return t - self.n if t >= self.n else t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        return self._reduce(a_mont * b_mont)\n\n# --- Method 1: Standard Exponentiation Trace  ---\ndef trace_standard_pow_clean(base, exp, mod):\n    print(\"--- Starting Standard Modular Exponentiation ---\")\n    expensive_ops = 0\n    res = 1\n    binary_exp = bin(exp)[2:]\n    print(f\"Executing for exponent {exp} (binary: {binary_exp})\\n\")\n    \n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res\n        res = (res * res) % mod\n        expensive_ops += 1\n        print(f\"Step {i+1} (Square): ({res_old}*{res_old}) % {mod} -> {res} (EXPENSIVE)\")\n        \n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res\n            res = (res * base) % mod\n            expensive_ops += 1\n            print(f\"Step {i+1} (Mult):   ({res_old}*{base}) % {mod} -> {res} (EXPENSIVE)\")\n            \n    print(f\"\\nFinal Result: {res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Method 2: Montgomery Exponentiation Trace ---\ndef trace_montgomery_pow_clean(base, exp, n):\n    print(\"--- Starting Montgomery Modular Exponentiation ---\")\n    expensive_ops = 0\n    \n    # 1. Setup & Conversion\n    print(\"Step 1: Setup & Initial Conversion\")\n    monty = Montgomery(n)\n    res_mont = monty.convert_in(1)\n    expensive_ops += 1\n    base_mont = monty.convert_in(base)\n    expensive_ops += 1\n    print(f\"  - Converting 1 -> {res_mont} (EXPENSIVE OP #{expensive_ops-1})\")\n    print(f\"  - Converting {base} -> {base_mont} (EXPENSIVE OP #{expensive_ops})\\n\")\n\n    # 2. Main Loop\n    print(\"Step 2: Main loop with FAST operations\")\n    binary_exp = bin(exp)[2:]\n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res_mont\n        res_mont = monty.multiply(res_mont, res_mont)\n        print(f\"Loop {i+1} (Square): REDC({res_old}*{res_old}) -> {res_mont} (FAST)\")\n\n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res_mont\n            res_mont = monty.multiply(res_mont, base_mont)\n            print(f\"Loop {i+1} (Mult):   REDC({res_old}*{base_mont}) -> {res_mont} (FAST)\")\n\n    # 3. Final Conversion\n    final_res = monty.convert_out(res_mont)\n    print(f\"\\nStep 3: Final conversion -> REDC({res_mont}) -> {final_res} (FAST)\")\n    \n    print(f\"\\nFinal Result: {final_res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Run the cleaned traces ---\nbase, exp, mod = 5, 10, 13\ntrace_standard_pow_clean(base, exp, mod)\nprint(\"=\"*50)\ntrace_montgomery_pow_clean(base, exp, mod)","key":"Kv858qGCCs"},{"type":"output","id":"gSiF7BBBZUn6xutkdznvE","data":[{"name":"stdout","output_type":"stream","text":"--- Starting Standard Modular Exponentiation ---\nExecuting for exponent 10 (binary: 1010)\n\nStep 1 (Square): (1*1) % 13 -> 1 (EXPENSIVE)\nStep 1 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 2 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\nStep 3 (Square): (12*12) % 13 -> 1 (EXPENSIVE)\nStep 3 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 4 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 6\n\n==================================================\n--- Starting Montgomery Modular Exponentiation ---\nStep 1: Setup & Initial Conversion\n  - Converting 1 -> 3 (EXPENSIVE OP #1)\n  - Converting 5 -> 2 (EXPENSIVE OP #2)\n\nStep 2: Main loop with FAST operations\nLoop 1 (Square): REDC(3*3) -> 3 (FAST)\nLoop 1 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 2 (Square): REDC(2*2) -> 10 (FAST)\nLoop 3 (Square): REDC(10*10) -> 3 (FAST)\nLoop 3 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 4 (Square): REDC(2*2) -> 10 (FAST)\n\nStep 3: Final conversion -> REDC(10) -> 12 (FAST)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 2\n\n"}],"key":"BkIR2eDMjB"}],"key":"e2aSXqpeY9"}],"key":"dxjHayctEo"},"references":{"cite":{"order":[],"data":{}}}}