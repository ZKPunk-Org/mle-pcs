{"version":2,"kind":"Notebook","sha256":"88ab12786bedbe8fe7f803596bbfb072bd4f12c6db5d084aacc130c8115d21c8","slug":"math.reductions.montgomery-reduction","location":"/math/reductions/montgomery_reduction.ipynb","dependencies":[],"frontmatter":{"title":"Understanding Montgomery Reduction","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/executablebooks/jupyter-book/blob/main/math/reductions/montgomery_reduction.ipynb","exports":[{"format":"ipynb","filename":"montgomery_reduction.ipynb","url":"/montgomery_reduction-559b68e8aa3fe5247389824e4f5d1dab.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1. Introduction: The Problem with Modular Division","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gaGPmvwozG"}],"identifier":"id-1-introduction-the-problem-with-modular-division","label":"1. Introduction: The Problem with Modular Division","html_id":"id-1-introduction-the-problem-with-modular-division","implicit":true,"key":"Y0Gr02WojT"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Modular arithmetic often involves computing remainders: for integers ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EnXi04wfgw"},{"type":"inlineCode","value":"a","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xAhrgLDOi6"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XT44B0YW2F"},{"type":"inlineCode","value":"n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"g9UD0LvMab"},{"type":"text","value":", we find ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"vxjPhqCISx"},{"type":"inlineCode","value":"q","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"weoHjJ5Ms1"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ke95M4JMti"},{"type":"inlineCode","value":"r","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jDGcPXn9v5"},{"type":"text","value":" such that:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"azLnmk5zYl"}],"key":"IZuWGMh1Bb"},{"type":"math","value":"a = qn + r,\\quad \\text{where} \\quad 0 \\leq r < |n|","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><mi>q</mi><mi>n</mi><mo>+</mo><mi>r</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>where</mtext><mspace width=\"1em\"/><mn>0</mn><mo>≤</mo><mi>r</mi><mo>&lt;</mo><mi mathvariant=\"normal\">∣</mi><mi>n</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">a = qn + r,\\quad \\text{where} \\quad 0 \\leq r &lt; |n|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">where</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">∣</span></span></span></span></span>","enumerator":"1","key":"FaajKDzUEf"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Here, ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"daJJWAcGgm"},{"type":"inlineCode","value":"r = a mod n","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"xEm6dKAveo"},{"type":"text","value":". While this is straightforward for small numbers, it becomes inefficient at scale, especially in cryptographic computations with large integers.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"cnjhQe7MJq"}],"key":"qVkrzLsVcU"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For example, to compute:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"UKxE4TIWZn"}],"key":"vkOO3vJfvQ"},{"type":"math","value":"(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>12</mn><mo>×</mo><mn>15</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo>=</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><mn>15</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mo stretchy=\"false\">(</mo><mn>5</mn><mo>×</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">12</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">15</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">((</span><span class=\"mord\">12</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">15</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">))</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span></span>","enumerator":"2","key":"ywGz0GNHco"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"We still need to perform ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"EoWrnctowx"},{"type":"inlineCode","value":"mod","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"gdTEuFsv7B"},{"type":"text","value":" operations (i.e., division), which are costly for large numbers. Since cryptographic systems rely heavily on modular multiplication, this repeated division becomes a bottleneck.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"HE0JDv5XoL"}],"key":"H4CJMrkb3H"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Montgomery reduction","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"FgDadu6Kqw"}],"key":"f8CUcrAN2B"},{"type":"text","value":" addresses this by avoiding direct division, making modular multiplication more efficient for large integers.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"ByMmpXkMWF"}],"key":"qLl3qTz4KM"}],"key":"pzUQjqV1LU"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. The Core Idea: A New Domain for Faster Math","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VxxN2pPzVJ"}],"identifier":"id-2-the-core-idea-a-new-domain-for-faster-math","label":"2. The Core Idea: A New Domain for Faster Math","html_id":"id-2-the-core-idea-a-new-domain-for-faster-math","implicit":true,"key":"WEcjisiLiP"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery reduction speeds up modular arithmetic by moving calculations into a special ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"e459cO73YB"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery domain","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cyPvH0buMo"}],"key":"Fit8jcTNJH"},{"type":"text","value":", avoiding costly division by ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aHdpWB7uUV"},{"type":"inlineCode","value":"n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YKMt4e7BFm"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"AulYy0uJ4w"}],"key":"NG1YjM2PJO"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This is done using a new modulus ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uyidQTP6zz"},{"type":"inlineCode","value":"R","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xw0quaP8mV"},{"type":"text","value":", typically a power of 2 (like  ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qzVdT3QBeX"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"nDxIPXP5uk"},{"type":"superscript","children":[{"type":"text","value":"32","key":"JH2vMBFWmt"}],"key":"ICvWWqAnHN"}],"key":"SwyS6NuUQR"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RUSoKVTgay"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"BcrYKEKOl6"},{"type":"superscript","children":[{"type":"text","value":"64","key":"azKDII9XPz"}],"key":"sNx87BlZgK"}],"key":"gxv25RNNZw"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v4oEWmHa73"}],"key":"lgMTc65yCf"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Why Use a Power of 2?","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"VcTT2HqmEW"}],"identifier":"why-use-a-power-of-2","label":"Why Use a Power of 2?","html_id":"why-use-a-power-of-2","implicit":true,"key":"sgMfMx6EvC"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Because computers handle powers of 2 efficiently:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"smkuMnMMMX"}],"key":"CmDTbZPlts"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Division by ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"hnIGd8KtUw"},{"type":"inlineCode","value":"R","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"zs4IMv4ejs"}],"key":"weItqLIv4f"},{"type":"text","value":" → simple ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"rpZ9qSsDS8"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"right shift","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"NzWCEsqvl8"}],"key":"NilfRWfime"}],"key":"AqyLrlxZsy"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Modulo ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Q6Z0IFbf65"},{"type":"inlineCode","value":"R","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"XyyIgRIPlT"}],"key":"MwILX1cFJ1"},{"type":"text","value":" → fast ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"KspzjsOW4u"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"bitwise AND","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Qj7Wi0ckzd"}],"key":"YQwny6nJQt"}],"key":"ausnlkM2zL"}],"key":"Otn6w8j9yQ"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"This makes reductions much faster than regular division.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"U5afDYm5DG"}],"key":"YHIahH1OiQ"}],"key":"GEze7Rkh1v"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. The Montgomery Algorithm: Setup and Multiplication","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rykGQe80Lm"}],"identifier":"id-3-the-montgomery-algorithm-setup-and-multiplication","label":"3. The Montgomery Algorithm: Setup and Multiplication","html_id":"id-3-the-montgomery-algorithm-setup-and-multiplication","implicit":true,"key":"dOIuSVL4On"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"RLb86jjwef"},{"type":"inlineCode","value":"R","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Xu7wOfydeu"},{"type":"text","value":" as a power of 2, we set up the Montgomery system through a one-time preparation:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yR0rdXn5aN"}],"key":"lmRYjnFpwk"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Setup Phase","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"atZ4WPJfZK"}],"identifier":"setup-phase","label":"Setup Phase","html_id":"setup-phase","implicit":true,"key":"EqCQeefJkQ"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Choose ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"IOhmu658Qx"},{"type":"inlineCode","value":"R","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sDtGbyCXVq"}],"key":"FMiof6Ms6P"},{"type":"text","value":":","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"f9ycKZJ9mb"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UCtsA9lwqY"},{"type":"text","value":"A power of 2 greater than ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"N04duLjD6T"},{"type":"inlineCode","value":"n","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"jVrPzQtscS"},{"type":"text","value":", enabling fast bitwise operations.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"fR0Qhkx7GU"}],"key":"r5Xo83i4CF"}],"key":"o9p81lNT8J"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"O7p7D0Fw14"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"zhEtvVbLMz"}],"key":"uJsukWVsGz"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"lmnksccC0s"},{"type":"break","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KrGQPmqNAu"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ArJmrsxCC3"},{"type":"inlineCode","value":"R","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"RUKCLhHvh5"},{"type":"text","value":" such that:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ITGAp9bMrT"}],"key":"oKIfxvYUkr"},{"type":"math","value":"R \\cdot R^{-1} \\equiv 1 \\pmod{n}","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>R</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R \\cdot R^{-1} \\equiv 1 \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"ysYpmX3hCd"}],"key":"sXFvv3woGp"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NlHhg0I0d2"},{"type":"inlineCode","value":"n'","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ShLbNnwosz"}],"key":"kQ5ogztX8Q"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mn7h613bU1"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"i8McKFzzCT"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"yCBErFcu9G"},{"type":"inlineCode","value":"-n","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"OL7yUKS9NH"},{"type":"text","value":" modulo ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"OZ5Qe4Dp8W"},{"type":"inlineCode","value":"R","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"MCxolE4bkZ"},{"type":"text","value":", satisfying:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"u7VtWsM8WI"}],"key":"G6grb5kleL"},{"type":"math","value":"-n \\cdot n' \\equiv 1 \\pmod{R}","position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo>−</mo><mi>n</mi><mo>⋅</mo><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">-n \\cdot n&#x27; \\equiv 1 \\pmod{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"4","key":"ZB64C07k4u"}],"key":"IC7TZeiQ0w"}],"key":"QEXYgAQlJY"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"The values ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"jhEkhJWAw1"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"eiCYfWTWNu"},{"type":"text","value":" and ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"Qssjr7onYN"},{"type":"inlineCode","value":"n'","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"XDa1Rwd6G9"},{"type":"text","value":" are precomputed once and used in all Montgomery operations.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"PJdSwErwtH"}],"key":"Kfbg2zJmxU"}],"key":"R9Vc9ebefw"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Conversion to Montgomery Form","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RyspzNEctX"}],"identifier":"conversion-to-montgomery-form","label":"Conversion to Montgomery Form","html_id":"conversion-to-montgomery-form","implicit":true,"key":"jGMa4Eec8W"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To work in the Montgomery domain, convert a number ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JH3FtUPQLQ"},{"type":"inlineCode","value":"a","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"bko0k5YOEH"},{"type":"text","value":" to its Montgomery form ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"W0EZj2fFQv"},{"type":"inlineCode","value":"a'","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OL2GLTrVve"},{"type":"text","value":":","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"S4EOb2JfdK"}],"key":"bsPiNGQRGh"},{"type":"math","value":"a' = a \\cdot R \\pmod{n}","position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>a</mi><mo>⋅</mo><mi>R</mi><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a&#x27; = a \\cdot R \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"5","key":"EOMNY3eOqP"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"This step is a one-time, regular modular multiplication—our “entry fee” to faster computation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iiqGDWovEp"}],"key":"m0dZ6icds8"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Multiplication in the Montgomery Domain","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"kT4N3SaABK"}],"identifier":"multiplication-in-the-montgomery-domain","label":"Multiplication in the Montgomery Domain","html_id":"multiplication-in-the-montgomery-domain","implicit":true,"key":"jWF0RjotwL"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Given ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"DYf5mWHCPM"},{"type":"inlineCode","value":"a'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"h0ZHp3cDqy"},{"type":"text","value":" and ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Nv6NeAh3jJ"},{"type":"inlineCode","value":"b'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"GiOUAWQsDt"},{"type":"text","value":" in Montgomery form, their product ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Ni1bVQGjL1"},{"type":"inlineCode","value":"c'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"MLO4NbZ2oH"},{"type":"text","value":" is:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"zT2IxfF1DO"}],"key":"qkTWCPsVV7"},{"type":"math","value":"c' = a' \\cdot b' \\cdot R^{-1} \\pmod{n}","position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c&#x27; = a&#x27; \\cdot b&#x27; \\cdot R^{-1} \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"6","key":"gcNbHoSNbM"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"While this still looks like it needs division by ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"wAFurOkLh7"},{"type":"inlineCode","value":"n","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"BIcEj1yQrf"},{"type":"text","value":", the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Vg1DrzW1Ei"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Montgomery Reduction (","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"x634Qjg1Rd"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"djx4ZLFpJL"},{"type":"text","value":")","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"jQ9mt9sc1o"}],"key":"diMZ52eV88"},{"type":"text","value":" algorithm efficiently handles this without actual division.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"YGW3szORC9"}],"key":"RD7tBFJWAM"}],"key":"ckpd59lCkY"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. The REDC Algorithm and Final Conversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IUR70C6xQa"}],"identifier":"id-4-the-redc-algorithm-and-final-conversion","label":"4. The REDC Algorithm and Final Conversion","html_id":"id-4-the-redc-algorithm-and-final-conversion","implicit":true,"key":"MdWyPtnM14"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To compute the Montgomery product","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cbJbCNVH09"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XFZS00DeGd"},{"type":"inlineCode","value":"c' = a' · b' · R⁻¹ mod(n)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"llDUX2wUub"},{"type":"text","value":",","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QUaj9Odk7i"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"PyMvUvIfWx"},{"type":"text","value":"we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"oD4Z7HOYf2"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"REDC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"to9gVSgjNT"}],"key":"AyJ3jOCGED"},{"type":"text","value":" function, which efficiently calculates","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bnGIr1xdcQ"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jIIZnsUQV8"},{"type":"inlineMath","value":"T \\cdot R^{-1} \\mod n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"0.6667em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">T \\cdot R^{-1} \\mod n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6667em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"I8Ile8EW15"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"flRdrvmM87"},{"type":"text","value":"for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ND9HP32EDD"},{"type":"inlineMath","value":"T = a' \\cdot b'","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">T = a&#x27; \\cdot b&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"xYahEz1f40"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dtLbtUhRht"}],"key":"gkyBBnykCX"},{"type":"heading","depth":3,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"lpgZu8u9zT"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qZVjasdtz5"},{"type":"text","value":" Algorithm","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"X7BM05ZquV"}],"identifier":"the-redc-algorithm","label":"The REDC Algorithm","html_id":"the-redc-algorithm","implicit":true,"key":"CH1VTIOPa0"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"pJnaCwQ7Fd"},{"type":"inlineCode","value":"m","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gsVV8XBn0U"},{"type":"text","value":":","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"B8DAelxpvw"}],"key":"gHj1S3Fveq"}],"key":"SFyuryioeX"},{"type":"math","value":"m = T \\bmod R \\cdot n’ \\bmod R","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>m</mi><mo>=</mo><mi>T</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi><mo>⋅</mo><mi>n</mi><mtext>’</mtext><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">m = T \\bmod R \\cdot n’ \\bmod R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">’</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span></span>","enumerator":"7","key":"Rz598sFAaB"}],"key":"igLj5j3hQw"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"V2l18fZVAv"},{"type":"inlineCode","value":"t","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"wRTincmwlJ"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"jXG17BqhRI"}],"key":"hu5IaIyJxl"}],"key":"DSkmS66MrU"},{"type":"math","value":"t = \\frac{T + m \\cdot n}{R}","position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mo>+</mo><mi>m</mi><mo>⋅</mo><mi>n</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">t = \\frac{T + m \\cdot n}{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0463em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"8","key":"QmAxm2VQwn"}],"key":"HoSzl89gdW"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Final correction:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bKKDUmLBYw"}],"key":"DUR5A6LrV7"}],"key":"JUD1eN2ga8"},{"type":"math","value":"\\text{If } t \\geq n, \\quad \\text{then } t = t - n","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>If </mtext><mi>t</mi><mo>≥</mo><mi>n</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>then </mtext><mi>t</mi><mo>=</mo><mi>t</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\text{If } t \\geq n, \\quad \\text{then } t = t - n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.136em;\"></span><span class=\"mord text\"><span class=\"mord\">If </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">then </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>","enumerator":"9","key":"oq6gGeLfBw"}],"key":"n3BRlxqrGW"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Return ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"LDca2XeV3s"},{"type":"inlineCode","value":"t","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"PAG7INiSUh"},{"type":"text","value":" as the result.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"Bv1MkwJUSr"}],"key":"TJx9NalfwH"}],"key":"sRmn2eSwNr"}],"key":"e11Y83RBYk"}],"key":"wS8pMv5l9V"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"The speed boost comes from dividing by ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"LTGnHYeNhl"},{"type":"inlineCode","value":"R","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"JSNpRrhYiu"},{"type":"text","value":" (a power of 2), which is just a fast bit shift.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"y4jWnb6vxX"}],"key":"F2Ar3ih5IV"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Conversion Back to Standard Form","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"vUvY8Z25y8"}],"identifier":"conversion-back-to-standard-form","label":"Conversion Back to Standard Form","html_id":"conversion-back-to-standard-form","implicit":true,"key":"UGRGgkzjeJ"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"After all operations, the result ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"CnNe8QpTVi"},{"type":"inlineCode","value":"c'","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"CjsY32LiHE"},{"type":"text","value":" is still in Montgomery form.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"aAzwgU6qGw"},{"type":"break","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"mrFyTK3vXJ"},{"type":"text","value":"To convert back, apply one last ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"rFUlRQ3bPU"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"i3d4zxjwpj"},{"type":"text","value":":","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"XksqPNPoAQ"}],"key":"ctsQxVrDqc"},{"type":"math","value":"c = \\text{REDC}(c')","position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>c</mi><mo>=</mo><mtext>REDC</mtext><mo stretchy=\"false\">(</mo><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c = \\text{REDC}(c&#x27;)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">REDC</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"10","key":"Y6W7ADPggb"}],"key":"T6LcAhPgF7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0:\n            raise ValueError(\"Modulus n must be odd.\")\n        \n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        \n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0:\n            return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1:\n            raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        \n        if t >= self.n:\n            return t - self.n\n        else:\n            return t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        T = a_mont * b_mont\n        return self._reduce(T), T\n\n# --- Usage Example ---\n# 1. One-time setup\nmonty_system = Montgomery(n=13)\nprint(f\"System Initialized for n={monty_system.n}\")\nprint(f\"Calculated R={monty_system.R}, n'={monty_system.n_prime}\")\nprint(\"-\" * 30)\n\n# 2. Convert numbers to Montgomery form\na = 7\nb = 8\na_mont = monty_system.convert_in(a)\nb_mont = monty_system.convert_in(b)\nprint(f\"{a} in Montgomery form is: {a_mont}\")\nprint(f\"{b} in Montgomery form is: {b_mont}\")\nprint(\"-\" * 30)\n\n# 3. Perform multiplication in the Montgomery domain\nproduct_mont, intermediate_T = monty_system.multiply(a_mont, b_mont)\nprint(f\"Intermediate product T = {a_mont} * {b_mont} = {intermediate_T}\")\nprint(f\"REDC(T) -> Product in Montgomery form: {product_mont}\")\nprint(\"-\" * 30)\n\n# 4. Convert the result back to a standard number\nfinal_result = monty_system.convert_out(product_mont)\nprint(f\"Final Result (after converting back): {final_result}\")\nprint(f\"Standard Check: (7 * 8) % 13 = {(7 * 8) % 13}\")","key":"thc0P1Z63I"},{"type":"output","id":"-3s-psSAxcU2ZpRg9Znoq","data":[{"name":"stdout","output_type":"stream","text":"System Initialized for n=13\nCalculated R=16, n'=11\n------------------------------\n7 in Montgomery form is: 8\n8 in Montgomery form is: 11\n------------------------------\nIntermediate product T = 8 * 11 = 88\nREDC(T) -> Product in Montgomery form: 12\n------------------------------\nFinal Result (after converting back): 4\nStandard Check: (7 * 8) % 13 = 4\n"}],"key":"VpJVyt1Je5"}],"key":"IvtEiSHHXp"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ctDJAXxGG4"}],"identifier":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","label":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","html_id":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","implicit":true,"key":"WuwHibmMzb"},{"type":"blockquote","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Question:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"D1EuD5Aw2s"}],"key":"J6APgFNQz5"},{"type":"break","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"c045o0fVq6"},{"type":"text","value":"Montgomery starts with divisions like 112 mod 13 or 128 mod 13, which look slower than a simple 56 mod 13. So why is it still preferred—and actually faster—when working with large numbers?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cxBJBvIuYe"}],"key":"Bn7J8M5maW"}],"key":"zZ4dNVhH9e"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For a single, small calculation, the setup cost of Montgomery reduction makes it ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BFcqgT3Cem"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"slower","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YmqrLukhUU"}],"key":"h9oZ6yNEum"},{"type":"text","value":" than the standard method.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"o6CmPB6YbX"}],"key":"V0QjYBU0JX"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The performance boost isn’t for one-off calculations; it’s for ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Neg6yFrPsm"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"chains of multiplications","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eNneBQ8wCr"}],"key":"y03PM9HvTk"},{"type":"text","value":" performed with the same modulus, which is extremely common in cryptography. The classic use case is ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eA9JTbPgKT"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"modular exponentiation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"g3rOFDYsqB"}],"key":"jWxMhm9DFJ"},{"type":"text","value":" (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"d1cx145Mox"},{"type":"inlineCode","value":"a^e mod n","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"glvpZ9X4LW"},{"type":"text","value":"), which is the core of RSA and the example we will explore next.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JVhv3cRNbu"}],"key":"AryajGmsEB"}],"key":"PVEHcAXwtT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Re-using our clean Montgomery class\nclass Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0: raise ValueError(\"Modulus n must be odd.\")\n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0: return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1: raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        return t - self.n if t >= self.n else t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        return self._reduce(a_mont * b_mont)\n\n# --- Method 1: Standard Exponentiation Trace  ---\ndef trace_standard_pow_clean(base, exp, mod):\n    print(\"--- Starting Standard Modular Exponentiation ---\")\n    expensive_ops = 0\n    res = 1\n    binary_exp = bin(exp)[2:]\n    print(f\"Executing for exponent {exp} (binary: {binary_exp})\\n\")\n    \n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res\n        res = (res * res) % mod\n        expensive_ops += 1\n        print(f\"Step {i+1} (Square): ({res_old}*{res_old}) % {mod} -> {res} (EXPENSIVE)\")\n        \n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res\n            res = (res * base) % mod\n            expensive_ops += 1\n            print(f\"Step {i+1} (Mult):   ({res_old}*{base}) % {mod} -> {res} (EXPENSIVE)\")\n            \n    print(f\"\\nFinal Result: {res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Method 2: Montgomery Exponentiation Trace ---\ndef trace_montgomery_pow_clean(base, exp, n):\n    print(\"--- Starting Montgomery Modular Exponentiation ---\")\n    expensive_ops = 0\n    \n    # 1. Setup & Conversion\n    print(\"Step 1: Setup & Initial Conversion\")\n    monty = Montgomery(n)\n    res_mont = monty.convert_in(1)\n    expensive_ops += 1\n    base_mont = monty.convert_in(base)\n    expensive_ops += 1\n    print(f\"  - Converting 1 -> {res_mont} (EXPENSIVE OP #{expensive_ops-1})\")\n    print(f\"  - Converting {base} -> {base_mont} (EXPENSIVE OP #{expensive_ops})\\n\")\n\n    # 2. Main Loop\n    print(\"Step 2: Main loop with FAST operations\")\n    binary_exp = bin(exp)[2:]\n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res_mont\n        res_mont = monty.multiply(res_mont, res_mont)\n        print(f\"Loop {i+1} (Square): REDC({res_old}*{res_old}) -> {res_mont} (FAST)\")\n\n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res_mont\n            res_mont = monty.multiply(res_mont, base_mont)\n            print(f\"Loop {i+1} (Mult):   REDC({res_old}*{base_mont}) -> {res_mont} (FAST)\")\n\n    # 3. Final Conversion\n    final_res = monty.convert_out(res_mont)\n    print(f\"\\nStep 3: Final conversion -> REDC({res_mont}) -> {final_res} (FAST)\")\n    \n    print(f\"\\nFinal Result: {final_res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Run the cleaned traces ---\nbase, exp, mod = 5, 10, 13\ntrace_standard_pow_clean(base, exp, mod)\nprint(\"=\"*50)\ntrace_montgomery_pow_clean(base, exp, mod)","key":"M8KC8wiT4I"},{"type":"output","id":"x2sUBO29FauJaanb0_i4l","data":[{"name":"stdout","output_type":"stream","text":"--- Starting Standard Modular Exponentiation ---\nExecuting for exponent 10 (binary: 1010)\n\nStep 1 (Square): (1*1) % 13 -> 1 (EXPENSIVE)\nStep 1 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 2 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\nStep 3 (Square): (12*12) % 13 -> 1 (EXPENSIVE)\nStep 3 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 4 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 6\n\n==================================================\n--- Starting Montgomery Modular Exponentiation ---\nStep 1: Setup & Initial Conversion\n  - Converting 1 -> 3 (EXPENSIVE OP #1)\n  - Converting 5 -> 2 (EXPENSIVE OP #2)\n\nStep 2: Main loop with FAST operations\nLoop 1 (Square): REDC(3*3) -> 3 (FAST)\nLoop 1 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 2 (Square): REDC(2*2) -> 10 (FAST)\nLoop 3 (Square): REDC(10*10) -> 3 (FAST)\nLoop 3 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 4 (Square): REDC(2*2) -> 10 (FAST)\n\nStep 3: Final conversion -> REDC(10) -> 12 (FAST)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 2\n\n"}],"key":"ubENqEzmGr"}],"key":"qLwAhs718u"}],"key":"XQxK6VYl0o"},"references":{"cite":{"order":[],"data":{}}}}