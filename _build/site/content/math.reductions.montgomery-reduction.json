{"version":2,"kind":"Notebook","sha256":"88ab12786bedbe8fe7f803596bbfb072bd4f12c6db5d084aacc130c8115d21c8","slug":"math.reductions.montgomery-reduction","location":"/math/reductions/montgomery_reduction.ipynb","dependencies":[],"frontmatter":{"title":"Understanding Montgomery Reduction","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"source_url":"https://github.com/executablebooks/jupyter-book/blob/main/math/reductions/montgomery_reduction.ipynb","edit_url":"https://github.com/executablebooks/jupyter-book/edit/main/math/reductions/montgomery_reduction.ipynb","exports":[{"format":"ipynb","filename":"montgomery_reduction.ipynb","url":"/montgomery_reduction-559b68e8aa3fe5247389824e4f5d1dab.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"1. Introduction: The Problem with Modular Division","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"FLVjudcwxc"}],"identifier":"id-1-introduction-the-problem-with-modular-division","label":"1. Introduction: The Problem with Modular Division","html_id":"id-1-introduction-the-problem-with-modular-division","implicit":true,"key":"aRGRv71dG3"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Modular arithmetic often involves computing remainders: for integers ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zIC21H6uqK"},{"type":"inlineCode","value":"a","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SUUqgUtnoa"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ThINuV9EuT"},{"type":"inlineCode","value":"n","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"KnZf7yre1A"},{"type":"text","value":", we find ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lHbm4r9A47"},{"type":"inlineCode","value":"q","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ccFeFhygVb"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"daOaRXQjTy"},{"type":"inlineCode","value":"r","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SJYrrDALIO"},{"type":"text","value":" such that:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"ZZLrkS5Iax"}],"key":"nsaewBw2gL"},{"type":"math","value":"a = qn + r,\\quad \\text{where} \\quad 0 \\leq r < |n|","position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>a</mi><mo>=</mo><mi>q</mi><mi>n</mi><mo>+</mo><mi>r</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>where</mtext><mspace width=\"1em\"/><mn>0</mn><mo>≤</mo><mi>r</mi><mo>&lt;</mo><mi mathvariant=\"normal\">∣</mi><mi>n</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">a = qn + r,\\quad \\text{where} \\quad 0 \\leq r &lt; |n|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">where</span></span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">n</span><span class=\"mord\">∣</span></span></span></span></span>","enumerator":"1","key":"ubePohpyU9"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Here, ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FPdw9B31jt"},{"type":"inlineCode","value":"r = a mod n","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"tGOF8Y1Yot"},{"type":"text","value":". While this is straightforward for small numbers, it becomes inefficient at scale, especially in cryptographic computations with large integers.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"ViXvpZmzgZ"}],"key":"VB2kBzmpH6"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"For example, to compute:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"g2j2TetaTP"}],"key":"A3eWdujzgJ"},{"type":"math","value":"(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5","position":{"start":{"line":15,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">(</mo><mn>12</mn><mo>×</mo><mn>15</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo>=</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mn>12</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo>×</mo><mo stretchy=\"false\">(</mo><mn>15</mn><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mo stretchy=\"false\">(</mo><mn>5</mn><mo>×</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mspace></mspace><mspace width=\"1em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mn>7</mn><mspace linebreak=\"newline\"></mspace><mo>=</mo><mn>5</mn></mrow><annotation encoding=\"application/x-tex\">(12 \\times 15) \\mod 7 = ((12 \\mod 7) \\times (15 \\mod 7)) \\mod 7 \\\\\n= (5 \\times 1) \\mod 7 \\\\\n= 5</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">12</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">15</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">((</span><span class=\"mord\">12</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">15</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span><span class=\"mclose\">))</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">7</span></span><span class=\"mspace newline\"></span><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">5</span></span></span></span></span>","enumerator":"2","key":"wTVnixHQAR"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"We still need to perform ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"MPUTqI0SBJ"},{"type":"inlineCode","value":"mod","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"fiRCQczEth"},{"type":"text","value":" operations (i.e., division), which are costly for large numbers. Since cryptographic systems rely heavily on modular multiplication, this repeated division becomes a bottleneck.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"KmEZpbYodY"}],"key":"TSSEnnK5iZ"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Montgomery reduction","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"bISa6vuExG"}],"key":"CMtITRo8oD"},{"type":"text","value":" addresses this by avoiding direct division, making modular multiplication more efficient for large integers.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"rATejueSN6"}],"key":"IjGhjJmVof"}],"key":"Ee714PmuOT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. The Core Idea: A New Domain for Faster Math","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LYPKpL3saK"}],"identifier":"id-2-the-core-idea-a-new-domain-for-faster-math","label":"2. The Core Idea: A New Domain for Faster Math","html_id":"id-2-the-core-idea-a-new-domain-for-faster-math","implicit":true,"key":"pZXRKI0PXl"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery reduction speeds up modular arithmetic by moving calculations into a special ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KXo8tdAoyF"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Montgomery domain","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m4i9lNG3qY"}],"key":"gw5Ud1R51w"},{"type":"text","value":", avoiding costly division by ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aKd9MrdQ77"},{"type":"inlineCode","value":"n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Dc4p7Z9iF7"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"h5x7qzJyfp"}],"key":"x7H6x0073H"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This is done using a new modulus ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"yMf4GQdz9s"},{"type":"inlineCode","value":"R","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H1Zkz4E7Vp"},{"type":"text","value":", typically a power of 2 (like  ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LJiV2xLXEw"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"XrskiUQvcG"},{"type":"superscript","children":[{"type":"text","value":"32","key":"PwKtSvuE1Q"}],"key":"Ew6uSQkYtE"}],"key":"yXKZ62hSPi"},{"type":"text","value":" or ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"q0nwLuVtIR"},{"type":"span","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"2","key":"WhkAL7wfjc"},{"type":"superscript","children":[{"type":"text","value":"64","key":"PyMTQhF1uQ"}],"key":"GDO56U4eRO"}],"key":"BmKCYCw54g"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VvW1yPfifE"}],"key":"RvjNUPdHFv"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Why Use a Power of 2?","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AluHvZFiQS"}],"identifier":"why-use-a-power-of-2","label":"Why Use a Power of 2?","html_id":"why-use-a-power-of-2","implicit":true,"key":"SV2pFjeQQi"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Because computers handle powers of 2 efficiently:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"G4T9ZV6X8k"}],"key":"q47Vc2Qt82"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Division by ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"xbSfZ6exdP"},{"type":"inlineCode","value":"R","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"FhmMEWOVlV"}],"key":"bdxNWVJPd2"},{"type":"text","value":" → simple ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"TjbcdBQens"},{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"right shift","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"GmBRNZv8M0"}],"key":"oOFL12bpom"}],"key":"yfT0esvw9S"}],"key":"GRW6sPO3JY"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Modulo ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"hj99JkTX1O"},{"type":"inlineCode","value":"R","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"C9gkBFrnrX"}],"key":"jbxBCgMBZV"},{"type":"text","value":" → fast ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Cjvqdwx1Oj"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"bitwise AND","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"bTpEe3FQRi"}],"key":"s91Bly6hL2"}],"key":"Sbba5wdTir"}],"key":"sijZWUWPGi"}],"key":"S58bBab5Pm"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"This makes reductions much faster than regular division.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"i9UEOuPwXl"}],"key":"QL4b9uzE4T"}],"key":"BOABW2mYb8"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. The Montgomery Algorithm: Setup and Multiplication","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SVUX2HUTR6"}],"identifier":"id-3-the-montgomery-algorithm-setup-and-multiplication","label":"3. The Montgomery Algorithm: Setup and Multiplication","html_id":"id-3-the-montgomery-algorithm-setup-and-multiplication","implicit":true,"key":"fXQAm7axN4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"With ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t2OShmkoSM"},{"type":"inlineCode","value":"R","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"zIXWo5JgEZ"},{"type":"text","value":" as a power of 2, we set up the Montgomery system through a one-time preparation:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"W1ZzrXTMZu"}],"key":"tc0szLLKqq"},{"type":"heading","depth":3,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Setup Phase","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"S4XtaUu2wt"}],"identifier":"setup-phase","label":"Setup Phase","html_id":"setup-phase","implicit":true,"key":"bZiBRdUHAD"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Choose ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GscymKe9Pb"},{"type":"inlineCode","value":"R","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"vNJaUhvOdW"}],"key":"WTCGKSMs7w"},{"type":"text","value":":","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TT8KTMUxuX"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Iif3Ir0J1J"},{"type":"text","value":"A power of 2 greater than ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bW0bYzjpdS"},{"type":"inlineCode","value":"n","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"uRxB0uIIde"},{"type":"text","value":", enabling fast bitwise operations.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"B4xPhAL2et"}],"key":"ffi4N1FDSy"}],"key":"xmzRCqQwoM"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"S82QBvbk3T"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"lc9GtqbXjs"}],"key":"gayKHVhvPT"},{"type":"text","value":":","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"HgQ0nCwUUJ"},{"type":"break","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"zP9wELtmb9"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"v2gx3ysj2q"},{"type":"inlineCode","value":"R","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"IRHG3vHzkE"},{"type":"text","value":" such that:","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"rEAbxGcvkl"}],"key":"UNWXap12ls"},{"type":"math","value":"R \\cdot R^{-1} \\equiv 1 \\pmod{n}","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>R</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R \\cdot R^{-1} \\equiv 1 \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"3","key":"pOPdwgMgfG"}],"key":"DWp2nNfo2s"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"jDpqW1Ciwp"},{"type":"inlineCode","value":"n'","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"KKXNvn3CT6"}],"key":"MQJMEJF84B"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"niw1VYbOqd"},{"type":"break","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"DoJbstTL40"},{"type":"text","value":"The modular inverse of ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"baSs765H3P"},{"type":"inlineCode","value":"-n","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"xwcgqkxgLH"},{"type":"text","value":" modulo ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"cK3WBRhdfR"},{"type":"inlineCode","value":"R","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"BeyVT7XAT9"},{"type":"text","value":", satisfying:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"f6AIisRcMf"}],"key":"pnQh8mfaVf"},{"type":"math","value":"-n \\cdot n' \\equiv 1 \\pmod{R}","position":{"start":{"line":20,"column":1},"end":{"line":22,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo>−</mo><mi>n</mi><mo>⋅</mo><msup><mi>n</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>≡</mo><mn>1</mn><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">-n \\cdot n&#x27; \\equiv 1 \\pmod{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"4","key":"TrLiyKmKEe"}],"key":"dDfIDYYhSX"}],"key":"vhRwEkyXSO"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"The values ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"ahIYemGuap"},{"type":"inlineMath","value":"R^{-1}","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">R^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"PFz4m1S4qo"},{"type":"text","value":" and ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"cBcdFj5DMv"},{"type":"inlineCode","value":"n'","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"sjsEs5Pqgd"},{"type":"text","value":" are precomputed once and used in all Montgomery operations.","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"KpQZ570Kkw"}],"key":"KU1OhAMScQ"}],"key":"VaVohwxY84"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Conversion to Montgomery Form","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"u6sjdBSbBx"}],"identifier":"conversion-to-montgomery-form","label":"Conversion to Montgomery Form","html_id":"conversion-to-montgomery-form","implicit":true,"key":"qiEhCcDgOI"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To work in the Montgomery domain, convert a number ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Us3R1mMN63"},{"type":"inlineCode","value":"a","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"MAHt74av8K"},{"type":"text","value":" to its Montgomery form ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"rVKUxHl0dr"},{"type":"inlineCode","value":"a'","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lCgV6zhWk5"},{"type":"text","value":":","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ht7RBrD7Y5"}],"key":"IybkVm7nnb"},{"type":"math","value":"a' = a \\cdot R \\pmod{n}","position":{"start":{"line":6,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mi>a</mi><mo>⋅</mo><mi>R</mi><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">a&#x27; = a \\cdot R \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"5","key":"qeAxmHvwfN"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"This step is a one-time, regular modular multiplication—our “entry fee” to faster computation.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Ph6jMFtNEJ"}],"key":"EyZndYOsj1"},{"type":"heading","depth":3,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Multiplication in the Montgomery Domain","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"F7K7myENoH"}],"identifier":"multiplication-in-the-montgomery-domain","label":"Multiplication in the Montgomery Domain","html_id":"multiplication-in-the-montgomery-domain","implicit":true,"key":"iqKbVekgOV"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Given ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"fEZJ8YDOZf"},{"type":"inlineCode","value":"a'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"HZdCHFrLzS"},{"type":"text","value":" and ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"xj4y3him29"},{"type":"inlineCode","value":"b'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"bXYeujjg8l"},{"type":"text","value":" in Montgomery form, their product ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"vu0bX0pWCg"},{"type":"inlineCode","value":"c'","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"kx3VZf5jRw"},{"type":"text","value":" is:","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"K0LwFXMDWU"}],"key":"P4GilCX5Nu"},{"type":"math","value":"c' = a' \\cdot b' \\cdot R^{-1} \\pmod{n}","position":{"start":{"line":17,"column":1},"end":{"line":19,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"1em\"/><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mspace width=\"0.3333em\"/><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c&#x27; = a&#x27; \\cdot b&#x27; \\cdot R^{-1} \\pmod{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8019em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8641em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:1em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.3333em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"6","key":"TG3jvpfFpp"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"While this still looks like it needs division by ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"H8TS7XZ9kO"},{"type":"inlineCode","value":"n","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"N7zmkwo04q"},{"type":"text","value":", the ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"c7ilbnviMJ"},{"type":"strong","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Montgomery Reduction (","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"KB7GX7nXMr"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Kg99yNVcqr"},{"type":"text","value":")","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"EM9pBn95dU"}],"key":"RWHA9vMZJ9"},{"type":"text","value":" algorithm efficiently handles this without actual division.","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"EKbjiZZjer"}],"key":"Hht4eVxCIn"}],"key":"zdyGDQlnly"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. The REDC Algorithm and Final Conversion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z2kqf7PqjP"}],"identifier":"id-4-the-redc-algorithm-and-final-conversion","label":"4. The REDC Algorithm and Final Conversion","html_id":"id-4-the-redc-algorithm-and-final-conversion","implicit":true,"key":"HhYHlO5K10"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To compute the Montgomery product","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"abLVGDMrqE"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"X0GETi8hrD"},{"type":"inlineCode","value":"c' = a' · b' · R⁻¹ mod(n)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"JesO4n7nfv"},{"type":"text","value":",","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l0aiPOUzjs"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"WOqgEwG2Cj"},{"type":"text","value":"we use the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iKEiC7o5Vc"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"inlineCode","value":"REDC","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jWihLUYhSY"}],"key":"IiQo8vACOf"},{"type":"text","value":" function, which efficiently calculates","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"aPtG4TFNKv"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q4jbkPPvE9"},{"type":"inlineMath","value":"T \\cdot R^{-1} \\mod n","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>⋅</mo><msup><mi>R</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace></mspace><mspace width=\"0.6667em\"/><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow><mtext> </mtext><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">T \\cdot R^{-1} \\mod n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace allowbreak\"></span><span class=\"mspace\" style=\"margin-right:0.6667em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>","key":"BL2xSs9ggJ"},{"type":"break","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VI1FK8bBlt"},{"type":"text","value":"for ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"d2HreZF1iV"},{"type":"inlineMath","value":"T = a' \\cdot b'","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mo>=</mo><msup><mi>a</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>⋅</mo><msup><mi>b</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">T = a&#x27; \\cdot b&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"KZJAvZp1Nr"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BgYMlHkONI"}],"key":"LnNFv3beGq"},{"type":"heading","depth":3,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NFEXpXltNZ"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"gKeY4UQsM2"},{"type":"text","value":" Algorithm","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"dDQfviLa7j"}],"identifier":"the-redc-algorithm","label":"The REDC Algorithm","html_id":"the-redc-algorithm","implicit":true,"key":"D6gbgLEAuP"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"strong","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"gnk8yBkoiq"},{"type":"inlineCode","value":"m","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"dQUcDbv2En"},{"type":"text","value":":","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"DrXykXTv0a"}],"key":"VM4uc1vU3p"}],"key":"jakeVxdz9m"},{"type":"math","value":"m = T \\bmod R \\cdot n’ \\bmod R","position":{"start":{"line":13,"column":1},"end":{"line":15,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>m</mi><mo>=</mo><mi>T</mi><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi><mo>⋅</mo><mi>n</mi><mtext>’</mtext><mtext> </mtext><mo lspace=\"0.22em\" rspace=\"0.22em\"><mrow><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">o</mi><mi mathvariant=\"normal\">d</mi></mrow></mo><mtext> </mtext><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">m = T \\bmod R \\cdot n’ \\bmod R</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mord\">’</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\"><span class=\"mord\"><span class=\"mord mathrm\">mod</span></span></span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span></span>","enumerator":"7","key":"tJZqsAwD2b"}],"key":"qvSs4pIOCj"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"strong","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Compute ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"yKrRpMpJcz"},{"type":"inlineCode","value":"t","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"yWZktJkB7P"},{"type":"text","value":":","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"rru2G2nLM4"}],"key":"gOicHPPKne"}],"key":"mCUEk2mypj"},{"type":"math","value":"t = \\frac{T + m \\cdot n}{R}","position":{"start":{"line":19,"column":1},"end":{"line":21,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mo>+</mo><mi>m</mi><mo>⋅</mo><mi>n</mi></mrow><mi>R</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">t = \\frac{T + m \\cdot n}{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.0463em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3603em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span>","enumerator":"8","key":"RQy4bGPfNL"}],"key":"IIN3IVHQdT"},{"type":"listItem","spread":true,"position":{"start":{"line":23,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Final correction:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"rPpbNkuRKZ"}],"key":"sGNkfCGjo6"}],"key":"wSeuyON7rq"},{"type":"math","value":"\\text{If } t \\geq n, \\quad \\text{then } t = t - n","position":{"start":{"line":25,"column":1},"end":{"line":27,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>If </mtext><mi>t</mi><mo>≥</mo><mi>n</mi><mo separator=\"true\">,</mo><mspace width=\"1em\"/><mtext>then </mtext><mi>t</mi><mo>=</mo><mi>t</mi><mo>−</mo><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">\\text{If } t \\geq n, \\quad \\text{then } t = t - n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8304em;vertical-align:-0.136em;\"></span><span class=\"mord text\"><span class=\"mord\">If </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">then </span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6984em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span></span>","enumerator":"9","key":"lPatfO6xOM"}],"key":"rqOO4RfTCz"},{"type":"listItem","spread":true,"position":{"start":{"line":29,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"strong","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Return ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"EzpDuk9oaB"},{"type":"inlineCode","value":"t","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"UQevzkv3yd"},{"type":"text","value":" as the result.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"vZxOx3SVB0"}],"key":"RywTpJJA9O"}],"key":"Didjcv15YD"}],"key":"F6i9eFx9qN"}],"key":"fAwpvEVItZ"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"The speed boost comes from dividing by ","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"CGFTTDK2o7"},{"type":"inlineCode","value":"R","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"v4A9pDxwCE"},{"type":"text","value":" (a power of 2), which is just a fast bit shift.","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"sncCqH88RK"}],"key":"X7LWE1pw3a"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Conversion Back to Standard Form","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"YziJo5fhMH"}],"identifier":"conversion-back-to-standard-form","label":"Conversion Back to Standard Form","html_id":"conversion-back-to-standard-form","implicit":true,"key":"c6ojXByNLL"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"After all operations, the result ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"V3Frh70nWC"},{"type":"inlineCode","value":"c'","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"VUBh8ehtDB"},{"type":"text","value":" is still in Montgomery form.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"EfNxPcNVpZ"},{"type":"break","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"TuRBeZ6Gs1"},{"type":"text","value":"To convert back, apply one last ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"Y4KX3wo1oF"},{"type":"inlineCode","value":"REDC","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"X0BRzf7fFG"},{"type":"text","value":":","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"pkD6WXaCFc"}],"key":"rTmlwEacP5"},{"type":"math","value":"c = \\text{REDC}(c')","position":{"start":{"line":39,"column":1},"end":{"line":41,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>c</mi><mo>=</mo><mtext>REDC</mtext><mo stretchy=\"false\">(</mo><msup><mi>c</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">c = \\text{REDC}(c&#x27;)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0519em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">REDC</span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8019em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span>","enumerator":"10","key":"XXmaGDdVpt"}],"key":"llenWU0D1U"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"class Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0:\n            raise ValueError(\"Modulus n must be odd.\")\n        \n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        \n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0:\n            return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1:\n            raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        \n        if t >= self.n:\n            return t - self.n\n        else:\n            return t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        T = a_mont * b_mont\n        return self._reduce(T), T\n\n# --- Usage Example ---\n# 1. One-time setup\nmonty_system = Montgomery(n=13)\nprint(f\"System Initialized for n={monty_system.n}\")\nprint(f\"Calculated R={monty_system.R}, n'={monty_system.n_prime}\")\nprint(\"-\" * 30)\n\n# 2. Convert numbers to Montgomery form\na = 7\nb = 8\na_mont = monty_system.convert_in(a)\nb_mont = monty_system.convert_in(b)\nprint(f\"{a} in Montgomery form is: {a_mont}\")\nprint(f\"{b} in Montgomery form is: {b_mont}\")\nprint(\"-\" * 30)\n\n# 3. Perform multiplication in the Montgomery domain\nproduct_mont, intermediate_T = monty_system.multiply(a_mont, b_mont)\nprint(f\"Intermediate product T = {a_mont} * {b_mont} = {intermediate_T}\")\nprint(f\"REDC(T) -> Product in Montgomery form: {product_mont}\")\nprint(\"-\" * 30)\n\n# 4. Convert the result back to a standard number\nfinal_result = monty_system.convert_out(product_mont)\nprint(f\"Final Result (after converting back): {final_result}\")\nprint(f\"Standard Check: (7 * 8) % 13 = {(7 * 8) % 13}\")","key":"wyI5KtN6ox"},{"type":"output","id":"5Z4J90Fcyu6qcvU__Gtrz","data":[{"name":"stdout","output_type":"stream","text":"System Initialized for n=13\nCalculated R=16, n'=11\n------------------------------\n7 in Montgomery form is: 8\n8 in Montgomery form is: 11\n------------------------------\nIntermediate product T = 8 * 11 = 88\nREDC(T) -> Product in Montgomery form: 12\n------------------------------\nFinal Result (after converting back): 4\nStandard Check: (7 * 8) % 13 = 4\n"}],"key":"GWRpsFIV0Q"}],"key":"Jn4aWqEKvJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"NOmC70zBUV"}],"identifier":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","label":"A Quick Clarification: Why Does Montgomery Seem Slower at First?","html_id":"a-quick-clarification-why-does-montgomery-seem-slower-at-first","implicit":true,"key":"G5cXcYWOt7"},{"type":"blockquote","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Question:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"wIMfYL4ppM"}],"key":"etipfoYtuF"},{"type":"break","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KMSyOMCCQD"},{"type":"text","value":"Montgomery starts with divisions like 112 mod 13 or 128 mod 13, which look slower than a simple 56 mod 13. So why is it still preferred—and actually faster—when working with large numbers?","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"OVNc5IB1g8"}],"key":"yR62niL0wH"}],"key":"mgvaceUd46"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For a single, small calculation, the setup cost of Montgomery reduction makes it ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Mp01ObKjex"},{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"slower","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"teSHHmtVwA"}],"key":"UDurthipCY"},{"type":"text","value":" than the standard method.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KZEKnD4aXj"}],"key":"j2D1sea3vx"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The performance boost isn’t for one-off calculations; it’s for ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"doR9GjOT17"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"chains of multiplications","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"tzr91DA0xp"}],"key":"I0jHC3ECae"},{"type":"text","value":" performed with the same modulus, which is extremely common in cryptography. The classic use case is ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zjlJsXASMR"},{"type":"strong","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"modular exponentiation","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Al6I7nFxQU"}],"key":"DZgiPxK1Yh"},{"type":"text","value":" (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"eJGyKsWTZd"},{"type":"inlineCode","value":"a^e mod n","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"FP5AEHuQE6"},{"type":"text","value":"), which is the core of RSA and the example we will explore next.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"mUX6RB4z8Q"}],"key":"SRE8ZLgjKp"}],"key":"VeCzk51yzL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Re-using our clean Montgomery class\nclass Montgomery:\n    def __init__(self, n):\n        if n % 2 == 0: raise ValueError(\"Modulus n must be odd.\")\n        self.n = n\n        self.logR = n.bit_length()\n        self.R = 1 << self.logR\n        self.R_mask = self.R - 1\n        n_inv_R = self._modinv(self.n, self.R)\n        self.n_prime = self.R - n_inv_R\n\n    def _egcd(self, a, b):\n        if a == 0: return (b, 0, 1)\n        g, y, x = self._egcd(b % a, a)\n        return (g, x - (b // a) * y, y)\n\n    def _modinv(self, a, m):\n        g, x, y = self._egcd(a, m)\n        if g != 1: raise ValueError('Modular inverse does not exist')\n        return x % m\n        \n    def _reduce(self, T):\n        m = ((T & self.R_mask) * self.n_prime) & self.R_mask\n        t = (T + m * self.n) >> self.logR\n        return t - self.n if t >= self.n else t\n\n    def convert_in(self, x):\n        return (x * self.R) % self.n\n\n    def convert_out(self, x_mont):\n        return self._reduce(x_mont)\n\n    def multiply(self, a_mont, b_mont):\n        return self._reduce(a_mont * b_mont)\n\n# --- Method 1: Standard Exponentiation Trace  ---\ndef trace_standard_pow_clean(base, exp, mod):\n    print(\"--- Starting Standard Modular Exponentiation ---\")\n    expensive_ops = 0\n    res = 1\n    binary_exp = bin(exp)[2:]\n    print(f\"Executing for exponent {exp} (binary: {binary_exp})\\n\")\n    \n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res\n        res = (res * res) % mod\n        expensive_ops += 1\n        print(f\"Step {i+1} (Square): ({res_old}*{res_old}) % {mod} -> {res} (EXPENSIVE)\")\n        \n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res\n            res = (res * base) % mod\n            expensive_ops += 1\n            print(f\"Step {i+1} (Mult):   ({res_old}*{base}) % {mod} -> {res} (EXPENSIVE)\")\n            \n    print(f\"\\nFinal Result: {res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Method 2: Montgomery Exponentiation Trace ---\ndef trace_montgomery_pow_clean(base, exp, n):\n    print(\"--- Starting Montgomery Modular Exponentiation ---\")\n    expensive_ops = 0\n    \n    # 1. Setup & Conversion\n    print(\"Step 1: Setup & Initial Conversion\")\n    monty = Montgomery(n)\n    res_mont = monty.convert_in(1)\n    expensive_ops += 1\n    base_mont = monty.convert_in(base)\n    expensive_ops += 1\n    print(f\"  - Converting 1 -> {res_mont} (EXPENSIVE OP #{expensive_ops-1})\")\n    print(f\"  - Converting {base} -> {base_mont} (EXPENSIVE OP #{expensive_ops})\\n\")\n\n    # 2. Main Loop\n    print(\"Step 2: Main loop with FAST operations\")\n    binary_exp = bin(exp)[2:]\n    for i, bit in enumerate(binary_exp):\n        # Squaring step\n        res_old = res_mont\n        res_mont = monty.multiply(res_mont, res_mont)\n        print(f\"Loop {i+1} (Square): REDC({res_old}*{res_old}) -> {res_mont} (FAST)\")\n\n        # Multiplication step if bit is 1\n        if bit == '1':\n            res_old = res_mont\n            res_mont = monty.multiply(res_mont, base_mont)\n            print(f\"Loop {i+1} (Mult):   REDC({res_old}*{base_mont}) -> {res_mont} (FAST)\")\n\n    # 3. Final Conversion\n    final_res = monty.convert_out(res_mont)\n    print(f\"\\nStep 3: Final conversion -> REDC({res_mont}) -> {final_res} (FAST)\")\n    \n    print(f\"\\nFinal Result: {final_res}\")\n    print(f\"Total Expensive (mod n) Operations: {expensive_ops}\\n\")\n\n# --- Run the cleaned traces ---\nbase, exp, mod = 5, 10, 13\ntrace_standard_pow_clean(base, exp, mod)\nprint(\"=\"*50)\ntrace_montgomery_pow_clean(base, exp, mod)","key":"YXsa0bQ2MY"},{"type":"output","id":"J5oFzSVA2Rw1ZxsKU0wrd","data":[{"name":"stdout","output_type":"stream","text":"--- Starting Standard Modular Exponentiation ---\nExecuting for exponent 10 (binary: 1010)\n\nStep 1 (Square): (1*1) % 13 -> 1 (EXPENSIVE)\nStep 1 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 2 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\nStep 3 (Square): (12*12) % 13 -> 1 (EXPENSIVE)\nStep 3 (Mult):   (1*5) % 13 -> 5 (EXPENSIVE)\nStep 4 (Square): (5*5) % 13 -> 12 (EXPENSIVE)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 6\n\n==================================================\n--- Starting Montgomery Modular Exponentiation ---\nStep 1: Setup & Initial Conversion\n  - Converting 1 -> 3 (EXPENSIVE OP #1)\n  - Converting 5 -> 2 (EXPENSIVE OP #2)\n\nStep 2: Main loop with FAST operations\nLoop 1 (Square): REDC(3*3) -> 3 (FAST)\nLoop 1 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 2 (Square): REDC(2*2) -> 10 (FAST)\nLoop 3 (Square): REDC(10*10) -> 3 (FAST)\nLoop 3 (Mult):   REDC(3*2) -> 2 (FAST)\nLoop 4 (Square): REDC(2*2) -> 10 (FAST)\n\nStep 3: Final conversion -> REDC(10) -> 12 (FAST)\n\nFinal Result: 12\nTotal Expensive (mod n) Operations: 2\n\n"}],"key":"jRLmqzjIn7"}],"key":"kMU5h5EIAv"}],"key":"WYKBHNWeDj"},"references":{"cite":{"order":[],"data":{}}}}