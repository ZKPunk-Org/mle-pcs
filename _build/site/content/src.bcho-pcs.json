{"version":2,"kind":"Notebook","sha256":"9de0aaef11366a3e7711ab4673207967e4c1569a1ce5714c5da22d1d3d0f69cc","slug":"src.bcho-pcs","location":"/src/bcho_pcs.ipynb","dependencies":[],"frontmatter":{"title":"BCHO PCS","content_includes_title":false,"kernelspec":{"name":"sagemath-10.4","display_name":"SageMath 10.4","language":"sage"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"source_url":"https://github.com/executablebooks/jupyter-book/blob/main/src/bcho_pcs.ipynb","edit_url":"https://github.com/executablebooks/jupyter-book/edit/main/src/bcho_pcs.ipynb","exports":[{"format":"ipynb","filename":"bcho_pcs.ipynb","url":"/bcho_pcs-5a2ca9078234ed554e223fbe629356e4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"from group import DummyGroup\nfrom utils import log_2, pow_2\nfrom unipolynomial import UniPolynomial\nfrom mle2 import MLEPolynomial\nfrom kzg10 import Commitment, KZG10Commitment","key":"lagWdZOPw2"},{"type":"output","id":"8zwIEwu_lRNO55gaW0WCO","data":[],"key":"kC4xR0VZT7"}],"key":"llj7ThTrCp"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"F193.<a> = GF(193)\nR193.<X> = F193[]\nR193\nFp=F193\nFp","key":"xo6Hbggb3F"},{"type":"output","id":"Pc2xTtOrBXDYvOf_HHTBF","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"Finite Field of size 193","content_type":"text/plain"}}}],"key":"PFOx0tlN8P"}],"key":"PtbDOEny6a"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.set_scalar(Fp(0), Fp)\nCommitment.set_scalar(Fp(0))","key":"y24xOoYGXq"},{"type":"output","id":"i8Tf_QOq3rlYWfAAG7JXE","data":[],"key":"vvLa71QtRc"}],"key":"cbaynxeQNL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# For symbolic calculation\n\nR_2.<X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2> = Fp[]; R_2","key":"eJOqwWsgUE"},{"type":"output","id":"T72t-mcs7M7baNpg1NzNv","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"Multivariate Polynomial Ring in X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2 over Finite Field of size 193","content_type":"text/plain"}}}],"key":"idBjnMTPXF"}],"key":"aTiF1KZlc3"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp2 = Fp.extension(2, 'b'); Fp2","key":"D008QT2yDx"},{"type":"output","id":"Qk7YiVKvZj_M-X3y64QWk","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"Finite Field in b of size 193^2","content_type":"text/plain"}}}],"key":"usV16PmIzy"}],"key":"jcxfDVfsbk"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"omega = Fp.primitive_element()^3; omega, omega^64 == 1, omega^32 == -1","key":"Hgx0hEJO92"},{"type":"output","id":"TYxT5GdjTaaJMSXit1FL4","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"(125, True, True)","content_type":"text/plain"}}}],"key":"rhJ18MSrdO"}],"key":"XBY4Jonr22"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H16 = [(omega^4)^i for i in range(16)]; H16","key":"v8rujp3sKc"},{"type":"output","id":"HUgbTe4o2aEgyysPxrt8-","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"[1, 64, 43, 50, 112, 27, 184, 3, 192, 129, 150, 143, 81, 166, 9, 190]","content_type":"text/plain"}}}],"key":"PjsLL5BZBW"}],"key":"tyaAvZWrhQ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H8 = [(omega^8)^i for i in range(8)]; H8","key":"dp55ZzTPSA"},{"type":"output","id":"ZYFyCLTszKlsjUCcX878H","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"[1, 43, 112, 184, 192, 150, 81, 9]","content_type":"text/plain"}}}],"key":"vfQZQB1zzs"}],"key":"WVKUHHPg5l"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H4 = [(omega^16)^i for i in range(4)]; H4","key":"uA7MXIVB6k"},{"type":"output","id":"_W8ZCGebrzZsezmTaOt7h","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"[1, 112, 192, 81]","content_type":"text/plain"}}}],"key":"ol0jmeMS5n"}],"key":"rMaih1ZBiX"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1 = DummyGroup(Fp)\nG1.generator(), G1.exp(2, 3), G1.order(), ","key":"iMXVqhFFiS"},{"type":"output","id":"ZXuLj6eqnabQz6qOTBC09","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"(5, 6, 193)","content_type":"text/plain"}}}],"key":"UQxJ7bOB0l"}],"key":"beZmpgvPB3"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1.exp(X1, 3)","key":"bpvuv8WOnz"},{"type":"output","id":"OMO3n4bZ5Jf_qdbGR2cBS","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"3*X1","content_type":"text/plain"}}}],"key":"IZwozg0YjB"}],"key":"cUftl3793U"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G2 = DummyGroup(Fp2)\nFp2.random_element()\nG2.generator(), G2.exp(G2.generator(), 3), G2.order(), G2.field.polynomial()","key":"PQLAOZSsXW"},{"type":"output","id":"NvYemD7ycc4bfM_qkxsqT","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"(b, 3*b, 37249, b^2 + 192*b + 5)","content_type":"text/plain"}}}],"key":"BPaR3m0l72"}],"key":"qRGCEAXRSD"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def is_power_of_two(n):\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    if n == 2**(k-1):\n        return True\n    else:\n        return False\n\ndef next_power_of_two(n):\n    assert n >= 0, \"No negative integer\"\n    if is_power_of_two(n):\n        return n\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    return k\n\nis_power_of_two(15), next_power_of_two(15)","key":"BibPMFVlIt"},{"type":"output","id":"skC4mkINWVNmhegHYNuW6","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"(False, 4)","content_type":"text/plain"}}}],"key":"MCkQjT8Ijw"}],"key":"tEOKOUo44r"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def bits_le_with_width(i, width):\n    if i >= 2**width:\n        return \"Failed\"\n    bits = []\n    while width:\n        bits.append(i % 2)\n        i //= 2\n        width -= 1\n    return bits\n        \nbits_le_with_width(6, 5)\n","key":"pEmL7wI1Ux"},{"type":"output","id":"8vqHdalhd8TMVWkNu0MPO","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"[0, 1, 1, 0, 0]","content_type":"text/plain"}}}],"key":"l2ZUFHqQ0m"}],"key":"qMDWPzw1P2"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Polynomial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MrjaEDk7HO"}],"identifier":"polynomial","label":"Polynomial","html_id":"polynomial","implicit":true,"key":"rHRhcj1UTs"}],"key":"YnFip5z71u"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# \n#  m = [1]\n#  m = [1] + [1 * X0, 1 * X1]\n#  m = m + [1 * X0^2, 1 * X0 * X1, 1 * X1]\ndef mle_eval_from_coeffs(f_coeffs, point):\n    k = len(point)\n    n = len(f_coeffs)\n    assert len(f_coeffs) == 1 << k\n    \n    e = Fp(0)\n    for i in range(n):\n        i_bits = bits_le_with_width(i, k)\n        monomial = product([point[j] if i_bits[j] == 1 else 1 for j in range(k)])\n        e += f_coeffs[i] * monomial\n    \n    return e\n\nmle_eval_from_coeffs([1, 3, 2, 1], [91, 181]) == Fp((1 + 3*X0 + 2*X1 + 1*X0*X1)(X0=91, X1=181))","key":"Y7FVC5PdV8"},{"type":"output","id":"zCejI1ZC9DwQYXzA0Wx7N","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"NdOpNJ1ElO"}],"key":"xDEX9fyG42"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"mle_eval_from_coeffs([1, 3, 2, 1], [X0, X1])","key":"Tmn89sk0HL"},{"type":"output","id":"8_68gVxQlq7JF4BIQtSUo","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"X0*X1 + 3*X0 + 2*X1 + 1","content_type":"text/plain"}}}],"key":"lkwcnmU87w"}],"key":"pCw7Bmcv1Z"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def uni_eval_from_coeffs(coeffs, z):\n    t = Fp(1)\n    eval = Fp(0)\n    for i in range(0, len(coeffs)):\n        eval += coeffs[i] * t\n        t *= z\n    return eval\n\nuni_eval_from_coeffs([1, 3, 2, 1], 91) == Fp(1 + 3*91 + 2*91^2 + 1*91^3) == Fp(144)","key":"AQsRjGgHSg"},{"type":"output","id":"kbQ-8YUU1lwPyTT6bAGLH","data":[{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"ZkVJHShaqe"}],"key":"WVfldMNWM1"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def polynomial_division(dividend, divisor):\n    \"\"\"\n    Perform univariate polynomial division.\n\n    Args:\n        dividend (list): Coefficients of the dividend polynomial, in descending order of degree.\n        divisor (list): Coefficients of the divisor polynomial, in descending order of degree.\n\n    Returns:\n        tuple: (quotient, remainder), where quotient and remainder are lists of coefficients.\n\n    Raises:\n        ValueError: If the divisor is zero or of higher degree than the dividend.\n    \"\"\"\n    # Remove leading zeros\n    while dividend and dividend[0] == 0:\n        dividend = dividend[1:]\n    while divisor and divisor[0] == 0:\n        divisor = divisor[1:]\n\n    # Check for zero division\n    if not divisor:\n        raise ValueError(\"Division by zero polynomial\")\n\n    # Check degrees\n    if len(dividend) < len(divisor):\n        return [], dividend\n\n    # Initialize quotient and remainder\n    quotient = [0] * (len(dividend) - len(divisor) + 1)\n    remainder = dividend.copy()\n\n    # Perform polynomial long division\n    for i in range(len(quotient)):\n        if len(remainder) < len(divisor):\n            break\n        \n        # Compute the next term of the quotient\n        term = remainder[0] // divisor[0]\n        quotient[i] = term\n\n        # Subtract term * divisor from the remainder\n        for j in range(len(divisor)):\n            if j < len(remainder):\n                remainder[j] -= term * divisor[j]\n\n        # Remove leading zero from remainder\n        while remainder and remainder[0] == 0:\n            remainder.pop(0)\n\n    # Remove trailing zeros from quotient\n    while quotient and quotient[-1] == 0:\n        quotient.pop()\n\n    return quotient, remainder","key":"CLKJcLb5PJ"},{"type":"output","id":"iqKZtS3W2Pc_sNp-xQznc","data":[],"key":"D7ClftJnHQ"}],"key":"XFti5AyZ0u"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# Example usage\ndividend = [Fp(1), Fp(0), Fp(-2), Fp(0), Fp(1)]  # x^4 - 2x^2 + 1\ndivisor = [Fp(1), Fp(1)]  # x + 1\n\nquotient, remainder = polynomial_division(dividend, divisor)\n\nprint(\"Dividend:\", dividend)\nprint(\"Divisor:\", divisor)\nprint(\"Quotient:\", quotient)\nprint(\"Remainder:\", remainder)","key":"Ydw5GfTmGO"},{"type":"output","id":"yqhAf6cAEkbSzO7hSO5kv","data":[{"name":"stdout","output_type":"stream","text":"Dividend: [1, 0, 191, 0, 1]\nDivisor: [1, 1]\nQuotient: [1, 192, 192, 1]\nRemainder: []\n"}],"key":"u7oGPtO48Z"}],"key":"zjmgDT5YbX"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X^4 - 2*X^2 + 1)/(X+1)","key":"MA7Cdyv1cJ"},{"type":"output","id":"rNEzkRN7QvSYW7er-3VLR","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"X^3 + 192*X^2 + 192*X + 1","content_type":"text/plain"}}}],"key":"aeA98m9Jkw"}],"key":"WrqRw9PqjW"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10 = KZG10Commitment(G1, G2, 10); ","key":"cFBXuGi4Zk"},{"type":"output","id":"B6T0D52cuZE7U-xuX33rr","data":[],"key":"IopiH3gm6I"}],"key":"Gh70YtCmBD"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.setup(secret_symbol=X0, g1_generator=1, g2_generator=1)\nkzg10.srs\n","key":"sApGmEX3yt"},{"type":"output","id":"Qa9rRV4me3xT_TSZIyDSf","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"[1, X0, X0^2, X0^3, X0^4, X0^5, X0^6, X0^7, X0^8, X0^9, X0^10]","content_type":"text/plain"}}}],"key":"WQpFlormsq"}],"key":"AgwJ8VGSNK"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.h, kzg10.h_s","key":"qdYCHpyzIQ"},{"type":"output","id":"L9QFceGmLKvSwGB0nh31K","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"(1, X0)","content_type":"text/plain"}}}],"key":"nKcT6J1RMp"}],"key":"axudtIKusV"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.commit([3,2,1]), kzg10.commit([3,2,1])","key":"jMwzbVZTCj"},{"type":"output","id":"RjatNYdIp0KDgjl6e-Ayu","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"(Commitment(X0^2 + 2*X0 + 3), Commitment(X0^2 + 2*X0 + 3))","content_type":"text/plain"}}}],"key":"cmqqAHpu11"}],"key":"oys9bdm86j"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 = kzg10.commit([3,2,1]); C0","key":"UO8KW6I1rh"},{"type":"output","id":"x8rHFBim6fTcEMNbbUjq_","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^2 + 2*X0 + 3)","content_type":"text/plain"}}}],"key":"Q6nU0mZ1QR"}],"key":"DLS9KmGG0f"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C1 = kzg10.commit([9,10,11]); C1","key":"Uo62hZlMkZ"},{"type":"output","id":"GPyVf1TyTNDis8x0A8Rox","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"Commitment(11*X0^2 + 10*X0 + 9)","content_type":"text/plain"}}}],"key":"j6YQ3ERMX9"}],"key":"LG8Dz7AL2f"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 + C1","key":"H1nNr43Kn3"},{"type":"output","id":"mvy25iJjM3I47g4JaIzHW","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"text/plain":{"content":"Commitment(12*X0^2 + 12*X0 + 12)","content_type":"text/plain"}}}],"key":"CrXpWUXg5e"}],"key":"PCxqZOSrO6"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"W = kzg10.prove_eval([3,2,1], 91, 167)","key":"b3ozMgsnuN"},{"type":"output","id":"pCLl9BGF-Oo1hb4seq2CF","data":[],"key":"t47NGh9tLL"}],"key":"Juex421mzy"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.verify_eval(C0, W, 91, 167)\n","key":"MA0zHbMZyM"},{"type":"output","id":"bjnpGgDYpCn-fe3csvh0f","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"Ieyk1N9CZ6"}],"key":"sAQ6vTSuM7"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([93,1]) * UniPolynomial([-91, 1]) + UniPolynomial([167])","key":"dzJT3cHzOl"},{"type":"output","id":"l4OyLnSqm81tgeWPAfbP_","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"-8296 + 2x + x^2","content_type":"text/plain"}}}],"key":"lV6cKjulP3"}],"key":"LXayMmCIKi"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def log_2(x):\n    \"\"\"\n    Compute the integer part of the logarithm base 2 of x.\n\n    Args:\n        x (int): The number to compute the logarithm of. Must be a positive integer.\n\n    Returns:\n        int: The floor of the logarithm base 2 of x.\n\n    Raises:\n        ValueError: If x is not a positive integer.\n    \"\"\"\n    if not isinstance(x, int) or x <= 0:\n        raise ValueError(\"x must be a positive integer\")\n    \n    result = 0\n    while x > 1:\n        x >>= 1  # Bit shift right (equivalent to integer division by 2)\n        result += 1\n    return result","key":"xtzyGX6NFS"},{"type":"output","id":"D8ZXrMkV_89iIycIxrQlV","data":[],"key":"M8ixxlzvsU"}],"key":"URNFMdFhpD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"BCHO PCS","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"perDqnwxue"}],"identifier":"bcho-pcs","label":"BCHO PCS","html_id":"bcho-pcs","implicit":true,"key":"wvmvG9ZSpG"}],"key":"tbuEwjgLYi"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"class ProofTranscript:\n    def __init__(self, field):\n        self.field = field\n        self.state = 0  # Initial state\n    \n    def absorb(self, element):\n        \"\"\"\n        Absorb a field element into the transcript.\n        \n        Args:\n            element: A field element to be absorbed. \n        \"\"\"\n        if isinstance(element, int):\n            element = self.field(element)\n        elif isinstance(element, sage.rings.integer.Integer):\n            element = self.field(element)\n        elif isinstance(element, Commitment):\n            element = element.value\n        elif isinstance(element, list):\n            element = sum(element)\n        elif not element.parent() == self.field:\n            raise TypeError(\"Must absorb a field element\")\n        \n        # if not isinstance(element, self.field.Element):\n        #     raise TypeError(\"Must absorb a field element\")\n        \n        # Simple hash function: multiply by a prime and add the element\n        bs = str(element).encode('utf-8')\n        n = int.from_bytes(bs, 'big')\n        self.state = (self.state * int(31) + n) % self.field.order()\n    \n    def squeeze(self):\n        \"\"\"\n        Generate a random field element based on the current state.\n        \n        Returns:\n            A field element.\n        \"\"\"\n        # Use the current state to generate a \"random\" field element\n        self.state = (self.state * 31 + 17) % self.field.order()\n        return self.field(self.state)\n    \n    def clone(self):\n        new = ProofTranscript(self.field)\n        new.state = self.state\n        return new\n","key":"nUpm9elLMW"},{"type":"output","id":"dEHybkMgew4pwB97vx3XG","data":[],"key":"QJWqrISQhJ"}],"key":"euBWwp1lb3"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp(1).parent() == Fp","key":"gE7wtVazEo"},{"type":"output","id":"Z-M0PfRA3NsmrSx80yiKp","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"K3eidU6nIS"}],"key":"Lj3e7lmhV5"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(30)","key":"e6vTE0XMFF"},{"type":"output","id":"R94Rzm9_DLlOFjtPyXbNN","data":[{"output_type":"execute_result","execution_count":34,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.integer.Integer'>","content_type":"text/plain"}}}],"key":"XjPmbqy0Xn"}],"key":"rcU5wlYuvr"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"    \ntranscript = ProofTranscript(Fp)\n\n# Absorb some elements\ntranscript.absorb(10)\ntranscript.absorb(20)\n\n# Squeeze some randomness\nr1 = transcript.squeeze()\nr2 = transcript.squeeze()\n\nprint(f\"Random element 1: {r1}\")\nprint(f\"Random element 2: {r2}\")\n\n# Absorb more elements\ntranscript.absorb(30)\n\n# Squeeze more randomness\nr3 = transcript.squeeze()\n\nprint(f\"Random element 3: {r3}\")","key":"wpRiXXpFF1"},{"type":"output","id":"DfAZRh8LpGYrJ6Gmcclid","data":[{"name":"stdout","output_type":"stream","text":"Random element 1: 151\nRandom element 2: 66\nRandom element 3: 98\n"}],"key":"BlhJcoZjzt"}],"key":"RtAT9Ix3Lj"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_naive(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert coeffs == [Fp(v)]\n    assert len(coeffs) == 1\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        evals_pos.append(uni_eval_from_coeffs(poly, r))\n        evals_neg.append(uni_eval_from_coeffs(poly, (-1) * r))\n        evals_sq.append(uni_eval_from_coeffs(poly, r^2))\n    \n    \n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq)","key":"KGSNBO1mg9"},{"type":"output","id":"bGKNmqOYx2yW_a4P4Xwfe","data":[],"key":"Sob4bAoKqE"}],"key":"t2OFU22uot"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_naive(C, arg, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    arg: argument to be verified\n    point: evaluation point\n    v: evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    r = transcript.squeeze()\n    \n    evals_sq.append(v)\n    verified = True\n    # Verify evaluations\n    for i in range(k):\n        b = evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)\n        print(\"i={}, {}\".format(i, b))\n        verified = verified and b\n    if verified:\n        print(\"✅ Verified!\")\n    return verified\n","key":"xbicXzxshM"},{"type":"output","id":"f12ro2BI1zv3jieKdr81e","data":[],"key":"yo1fZmDqzp"}],"key":"r6aV7vduSG"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"transcript = ProofTranscript(Fp); transcript.state","key":"ODV9G5MwqD"},{"type":"output","id":"gMyRhDu-jVgXkqO7aEpb4","data":[{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"0","content_type":"text/plain"}}}],"key":"TN4rkgYOi0"}],"key":"BZK1yh8GhG"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"ff = [1, 3, 2, 1]\nff_cm = kzg10.commit(ff)\nff_cm","key":"pPA9z5jRDI"},{"type":"output","id":"12aA8UFo77bPcP6Cx9Rvy","data":[{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)","content_type":"text/plain"}}}],"key":"if8iHlctvp"}],"key":"Oghe3ugFmC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_naive(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone())","key":"V4aVM1DTSY"},{"type":"output","id":"7Pz_fjFd5tVhLaFoisnK8","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81), Commitment(-70)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93], [123]]\ncoeffs= [123]\nr= 174\ni=0, True\ni=1, True\n"}],"key":"bwyT4ByNRi"}],"key":"oxj2A6MFgJ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([81, 93], 150)","key":"SVKQDIqyfL"},{"type":"output","id":"100Wsed1wdfEx_wgu2GEp","data":[{"output_type":"execute_result","execution_count":41,"metadata":{},"data":{"text/plain":{"content":"135","content_type":"text/plain"}}}],"key":"yYJuSjJRjG"}],"key":"v0iFlUZbuR"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_naive(ff_cm, arg, point=[91, 181], v=123, transcript=ProofTranscript(Fp))","key":"VcQsFgAwMJ"},{"type":"output","id":"BKYV0glr3DoIWuXRlu1dG","data":[{"name":"stdout","output_type":"stream","text":"i=0, True\ni=1, True\n✅ Verified!\n"},{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"bcQZX4pXgn"}],"key":"ZTpVOFh9Vv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimized version","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IHlfchDTtx"}],"identifier":"optimized-version","label":"Optimized version","html_id":"optimized-version","implicit":true,"key":"jb08ft9O2g"}],"key":"HKQXqhb6ve"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert Fp(v) == coeffs[0] + point[k-1] * coeffs[1]\n    assert len(coeffs) == 2\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_r = uni_eval_from_coeffs(poly, r)\n        poly_at_neg_r = uni_eval_from_coeffs(poly, (-1) * r)\n        poly_at_r_sq = uni_eval_from_coeffs(poly, r^2)\n        evals_pos.append(poly_at_r)\n        evals_neg.append(poly_at_neg_r)\n        evals_sq.append(poly_at_r_sq)\n        transcript.absorb(poly_at_r)\n        transcript.absorb(poly_at_neg_r)\n        transcript.absorb(poly_at_r_sq)\n    \n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n    \n    gamma = transcript.squeeze()\n    # gamma = 1\n    print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_r = uni_eval_from_coeffs(h_agg, r)\n    h_agg_poly_at_neg_r = uni_eval_from_coeffs(h_agg, -r)\n    h_agg_poly_at_r_sq = uni_eval_from_coeffs(h_agg, r^2)\n\n    print(\"h_agg_poly_at_r={}, h_agg_poly_at_neg_r={}, h_agg_poly_at_r_sq={}\".format(h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq))\n\n    # DEBUG: verify h_agg\n    assert h_agg_poly_at_r == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n\n\n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"dbg_evals_sq[i+1]={}, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])={}\".format(dbg_evals_sq[i+1], (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq], [r, -r, r^2])\n    print(\"interp_poly=\", interp_poly)\n    vanishing_poly = UniPolynomial([-r, 1])*UniPolynomial([r, 1]) * UniPolynomial([-r*r, 1])\n    print(\"vanishing_poly=\", vanishing_poly)\n\n    h_agg_poly = UniPolynomial(h_agg)\n\n    quo_poly, rem = divmod(h_agg_poly-interp_poly, vanishing_poly)\n    print(\"quo={}, rem={}\".format(quo_poly, rem))\n    # assert rem == UniPolynomial([0])\n    print(\"quo_poly={}\".format(quo_poly))\n    \n    g_poly = h_agg_poly - interp_poly\n    print(\"g_poly=\", g_poly.coeffs)\n    print(\"rem={}\".format(g_poly % vanishing_poly))\n    print(\"quo={}\".format(g_poly // vanishing_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))=\", quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, arg_r_poly_at_zeta)","key":"xreKrORT9L"},{"type":"output","id":"6JZ_Wm9Gmd93prGYrrwZJ","data":[],"key":"TSiA3zKyT1"}],"key":"Qtrov93ojY"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt(C, arg, point, v, transcript):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    print(\"C=\", C)\n\n    print(\"arg=\", arg)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        transcript.absorb(evals_sq[i])\n    \n    gamma = transcript.squeeze()\n    print(\"gamma=\", gamma)\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n    print(\"Ch=\", Ch)\n    \n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n    print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # vanishing_poly = UniPolynomial([-beta, h_agg_poly_at_beta]) * UniPolynomial([beta, h_agg_poly_at_neg_beta]) * UniPolynomial([-beta*beta, h_agg_poly_at_beta_sq])\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"Cr=\", Cr)\n    print(\"Cq=\", Cq)\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    if not kzg10.verify_eval(Cr, Cw, point=zeta, v=0):\n        return False\n\n    # Verify evaluations\n    evals_sq = evals_sq + [v]\n    for i in range(k):\n        if evals_sq[i+1] != (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*beta):\n            return False\n\n    return True","key":"K6pdsmMRks"},{"type":"output","id":"y8jL8eyiWc_OiGKwoJQfk","data":[],"key":"lEDPJNAPMG"}],"key":"ewiZmlD5o8"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([46, 25, 25, 1], [123, 128, 170])","key":"npgmWBSy3N"},{"type":"output","id":"QmVvTbU3xCZ_f6rOomg21","data":[{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/plain":{"content":"([126, 151], [181, 64])","content_type":"text/plain"}}}],"key":"AJcNup8owQ"}],"key":"TXC0EMfuc2"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([126, 151]) * UniPolynomial([123, 128, 170]) + UniPolynomial([181, 64])","key":"RldAiEAAO3"},{"type":"output","id":"NyqMKmNzF5kMYN6-ZMnUw","data":[{"output_type":"execute_result","execution_count":46,"metadata":{},"data":{"text/plain":{"content":"15679 + 34765x + 40748x^2 + 25670x^3","content_type":"text/plain"}}}],"key":"Go39cG3SfN"}],"key":"xlvrxZYJGn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod( UniPolynomial([46, 25, 25, 1]),  UniPolynomial([123, 128, 170]))","key":"J3iD6hil6k"},{"type":"output","id":"_EgxjmIzibV4Way0ZF8zV","data":[{"output_type":"execute_result","execution_count":47,"metadata":{},"data":{"text/plain":{"content":"(126 + 151x, 181 + 64x)","content_type":"text/plain"}}}],"key":"NSO1PhyOPC"}],"key":"D4Nn62nKjs"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([46, 25, 25, 1]) % UniPolynomial([123, 128, 170])","key":"mAl5cRM9QS"},{"type":"output","id":"BvJo8OJZxsyUkkBWcrHer","data":[{"output_type":"execute_result","execution_count":48,"metadata":{},"data":{"text/plain":{"content":"181 + 64x","content_type":"text/plain"}}}],"key":"vs9RryN52R"}],"key":"bmGZDnBe0d"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(ff_cm)","key":"QcgRwWEuVl"},{"type":"output","id":"nNP766KhJ5TdheeB6Nl-r","data":[{"output_type":"execute_result","execution_count":49,"metadata":{},"data":{"text/plain":{"content":"<class 'kzg10.Commitment'>","content_type":"text/plain"}}}],"key":"DxxNHwCux3"}],"key":"sRaWIx9dyx"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone()); arg","key":"ckSoO3TqPq"},{"type":"output","id":"OTfGpM71S5KH8DEs7hsOz","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\ncoeffs= [81, 93]\nr= 177\nevals_pos= [36, 137]\nevals_neg= [25, 25]\nevals_sq= [134, 150]\ngamma= 107\nh_agg= [176, 111, 2, 1]\nh_agg_poly_at_r=27, h_agg_poly_at_neg_r=191, h_agg_poly_at_r_sq=165\ndbg_evals_sq[i+1]=150, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=150\ni=0, True\ndbg_evals_sq[i+1]=123, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=123\ni=1, True\ninterp_poly= 67 + 174x + 65x^2\nvanishing_poly= 109 + 130x + 130x^2 + x^3\nquo=1, rem=0\nquo_poly=1\ng_poly= [109, 130, 130, 1]\nrem=0\nquo=1\nzeta=143\ninterp_at_zeta=46\nh_agg_poly - UniPolynomial([interp_at_zeta])= 130 + 111x + 2x^2 + x^3\nquo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))= 30\nr_poly= 100 + 111x + 2x^2 + x^3\nr(zeta)=0\n"},{"output_type":"execute_result","execution_count":50,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [36, 137],\n [25, 25],\n [134, 150],\n Commitment(1),\n Commitment(X0^2 - 48*X0 + 2))","content_type":"text/plain"}}}],"key":"eKyfy2ix73"}],"key":"H37nbtFjSQ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone())","key":"BkwNPX4Mlj"},{"type":"output","id":"47YgrynWPryGO2XB0gv19","data":[{"name":"stdout","output_type":"stream","text":"C= Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)\narg= ([Commitment(93*X0 + 81)], [36, 137], [25, 25], [134, 150], Commitment(1), Commitment(X0^2 - 48*X0 + 2))\nbeta= 177\ngamma= 107\nCh= Commitment(X0^3 + 2*X0^2 - 82*X0 - 17)\nh_agg_poly_at_beta=27, h_agg_poly_at_neg_beta=191, h_agg_poly_at_beta_sq=165\nzeta=143\ninterp_at_zeta=46\nCr= Commitment(X0^3 + 2*X0^2 - 82*X0 - 93)\nCq= Commitment(1)\n"},{"output_type":"execute_result","execution_count":51,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"sIF4qemELn"}],"key":"zQzm4NV7fZ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"gamma=50\n(X0^3 + 2*X0^2 + 3*X0 + 1) + (93*X0 + 81) * gamma ","key":"Xfwj3EnG5j"},{"type":"output","id":"qdzbzgsOluBade10YLKEN","data":[{"output_type":"execute_result","execution_count":52,"metadata":{},"data":{"text/plain":{"content":"X0^3 + 2*X0^2 + 21*X0 - 2","content_type":"text/plain"}}}],"key":"X0zZrRRR6u"}],"key":"ryDUqJ45X5"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([1, 3, 2, 1], 174), uni_eval_from_coeffs([81, 93], 174)","key":"R7vnxqfeMt"},{"type":"output","id":"xTJWT9O0odhfrGAK_fQZT","data":[{"output_type":"execute_result","execution_count":53,"metadata":{},"data":{"text/plain":{"content":"(176, 51)","content_type":"text/plain"}}}],"key":"MiYQFIPQNi"}],"key":"cQEwVasKPb"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(transcript.squeeze())","key":"rF4AMMOC9Q"},{"type":"output","id":"i94m-Sd6T6pPFCLdhbv5O","data":[{"output_type":"execute_result","execution_count":54,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.finite_rings.integer_mod.IntegerMod_int'>","content_type":"text/plain"}}}],"key":"NcotBJQ1rP"}],"key":"dljyCaLQ71"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"","key":"b9SrFzoGvG"},{"type":"output","id":"gG51maD9i1PBI0jSvXWI9","data":[],"key":"LrRzft1TG1"}],"key":"wJRH3sFghH"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 + f2\nf3","key":"a7vnVNzap3"},{"type":"output","id":"6WbIktD72toDo4gyNdJgU","data":[{"output_type":"execute_result","execution_count":55,"metadata":{},"data":{"text/plain":{"content":"5 + 7x + 9x^2","content_type":"text/plain"}}}],"key":"TfzQ1pIPD9"}],"key":"R7E9ZXvPnw"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 * f2\nf3","key":"qiEN9OoJJ0"},{"type":"output","id":"yEX0P6ofYWx8MnQZoeTba","data":[{"output_type":"execute_result","execution_count":56,"metadata":{},"data":{"text/plain":{"content":"4 + 13x + 28x^2 + 27x^3 + 18x^4","content_type":"text/plain"}}}],"key":"pzHoVtMiwi"}],"key":"u4zQgKxCpI"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def poly(cof):\n    return sum([cof[i] * X^i for i in range(len(cof))])\n\npoly([1, 2, 3])\n","key":"uvyw24xCzi"},{"type":"output","id":"sRjE5Gx6WbbHYekXGo7xg","data":[{"output_type":"execute_result","execution_count":57,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"DHdaXvQdl9"}],"key":"l7FpCya5cK"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"poly([1, 2, 3]) * poly([4, 5, 6])","key":"UCWlv7ryS6"},{"type":"output","id":"nRn7ZDbtp1Iq5LaS7YUIt","data":[{"output_type":"execute_result","execution_count":58,"metadata":{},"data":{"text/plain":{"content":"18*X^4 + 27*X^3 + 28*X^2 + 13*X + 4","content_type":"text/plain"}}}],"key":"aEay7DKuTZ"}],"key":"c2BGmV3HAT"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5])\ndivmod(f1, f2)","key":"gAWWmhCdtO"},{"type":"output","id":"dxtXHkYP9lufAT865_9kH","data":[{"output_type":"execute_result","execution_count":59,"metadata":{},"data":{"text/plain":{"content":"(108 + 155x, 148)","content_type":"text/plain"}}}],"key":"VkYBBvp0An"}],"key":"ryZWnDmpag"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(155*X + 108) * poly([4, 5]) + poly([148])","key":"pPnYRhVJo6"},{"type":"output","id":"8Q1S8d3KmVV-1faslNrAk","data":[{"output_type":"execute_result","execution_count":60,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"lBRWzbcAFX"}],"key":"nw1mQeV3rC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 = UniPolynomial.vanishing_polynomial([Fp(1), Fp(2), Fp(3), Fp(4)]); z4","key":"zb6RAPzv3r"},{"type":"output","id":"oWlnDdPDmHNIFSoIijLUn","data":[{"output_type":"execute_result","execution_count":61,"metadata":{},"data":{"text/plain":{"content":"24 + 143x + 35x^2 + 183x^3 + x^4","content_type":"text/plain"}}}],"key":"W9TDXv76Wr"}],"key":"eFDHmB5nob"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 // (UniPolynomial([-1, 1])), z4 % (UniPolynomial([-1, 1]))","key":"HjuFi1kOsX"},{"type":"output","id":"JReIEt0lwcdjohIvI1nFh","data":[{"output_type":"execute_result","execution_count":62,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"oH75nNqFsL"}],"key":"ZwWByHLXlC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4.division_by_linear_divisor(Fp(1))","key":"KVC2PNu4xS"},{"type":"output","id":"1vhDkMMtd7R-cLFcwC1cP","data":[{"output_type":"execute_result","execution_count":63,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"pcbzfQi3f2"}],"key":"iL8cqm932u"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))","key":"i6oJTh6RaJ"},{"type":"output","id":"YJlzFDGNGF16vxGRpBBjg","data":[{"output_type":"execute_result","execution_count":64,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"mIckzQ3i8A"}],"key":"sNkw9vwKnL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([24, 143, 35, 183, 1], [Fp(-1), Fp(1)])","key":"jfhyHOG5kh"},{"type":"output","id":"THQRrLqDz9TaZPjPt2Ztg","data":[{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"text/plain":{"content":"([169, 26, 184, 1], [])","content_type":"text/plain"}}}],"key":"s1ZdAYKXPM"}],"key":"KCfCAwYSdZ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))\n","key":"D7DbTnjuE8"},{"type":"output","id":"wLxMFvYHl8tskj3AFERfP","data":[{"output_type":"execute_result","execution_count":66,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"tEkUKm1iaQ"}],"key":"qlrCsHuJph"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X-1)*(X-2)*(X-3)*(X-4)","key":"JFXzqrI8oD"},{"type":"output","id":"sLIisOaoIUqUlCVXqX_UT","data":[{"output_type":"execute_result","execution_count":67,"metadata":{},"data":{"text/plain":{"content":"X^4 + 183*X^3 + 35*X^2 + 143*X + 24","content_type":"text/plain"}}}],"key":"H21hqI3LBa"}],"key":"w8RrkjbrEn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.compute_coeffs_from_evals_fast([5, 3, 2, 4], [1, 2, 3, 4]); cof","key":"Ahvx22bQaU"},{"type":"output","id":"RxupjIrxE1QZcbTfHE_Sm","data":[{"output_type":"execute_result","execution_count":68,"metadata":{},"data":{"text/plain":{"content":"[6, 161, 95, 129]","content_type":"text/plain"}}}],"key":"CtEfx82auw"}],"key":"iE1w7CHSgw"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"[poly(cof).subs(X=i+1) for i in range(4)]","key":"pMUroHyzfc"},{"type":"output","id":"0AuMUiklrS8hY23afoKsR","data":[{"output_type":"execute_result","execution_count":69,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"aASqUbvGC0"}],"key":"wXN17MmaGS"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.compute_evals_from_coeffs_fast(cof, [1, 2, 3, 4])","key":"JS2lbBnUTR"},{"type":"output","id":"mTwNTZT9FZ2mWlcvXdQEY","data":[{"output_type":"execute_result","execution_count":70,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"iKsfhe6r4l"}],"key":"jJZRcpKMBH"},{"type":"block","kind":"notebook-content","children":[],"key":"MOFXcL3ARL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.ntt_coeffs_from_evals([5, 3, 2, 4], 2, H4[1]); cof","key":"Vwfpi5cuUs"},{"type":"output","id":"jPkCuSs3mHll89ov0mHAr","data":[{"output_type":"execute_result","execution_count":71,"metadata":{},"data":{"text/plain":{"content":"[100, 77, 0, 21]","content_type":"text/plain"}}}],"key":"E9fty2JmYk"}],"key":"fQkfW9J2oY"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.ntt_evals_from_coeffs(cof, 2, H4[1])","key":"WnlPrJE6Qn"},{"type":"output","id":"GOiKX3ABpl86AS-q0W1oP","data":[{"output_type":"execute_result","execution_count":72,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"q1ciNWdoeq"}],"key":"eV11c1SjmT"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e77dnbX20H"}],"identifier":"optimization","label":"Optimization","html_id":"optimization","implicit":true,"key":"SHNFQTDGlX"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Prover doesn’t need to send ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OMaYk90KTr"},{"type":"inlineMath","value":"h^{(i)}(\\beta^2)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup><mo stretchy=\"false\">(</mo><msup><mi>β</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h^{(i)}(\\beta^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.138em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"Veyoc1UlDJ"}],"key":"o8xoR5l7xi"}],"key":"fLze9fvCQw"}],"key":"nJUKASu1of"}],"key":"skMoMdF0CS"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"## Interpolate two points into a polynomial and evaluate it at X=r\n#\n#   f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n#\n#   f(r) = (a+b)/2 + r * (a-b) / (2*x)\n#\n# \n#(evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n\ndef interp_and_eval_line(a, b, r, x):\n    \"\"\"\n    Interpolate two points into a polynomial and evaluate it at X=r\n\n        f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n\n        f(r) = (a+b)/2 + r * (a-b) / (2*x)\n    Args:\n        a (int): The evaluation at -x\n        b (int): The evaluation at x\n        r (int): The point at which to evaluate the polynomial\n        x (int): The x-coordinate of the point\n\n    Returns:\n        int: The result of evaluating the polynomial at X=r\n    \"\"\"\n    return ((a + b) / 2 + r * (a - b) / (2 * x))","key":"sJXUrzdUgs"},{"type":"output","id":"LPwpKrRjtlqsKUnaJIt4H","data":[],"key":"ZxVlZaKmSN"}],"key":"g7P59svTFm"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt_opt(C, f, point, v, transcript, debug=0):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    if debug > 0: \n        coeffs = [coeffs[i] + point[k-1] * coeffs[i+1] for i in range(0, len(coeffs), 2)]\n        print(\"check: fully folded polynomial must be equal to the claimed evaluation: {} = {}\".format(coeffs[0], v))\n        assert (coeffs[0] == v)\n        assert len(coeffs) == 1\n        print(\"coeffs=\", coeffs)\n        print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n        print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n\n    # Sample randomness and reply evaluations\n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n    evals_pos = []\n    evals_neg = []    \n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_beta = uni_eval_from_coeffs(poly, beta)\n        poly_at_neg_beta = uni_eval_from_coeffs(poly, (-1) * beta)\n        poly_at_beta_sq = uni_eval_from_coeffs(poly, beta^2)\n        evals_pos.append(poly_at_beta)\n        evals_neg.append(poly_at_neg_beta)\n        evals_sq.append(poly_at_beta_sq)\n        transcript.absorb(poly_at_beta)\n        transcript.absorb(poly_at_neg_beta)\n\n    transcript.absorb(evals_sq[0])\n\n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n\n    gamma = transcript.squeeze()\n    \n    if debug > 0: \n        print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    if debug > 1: \n        print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_beta = uni_eval_from_coeffs(h_agg, beta)\n    h_agg_poly_at_neg_beta = uni_eval_from_coeffs(h_agg, -beta)\n    h_agg_poly_at_beta_sq = uni_eval_from_coeffs(h_agg, beta^2)\n\n    if debug > 1: \n        print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # DEBUG: verify h_agg\n    if debug > 0:\n        print(\"check: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\")\n        assert h_agg_poly_at_beta == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_neg_beta == sum([evals_neg[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_beta_sq == sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    # DEBUG: verify evaluations\n    if debug > 0:\n        dbg_evals_sq = evals_sq[:] + [v]\n        print(\"dbg_evals_sq=\", dbg_evals_sq)\n        for i in range(k):\n            print(\"check: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\")\n            print(\"i={}, {}, {}\".format(i, \n                dbg_evals_sq[i+1], interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta)))\n\n    h_agg_poly = UniPolynomial(h_agg)\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], [beta, -beta, beta^2])\n    vanishing_poly = UniPolynomial([-beta, 1])*UniPolynomial([beta, 1]) * UniPolynomial([-beta*beta, 1])\n    g_poly = h_agg_poly - interp_poly\n    quo_poly, rem = divmod(g_poly, vanishing_poly)\n\n    if debug > 0:\n        # assert rem == UniPolynomial([0])\n        pass\n\n    if debug > 1:\n        print(\"interp_poly=\", interp_poly)\n        print(\"vanishing_poly=\", vanishing_poly)    \n        print(\"quo={}, rem={}\".format(quo_poly, rem))\n        print(\"quo_poly={}\".format(quo_poly))\n        print(\"rem={}\".format(rem))\n        print(\"quo={}\".format(quo_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))=\", quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    if debug > 0:\n        print(\"check: `r(z)=0` argument must hold\")\n        assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq[:1], Cq, arg_r_poly_at_zeta)","key":"YFUnMnfzsm"},{"type":"output","id":"SHtx5WhBuSeUzBSm-sZ3t","data":[],"key":"ZwrlopZ80e"}],"key":"F4EmcBZjVr"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt_opt(C, arg, point, v, transcript, debug=0):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    if debug > 1:\n        print(\"C={}, arg={}, point={}, v={}\".format(C, arg, point, v))\n\n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    if debug > 1:\n        print(\"> beta = {}\".format(beta))\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        evals_sq.append(interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta))\n    transcript.absorb(evals_sq[0])\n\n    if debug > 1:\n        print(\"> evals_sq = {}\".format(evals_sq))\n    \n    # 1st check:\n    if debug > 0:\n        print(\"🛡️: check if the evaluation f({})={} is correct\".format(point, v))\n        print(\"    by computing the folded polynomial h_{}({}^2) ?= {}\".format(k, beta, v))\n        if (evals_sq[-1] == v): \n            print(\"😀 ✅\")\n    if not (evals_sq[-1] == v):\n        return False\n    \n    gamma = transcript.squeeze()\n    if debug > 1:\n        print(\"> gamma = {}\".format(gamma))\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n\n    if debug > 1:\n        print(\"> Commitment of h(X): Ch={}\".format(Ch))\n    \n    # Compute h_agg(beta), h_agg(-beta), h_agg(beta^2)\n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    if debug > 1:\n        print(\"> h_agg_poly_at_beta={}\".format(h_agg_poly_at_beta))\n        print(\"> h_agg_poly_at_neg_beta={}\".format(h_agg_poly_at_neg_beta))\n        print(\"> h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta_sq))\n\n    # Interpolate c(X) from three points: \n    #\n    #    [(beta, h_agg(beta)), (-beta, h_agg(-beta)), (beta^2, h_agg(beta^2))]\n\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    # h_agg(X) - c(X) = q(X) * (X-beta)(X+beta)(X-beta^2)\n    # \n    # Receive Cq = Commit(c(X)) \n    transcript.absorb(Cq)\n\n    # Sample randomness\n    zeta = transcript.squeeze()\n\n    if debug > 1:\n        print(\"> zeta = {}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    vanishing_poly_at_zeta = ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * vanishing_poly_at_zeta\n\n    if debug > 1:\n        print(\"> Cr={}\".format(Cr))\n        print(\"> Cq={}\".format(Cq))\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    \n    # 2. Check if r(z)=0\n    Cw_verified = kzg10.verify_eval(Cr, Cw, point=zeta, v=0)\n\n    if debug > 0:\n        if Cw_verified: print(\"🛡️: check if r(z)=0 😀 ✅\")\n        else: print(\"🛡️: check if r(z)=0 😢 ❌\")\n\n    if not Cw_verified:\n        return False\n\n    return True","key":"A0kRZuqYgV"},{"type":"output","id":"CtP5o_FSSYhoa8SvJvLoy","data":[],"key":"vNbwSS5MY1"}],"key":"g93fA8hkup"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt_opt(ff_cm, [1, 3, 2, 1], \n            point=[91, 181], v=123, transcript=transcript.clone(), debug=1); arg","key":"VbbWQtljQk"},{"type":"output","id":"KrI287zLXpL2EYdLHrOdJ","data":[{"name":"stdout","output_type":"stream","text":"check: fully folded polynomial must be equal to the claimed evaluation: 123 = 123\ncoeffs= [123]\nh_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\nbeta= 117\nevals_pos= [37, 154]\nevals_neg= [102, 8]\nevals_sq= [116, 130]\ngamma= 103\ncheck: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\ndbg_evals_sq= [116, 130, 123]\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=0, 130, 130\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=1, 123, 123\nzeta=159\ninterp_at_zeta=152\nh_agg_poly - UniPolynomial([interp_at_zeta])= 86 + 125x + 2x^2 + x^3\nquo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))= 146\nr_poly= 133 + 125x + 2x^2 + x^3\nr(zeta)=0\ncheck: `r(z)=0` argument must hold\n"},{"output_type":"execute_result","execution_count":76,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [37, 154],\n [102, 8],\n [116],\n Commitment(1),\n Commitment(X0^2 - 32*X0 + 55))","content_type":"text/plain"}}}],"key":"E2SD3dlnmE"}],"key":"VBrakJcDUA"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone(), debug=1)","key":"wuqYT78YVX"},{"type":"output","id":"wpxT0QD_w5LfxC1jAntv6","data":[{"name":"stdout","output_type":"stream","text":"🛡️: check if the evaluation f([91, 181])=123 is correct\n    by computing the folded polynomial h_2(117^2) ?= 123\n😀 ✅\ninterp_at_zeta=152\n🛡️: check if r(z)=0 😀 ✅\n"},{"output_type":"execute_result","execution_count":77,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"u39UDu1Lhw"}],"key":"DnTfoKDZ8b"}],"key":"UGeROl6I0o"},"references":{"cite":{"order":[],"data":{}}}}