{"version":2,"kind":"Notebook","sha256":"9de0aaef11366a3e7711ab4673207967e4c1569a1ce5714c5da22d1d3d0f69cc","slug":"src.bcho-pcs","location":"/src/bcho_pcs.ipynb","dependencies":[],"frontmatter":{"title":"BCHO PCS","content_includes_title":false,"kernelspec":{"name":"sagemath-10.4","display_name":"SageMath 10.4","language":"sage"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/executablebooks/jupyter-book/blob/main/src/bcho_pcs.ipynb","exports":[{"format":"ipynb","filename":"bcho_pcs.ipynb","url":"/bcho_pcs-5a2ca9078234ed554e223fbe629356e4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"from group import DummyGroup\nfrom utils import log_2, pow_2\nfrom unipolynomial import UniPolynomial\nfrom mle2 import MLEPolynomial\nfrom kzg10 import Commitment, KZG10Commitment","key":"Jq5a4bTVRp"},{"type":"output","id":"si5xbIYRcgnfBb0fH-YAO","data":[],"key":"reb6zIrqCD"}],"key":"vpb8m1vbi8"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"F193.<a> = GF(193)\nR193.<X> = F193[]\nR193\nFp=F193\nFp","key":"TVmB8c7j3e"},{"type":"output","id":"I2cYqPqvviCLBpUQTg-0F","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"Finite Field of size 193","content_type":"text/plain"}}}],"key":"xftD5hSd7a"}],"key":"SWOGGEqns1"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.set_scalar(Fp(0), Fp)\nCommitment.set_scalar(Fp(0))","key":"BDWrxPF55M"},{"type":"output","id":"ElmtrVi8EGDC4Vs0BDVvb","data":[],"key":"Ld8yKEoaUV"}],"key":"V8uv9SKO08"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# For symbolic calculation\n\nR_2.<X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2> = Fp[]; R_2","key":"LcDmBOr4Ad"},{"type":"output","id":"6Q4SPhpEwtBlPCKg_UDtJ","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"Multivariate Polynomial Ring in X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2 over Finite Field of size 193","content_type":"text/plain"}}}],"key":"BMLjtp1zZI"}],"key":"Yl6PU27yIM"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp2 = Fp.extension(2, 'b'); Fp2","key":"aqRQX2Q9HS"},{"type":"output","id":"v8A5pYGT_xygzGKrI52Zy","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"Finite Field in b of size 193^2","content_type":"text/plain"}}}],"key":"ir864wOis9"}],"key":"dmDVkm2Zfc"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"omega = Fp.primitive_element()^3; omega, omega^64 == 1, omega^32 == -1","key":"zspFNf1Lf2"},{"type":"output","id":"CZ__JuqihTb7oo7FWoceE","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"(125, True, True)","content_type":"text/plain"}}}],"key":"Pl7sNoN5Uv"}],"key":"y7z9xcy1TQ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H16 = [(omega^4)^i for i in range(16)]; H16","key":"sIKHfkaJVV"},{"type":"output","id":"tnT2-9AUNJCbmz26BKwCG","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"[1, 64, 43, 50, 112, 27, 184, 3, 192, 129, 150, 143, 81, 166, 9, 190]","content_type":"text/plain"}}}],"key":"Q887coVOSh"}],"key":"X35d9kglaT"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H8 = [(omega^8)^i for i in range(8)]; H8","key":"wjFMLM3fv6"},{"type":"output","id":"uK5EQ-xEDd_4eJi62prX_","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"[1, 43, 112, 184, 192, 150, 81, 9]","content_type":"text/plain"}}}],"key":"J2CJDsU3Ig"}],"key":"RV8MKI8PKv"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H4 = [(omega^16)^i for i in range(4)]; H4","key":"OWeHpiiIxY"},{"type":"output","id":"S59PHqrgaS6WHy-bXQwN7","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"[1, 112, 192, 81]","content_type":"text/plain"}}}],"key":"huj2kmxUlX"}],"key":"qjmOoIlrrn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1 = DummyGroup(Fp)\nG1.generator(), G1.exp(2, 3), G1.order(), ","key":"L7CW7uMyI0"},{"type":"output","id":"-dzzxziuUI-KhHjWD2jFJ","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"(5, 6, 193)","content_type":"text/plain"}}}],"key":"c9UZnbPRsT"}],"key":"Sxxs5QAlE9"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1.exp(X1, 3)","key":"ynZLIjJnWe"},{"type":"output","id":"tl04cau0KfcTWGIZ7luK4","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"3*X1","content_type":"text/plain"}}}],"key":"RJMTWATzrf"}],"key":"mK2f18pDTJ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G2 = DummyGroup(Fp2)\nFp2.random_element()\nG2.generator(), G2.exp(G2.generator(), 3), G2.order(), G2.field.polynomial()","key":"FCCxIWFFj3"},{"type":"output","id":"Ou2tQZYtuBtpmgJKKKOAx","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"(b, 3*b, 37249, b^2 + 192*b + 5)","content_type":"text/plain"}}}],"key":"euwqRwUqKU"}],"key":"aeYUA65PWr"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def is_power_of_two(n):\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    if n == 2**(k-1):\n        return True\n    else:\n        return False\n\ndef next_power_of_two(n):\n    assert n >= 0, \"No negative integer\"\n    if is_power_of_two(n):\n        return n\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    return k\n\nis_power_of_two(15), next_power_of_two(15)","key":"Jf3lRmto5b"},{"type":"output","id":"4QecMvbD36oQ8JwmEdU19","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"(False, 4)","content_type":"text/plain"}}}],"key":"vkoTO2jWxL"}],"key":"J1LmbFLd9l"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def bits_le_with_width(i, width):\n    if i >= 2**width:\n        return \"Failed\"\n    bits = []\n    while width:\n        bits.append(i % 2)\n        i //= 2\n        width -= 1\n    return bits\n        \nbits_le_with_width(6, 5)\n","key":"gGXIPxxjT6"},{"type":"output","id":"3wndHyaWT_6pQyqU4LF7n","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"[0, 1, 1, 0, 0]","content_type":"text/plain"}}}],"key":"cydx8lBYin"}],"key":"jWeTQxVs5x"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Polynomial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VCU0v38AW9"}],"identifier":"polynomial","label":"Polynomial","html_id":"polynomial","implicit":true,"key":"kODfM2gmV9"}],"key":"Hm4fXP87Nk"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# \n#  m = [1]\n#  m = [1] + [1 * X0, 1 * X1]\n#  m = m + [1 * X0^2, 1 * X0 * X1, 1 * X1]\ndef mle_eval_from_coeffs(f_coeffs, point):\n    k = len(point)\n    n = len(f_coeffs)\n    assert len(f_coeffs) == 1 << k\n    \n    e = Fp(0)\n    for i in range(n):\n        i_bits = bits_le_with_width(i, k)\n        monomial = product([point[j] if i_bits[j] == 1 else 1 for j in range(k)])\n        e += f_coeffs[i] * monomial\n    \n    return e\n\nmle_eval_from_coeffs([1, 3, 2, 1], [91, 181]) == Fp((1 + 3*X0 + 2*X1 + 1*X0*X1)(X0=91, X1=181))","key":"rHLJ2yLcYE"},{"type":"output","id":"zbnft-oVpFjv6MtT06Ou5","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"kQNQE6mvvo"}],"key":"TBnzOzmBnG"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"mle_eval_from_coeffs([1, 3, 2, 1], [X0, X1])","key":"nn7ZgLWjcT"},{"type":"output","id":"bzpXDBbMwKQuwWsRwetuA","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"X0*X1 + 3*X0 + 2*X1 + 1","content_type":"text/plain"}}}],"key":"NMVvhhwr3p"}],"key":"fVlgU5z4fK"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def uni_eval_from_coeffs(coeffs, z):\n    t = Fp(1)\n    eval = Fp(0)\n    for i in range(0, len(coeffs)):\n        eval += coeffs[i] * t\n        t *= z\n    return eval\n\nuni_eval_from_coeffs([1, 3, 2, 1], 91) == Fp(1 + 3*91 + 2*91^2 + 1*91^3) == Fp(144)","key":"Bhh21OMECf"},{"type":"output","id":"oawOgaV5Wdpc8pylqp-gR","data":[{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"iXLftFyox9"}],"key":"uviDCOAQz0"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def polynomial_division(dividend, divisor):\n    \"\"\"\n    Perform univariate polynomial division.\n\n    Args:\n        dividend (list): Coefficients of the dividend polynomial, in descending order of degree.\n        divisor (list): Coefficients of the divisor polynomial, in descending order of degree.\n\n    Returns:\n        tuple: (quotient, remainder), where quotient and remainder are lists of coefficients.\n\n    Raises:\n        ValueError: If the divisor is zero or of higher degree than the dividend.\n    \"\"\"\n    # Remove leading zeros\n    while dividend and dividend[0] == 0:\n        dividend = dividend[1:]\n    while divisor and divisor[0] == 0:\n        divisor = divisor[1:]\n\n    # Check for zero division\n    if not divisor:\n        raise ValueError(\"Division by zero polynomial\")\n\n    # Check degrees\n    if len(dividend) < len(divisor):\n        return [], dividend\n\n    # Initialize quotient and remainder\n    quotient = [0] * (len(dividend) - len(divisor) + 1)\n    remainder = dividend.copy()\n\n    # Perform polynomial long division\n    for i in range(len(quotient)):\n        if len(remainder) < len(divisor):\n            break\n        \n        # Compute the next term of the quotient\n        term = remainder[0] // divisor[0]\n        quotient[i] = term\n\n        # Subtract term * divisor from the remainder\n        for j in range(len(divisor)):\n            if j < len(remainder):\n                remainder[j] -= term * divisor[j]\n\n        # Remove leading zero from remainder\n        while remainder and remainder[0] == 0:\n            remainder.pop(0)\n\n    # Remove trailing zeros from quotient\n    while quotient and quotient[-1] == 0:\n        quotient.pop()\n\n    return quotient, remainder","key":"GKDUQLTOUQ"},{"type":"output","id":"_8vaDu0L9pix-SLX_SHYh","data":[],"key":"P9KjxvLGd0"}],"key":"ZGOa2WVFqf"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# Example usage\ndividend = [Fp(1), Fp(0), Fp(-2), Fp(0), Fp(1)]  # x^4 - 2x^2 + 1\ndivisor = [Fp(1), Fp(1)]  # x + 1\n\nquotient, remainder = polynomial_division(dividend, divisor)\n\nprint(\"Dividend:\", dividend)\nprint(\"Divisor:\", divisor)\nprint(\"Quotient:\", quotient)\nprint(\"Remainder:\", remainder)","key":"ibpyiuaW3t"},{"type":"output","id":"wN7bSqDHwc4HGl8_eEYng","data":[{"name":"stdout","output_type":"stream","text":"Dividend: [1, 0, 191, 0, 1]\nDivisor: [1, 1]\nQuotient: [1, 192, 192, 1]\nRemainder: []\n"}],"key":"q52yV4BihT"}],"key":"qVA3nMIwnI"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X^4 - 2*X^2 + 1)/(X+1)","key":"R2QrkHpzX0"},{"type":"output","id":"jPKXbOBLQWLPHqevO5u88","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"X^3 + 192*X^2 + 192*X + 1","content_type":"text/plain"}}}],"key":"ikoKnam9kG"}],"key":"i9Io5LWXNA"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10 = KZG10Commitment(G1, G2, 10); ","key":"CMYUfTBRCr"},{"type":"output","id":"FXiwDYJvCTQ7qgIvkIc3h","data":[],"key":"V4aqflZllj"}],"key":"voDFZ8yweR"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.setup(secret_symbol=X0, g1_generator=1, g2_generator=1)\nkzg10.srs\n","key":"IuIfTl5Wa7"},{"type":"output","id":"ONwOWrHkr20QjSyz0x5BG","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"[1, X0, X0^2, X0^3, X0^4, X0^5, X0^6, X0^7, X0^8, X0^9, X0^10]","content_type":"text/plain"}}}],"key":"nvXg137qgs"}],"key":"PJX2WtrKoT"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.h, kzg10.h_s","key":"EEQKiorRZf"},{"type":"output","id":"vAVLIwSYQlJTKLJD0Ctqx","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"(1, X0)","content_type":"text/plain"}}}],"key":"nP8fY2rWN6"}],"key":"mimkWsQyts"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.commit([3,2,1]), kzg10.commit([3,2,1])","key":"xMbcQDUGfy"},{"type":"output","id":"xBlP9Rn7WfLpEeYY9JvYw","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"(Commitment(X0^2 + 2*X0 + 3), Commitment(X0^2 + 2*X0 + 3))","content_type":"text/plain"}}}],"key":"dszmIMVJWO"}],"key":"Cx56a1vuuo"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 = kzg10.commit([3,2,1]); C0","key":"fDn8Jjtmpu"},{"type":"output","id":"xa3NVcC7m1aqeitKEfmS6","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^2 + 2*X0 + 3)","content_type":"text/plain"}}}],"key":"J7sLX7wcUF"}],"key":"Lq83aFNhNP"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C1 = kzg10.commit([9,10,11]); C1","key":"kVa0WMjvL5"},{"type":"output","id":"lobDGuYLsQo8rgHftAGDD","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"Commitment(11*X0^2 + 10*X0 + 9)","content_type":"text/plain"}}}],"key":"ThQXZeypvN"}],"key":"ob64agaIhT"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 + C1","key":"DOLUFXpa5W"},{"type":"output","id":"xryQT0WgsIwTgc35u-0uC","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"text/plain":{"content":"Commitment(12*X0^2 + 12*X0 + 12)","content_type":"text/plain"}}}],"key":"FJbsndrru4"}],"key":"rlAWNpTaDx"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"W = kzg10.prove_eval([3,2,1], 91, 167)","key":"extiWFnrHk"},{"type":"output","id":"WUwNoNIb7RXmtlaiqWuNm","data":[],"key":"Ewyryd0Bv4"}],"key":"c5JtOLzVfN"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.verify_eval(C0, W, 91, 167)\n","key":"WTqIqCgRCG"},{"type":"output","id":"bFAaYfSOGrnjksXOXU2ze","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"oh9CR4r5R8"}],"key":"UQLGAAhAmn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([93,1]) * UniPolynomial([-91, 1]) + UniPolynomial([167])","key":"BUYJOzPoJU"},{"type":"output","id":"IrzIy0pqlvSbozDfMx4oQ","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"-8296 + 2x + x^2","content_type":"text/plain"}}}],"key":"K1wzAs4cbX"}],"key":"MZsMbRZo9g"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def log_2(x):\n    \"\"\"\n    Compute the integer part of the logarithm base 2 of x.\n\n    Args:\n        x (int): The number to compute the logarithm of. Must be a positive integer.\n\n    Returns:\n        int: The floor of the logarithm base 2 of x.\n\n    Raises:\n        ValueError: If x is not a positive integer.\n    \"\"\"\n    if not isinstance(x, int) or x <= 0:\n        raise ValueError(\"x must be a positive integer\")\n    \n    result = 0\n    while x > 1:\n        x >>= 1  # Bit shift right (equivalent to integer division by 2)\n        result += 1\n    return result","key":"kNwV5tvyqf"},{"type":"output","id":"xI9Kyu0Akxd56TALrkRem","data":[],"key":"RHJ7yBX9YQ"}],"key":"uAOE5qgsL6"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"BCHO PCS","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g8LUZxj5qq"}],"identifier":"bcho-pcs","label":"BCHO PCS","html_id":"bcho-pcs","implicit":true,"key":"PI3j29wRc8"}],"key":"AawSJ1rPFk"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"class ProofTranscript:\n    def __init__(self, field):\n        self.field = field\n        self.state = 0  # Initial state\n    \n    def absorb(self, element):\n        \"\"\"\n        Absorb a field element into the transcript.\n        \n        Args:\n            element: A field element to be absorbed. \n        \"\"\"\n        if isinstance(element, int):\n            element = self.field(element)\n        elif isinstance(element, sage.rings.integer.Integer):\n            element = self.field(element)\n        elif isinstance(element, Commitment):\n            element = element.value\n        elif isinstance(element, list):\n            element = sum(element)\n        elif not element.parent() == self.field:\n            raise TypeError(\"Must absorb a field element\")\n        \n        # if not isinstance(element, self.field.Element):\n        #     raise TypeError(\"Must absorb a field element\")\n        \n        # Simple hash function: multiply by a prime and add the element\n        bs = str(element).encode('utf-8')\n        n = int.from_bytes(bs, 'big')\n        self.state = (self.state * int(31) + n) % self.field.order()\n    \n    def squeeze(self):\n        \"\"\"\n        Generate a random field element based on the current state.\n        \n        Returns:\n            A field element.\n        \"\"\"\n        # Use the current state to generate a \"random\" field element\n        self.state = (self.state * 31 + 17) % self.field.order()\n        return self.field(self.state)\n    \n    def clone(self):\n        new = ProofTranscript(self.field)\n        new.state = self.state\n        return new\n","key":"MU3FBEnAYs"},{"type":"output","id":"8Ltqyc18kT7aW-oWL_rr5","data":[],"key":"TbzG9oyDIF"}],"key":"nzHyIsuiUQ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp(1).parent() == Fp","key":"owrCn8sdZf"},{"type":"output","id":"1QRhqbalX6EQkzRuu53mF","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"zosdhlQSoc"}],"key":"JuEVucQXOf"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(30)","key":"ykI1Zo6PlI"},{"type":"output","id":"vdVqBfgZIs_sLf2QWMTBV","data":[{"output_type":"execute_result","execution_count":34,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.integer.Integer'>","content_type":"text/plain"}}}],"key":"RnKavfB6X0"}],"key":"HtgtupbwiL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"    \ntranscript = ProofTranscript(Fp)\n\n# Absorb some elements\ntranscript.absorb(10)\ntranscript.absorb(20)\n\n# Squeeze some randomness\nr1 = transcript.squeeze()\nr2 = transcript.squeeze()\n\nprint(f\"Random element 1: {r1}\")\nprint(f\"Random element 2: {r2}\")\n\n# Absorb more elements\ntranscript.absorb(30)\n\n# Squeeze more randomness\nr3 = transcript.squeeze()\n\nprint(f\"Random element 3: {r3}\")","key":"DhhruKIIC7"},{"type":"output","id":"ctskfI37LLSZdRdLFLtJ4","data":[{"name":"stdout","output_type":"stream","text":"Random element 1: 151\nRandom element 2: 66\nRandom element 3: 98\n"}],"key":"LgGgpV76v3"}],"key":"DgbiNnskpF"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_naive(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert coeffs == [Fp(v)]\n    assert len(coeffs) == 1\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        evals_pos.append(uni_eval_from_coeffs(poly, r))\n        evals_neg.append(uni_eval_from_coeffs(poly, (-1) * r))\n        evals_sq.append(uni_eval_from_coeffs(poly, r^2))\n    \n    \n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq)","key":"sB8LSbbETH"},{"type":"output","id":"glwwqx-9W3OvJeStzsPPU","data":[],"key":"elOIsKS5F6"}],"key":"VeUHpK7V6y"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_naive(C, arg, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    arg: argument to be verified\n    point: evaluation point\n    v: evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    r = transcript.squeeze()\n    \n    evals_sq.append(v)\n    verified = True\n    # Verify evaluations\n    for i in range(k):\n        b = evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)\n        print(\"i={}, {}\".format(i, b))\n        verified = verified and b\n    if verified:\n        print(\"✅ Verified!\")\n    return verified\n","key":"aLrIOsQevz"},{"type":"output","id":"bIcASIo0xDi6U_yMzEooU","data":[],"key":"QAjY96iWWq"}],"key":"h4MFgvO2IS"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"transcript = ProofTranscript(Fp); transcript.state","key":"NBrj4S2xDK"},{"type":"output","id":"XOvyKPDCZ6iiiy_wzBxq8","data":[{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"0","content_type":"text/plain"}}}],"key":"YaXr2t661U"}],"key":"JQjb4jd5qs"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"ff = [1, 3, 2, 1]\nff_cm = kzg10.commit(ff)\nff_cm","key":"omaYvJw964"},{"type":"output","id":"ASdrEiGEcc2fucoWntC_3","data":[{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)","content_type":"text/plain"}}}],"key":"ctip43Xn6W"}],"key":"dgcSYFWaxZ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_naive(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone())","key":"MF2DVpMLN4"},{"type":"output","id":"NWhOrr89AhbGyWg47SglJ","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81), Commitment(-70)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93], [123]]\ncoeffs= [123]\nr= 174\ni=0, True\ni=1, True\n"}],"key":"r3b6qu8WCs"}],"key":"LeLbr8cvbN"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([81, 93], 150)","key":"AXZo6I7wBJ"},{"type":"output","id":"inn9WYzm8stArlMUpO7bI","data":[{"output_type":"execute_result","execution_count":41,"metadata":{},"data":{"text/plain":{"content":"135","content_type":"text/plain"}}}],"key":"tzsuQALgm0"}],"key":"wamXx2Dso2"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_naive(ff_cm, arg, point=[91, 181], v=123, transcript=ProofTranscript(Fp))","key":"pQG1sCTDro"},{"type":"output","id":"JHaitIvbfAFNyWuDctvqj","data":[{"name":"stdout","output_type":"stream","text":"i=0, True\ni=1, True\n✅ Verified!\n"},{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"eKnJl4ZCtA"}],"key":"xfXGmZQYpD"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimized version","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ndiUZXharc"}],"identifier":"optimized-version","label":"Optimized version","html_id":"optimized-version","implicit":true,"key":"bEBdqZ0zeN"}],"key":"J4yhl1a9vi"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert Fp(v) == coeffs[0] + point[k-1] * coeffs[1]\n    assert len(coeffs) == 2\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_r = uni_eval_from_coeffs(poly, r)\n        poly_at_neg_r = uni_eval_from_coeffs(poly, (-1) * r)\n        poly_at_r_sq = uni_eval_from_coeffs(poly, r^2)\n        evals_pos.append(poly_at_r)\n        evals_neg.append(poly_at_neg_r)\n        evals_sq.append(poly_at_r_sq)\n        transcript.absorb(poly_at_r)\n        transcript.absorb(poly_at_neg_r)\n        transcript.absorb(poly_at_r_sq)\n    \n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n    \n    gamma = transcript.squeeze()\n    # gamma = 1\n    print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_r = uni_eval_from_coeffs(h_agg, r)\n    h_agg_poly_at_neg_r = uni_eval_from_coeffs(h_agg, -r)\n    h_agg_poly_at_r_sq = uni_eval_from_coeffs(h_agg, r^2)\n\n    print(\"h_agg_poly_at_r={}, h_agg_poly_at_neg_r={}, h_agg_poly_at_r_sq={}\".format(h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq))\n\n    # DEBUG: verify h_agg\n    assert h_agg_poly_at_r == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n\n\n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"dbg_evals_sq[i+1]={}, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])={}\".format(dbg_evals_sq[i+1], (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq], [r, -r, r^2])\n    print(\"interp_poly=\", interp_poly)\n    vanishing_poly = UniPolynomial([-r, 1])*UniPolynomial([r, 1]) * UniPolynomial([-r*r, 1])\n    print(\"vanishing_poly=\", vanishing_poly)\n\n    h_agg_poly = UniPolynomial(h_agg)\n\n    quo_poly, rem = divmod(h_agg_poly-interp_poly, vanishing_poly)\n    print(\"quo={}, rem={}\".format(quo_poly, rem))\n    # assert rem == UniPolynomial([0])\n    print(\"quo_poly={}\".format(quo_poly))\n    \n    g_poly = h_agg_poly - interp_poly\n    print(\"g_poly=\", g_poly.coeffs)\n    print(\"rem={}\".format(g_poly % vanishing_poly))\n    print(\"quo={}\".format(g_poly // vanishing_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))=\", quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, arg_r_poly_at_zeta)","key":"d1iAaTR197"},{"type":"output","id":"98Tpxnx4S3dRmDJ2_vH9X","data":[],"key":"xnkYrKxYel"}],"key":"xT9PGxbF30"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt(C, arg, point, v, transcript):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    print(\"C=\", C)\n\n    print(\"arg=\", arg)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        transcript.absorb(evals_sq[i])\n    \n    gamma = transcript.squeeze()\n    print(\"gamma=\", gamma)\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n    print(\"Ch=\", Ch)\n    \n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n    print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # vanishing_poly = UniPolynomial([-beta, h_agg_poly_at_beta]) * UniPolynomial([beta, h_agg_poly_at_neg_beta]) * UniPolynomial([-beta*beta, h_agg_poly_at_beta_sq])\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"Cr=\", Cr)\n    print(\"Cq=\", Cq)\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    if not kzg10.verify_eval(Cr, Cw, point=zeta, v=0):\n        return False\n\n    # Verify evaluations\n    evals_sq = evals_sq + [v]\n    for i in range(k):\n        if evals_sq[i+1] != (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*beta):\n            return False\n\n    return True","key":"FnIYTrUPDl"},{"type":"output","id":"bYISh-FkdbgwvhXjFZ6Mq","data":[],"key":"Rs5mk1762h"}],"key":"xBwqAzOmOW"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([46, 25, 25, 1], [123, 128, 170])","key":"Tgr2Gfd2li"},{"type":"output","id":"qec5qB49SJtFeR0Rw8PhC","data":[{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/plain":{"content":"([126, 151], [181, 64])","content_type":"text/plain"}}}],"key":"uP3WJhBbjF"}],"key":"XTIwWO4e6J"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([126, 151]) * UniPolynomial([123, 128, 170]) + UniPolynomial([181, 64])","key":"oTGEUlVz4Y"},{"type":"output","id":"c4WUNAF0uqeX2eetMaa6y","data":[{"output_type":"execute_result","execution_count":46,"metadata":{},"data":{"text/plain":{"content":"15679 + 34765x + 40748x^2 + 25670x^3","content_type":"text/plain"}}}],"key":"XJR7yvnc1X"}],"key":"aBrH7ZA2pR"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod( UniPolynomial([46, 25, 25, 1]),  UniPolynomial([123, 128, 170]))","key":"VH7MWtrxvg"},{"type":"output","id":"p3gt0g2j1BYw7Yq65DphC","data":[{"output_type":"execute_result","execution_count":47,"metadata":{},"data":{"text/plain":{"content":"(126 + 151x, 181 + 64x)","content_type":"text/plain"}}}],"key":"cwjw3J2YuC"}],"key":"qb7yWTC43w"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([46, 25, 25, 1]) % UniPolynomial([123, 128, 170])","key":"MbTAGWvZlV"},{"type":"output","id":"R3fIDq6laPiMlVOYfFfEa","data":[{"output_type":"execute_result","execution_count":48,"metadata":{},"data":{"text/plain":{"content":"181 + 64x","content_type":"text/plain"}}}],"key":"KiLbkyBLyp"}],"key":"UGSBAl4S4w"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(ff_cm)","key":"uJxPlwVpSe"},{"type":"output","id":"rrr1GwDz04qaUSgwNqEdo","data":[{"output_type":"execute_result","execution_count":49,"metadata":{},"data":{"text/plain":{"content":"<class 'kzg10.Commitment'>","content_type":"text/plain"}}}],"key":"JSh9rLGoys"}],"key":"Dzsy00J352"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone()); arg","key":"mFl2vHaM5Z"},{"type":"output","id":"D869CBL7lFYyG1G9bkCPU","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\ncoeffs= [81, 93]\nr= 177\nevals_pos= [36, 137]\nevals_neg= [25, 25]\nevals_sq= [134, 150]\ngamma= 107\nh_agg= [176, 111, 2, 1]\nh_agg_poly_at_r=27, h_agg_poly_at_neg_r=191, h_agg_poly_at_r_sq=165\ndbg_evals_sq[i+1]=150, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=150\ni=0, True\ndbg_evals_sq[i+1]=123, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=123\ni=1, True\ninterp_poly= 67 + 174x + 65x^2\nvanishing_poly= 109 + 130x + 130x^2 + x^3\nquo=1, rem=0\nquo_poly=1\ng_poly= [109, 130, 130, 1]\nrem=0\nquo=1\nzeta=143\ninterp_at_zeta=46\nh_agg_poly - UniPolynomial([interp_at_zeta])= 130 + 111x + 2x^2 + x^3\nquo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))= 30\nr_poly= 100 + 111x + 2x^2 + x^3\nr(zeta)=0\n"},{"output_type":"execute_result","execution_count":50,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [36, 137],\n [25, 25],\n [134, 150],\n Commitment(1),\n Commitment(X0^2 - 48*X0 + 2))","content_type":"text/plain"}}}],"key":"E5mmmPKTFU"}],"key":"SZZ1lwLCOo"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone())","key":"bOWBPF4OSk"},{"type":"output","id":"PgsRcl2MuKwaPKNbUDCav","data":[{"name":"stdout","output_type":"stream","text":"C= Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)\narg= ([Commitment(93*X0 + 81)], [36, 137], [25, 25], [134, 150], Commitment(1), Commitment(X0^2 - 48*X0 + 2))\nbeta= 177\ngamma= 107\nCh= Commitment(X0^3 + 2*X0^2 - 82*X0 - 17)\nh_agg_poly_at_beta=27, h_agg_poly_at_neg_beta=191, h_agg_poly_at_beta_sq=165\nzeta=143\ninterp_at_zeta=46\nCr= Commitment(X0^3 + 2*X0^2 - 82*X0 - 93)\nCq= Commitment(1)\n"},{"output_type":"execute_result","execution_count":51,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"mQccCXS7jU"}],"key":"N2MoHHJOjk"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"gamma=50\n(X0^3 + 2*X0^2 + 3*X0 + 1) + (93*X0 + 81) * gamma ","key":"N7CLiMgXIF"},{"type":"output","id":"iPnoIb-mdi_uYV4nP4ZuX","data":[{"output_type":"execute_result","execution_count":52,"metadata":{},"data":{"text/plain":{"content":"X0^3 + 2*X0^2 + 21*X0 - 2","content_type":"text/plain"}}}],"key":"MwWy5dZlPN"}],"key":"z06jXAQ44p"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([1, 3, 2, 1], 174), uni_eval_from_coeffs([81, 93], 174)","key":"kfSyGqFYus"},{"type":"output","id":"NaxyGfMp-dsW6CxJdWPlp","data":[{"output_type":"execute_result","execution_count":53,"metadata":{},"data":{"text/plain":{"content":"(176, 51)","content_type":"text/plain"}}}],"key":"JgUpEWRGGx"}],"key":"pu9xfs7pPR"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(transcript.squeeze())","key":"LPYbY3wZCg"},{"type":"output","id":"i2eXSmxAVchGTg-QigfMp","data":[{"output_type":"execute_result","execution_count":54,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.finite_rings.integer_mod.IntegerMod_int'>","content_type":"text/plain"}}}],"key":"bk3DSFPMF8"}],"key":"Q7liJW9mw5"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"","key":"aa3K9roMaf"},{"type":"output","id":"fxRwxboF1-N_4dqU_-aXj","data":[],"key":"vu3WQeco3C"}],"key":"GueoggUB8s"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 + f2\nf3","key":"og1AzwZkwy"},{"type":"output","id":"fS05E8xEf2lukX1ku8dSD","data":[{"output_type":"execute_result","execution_count":55,"metadata":{},"data":{"text/plain":{"content":"5 + 7x + 9x^2","content_type":"text/plain"}}}],"key":"dvYdJJxhzV"}],"key":"Fn1llZzoNC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 * f2\nf3","key":"s1AaXGKR92"},{"type":"output","id":"LYYi6eM_fS3MnvQH9owQ2","data":[{"output_type":"execute_result","execution_count":56,"metadata":{},"data":{"text/plain":{"content":"4 + 13x + 28x^2 + 27x^3 + 18x^4","content_type":"text/plain"}}}],"key":"m5KyUEtdyV"}],"key":"ETM8vbIsIo"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def poly(cof):\n    return sum([cof[i] * X^i for i in range(len(cof))])\n\npoly([1, 2, 3])\n","key":"n206zswkZt"},{"type":"output","id":"kVhftrru2jG_O3zfODB0J","data":[{"output_type":"execute_result","execution_count":57,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"ZP0kI8PIvo"}],"key":"iLtlPSGsrq"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"poly([1, 2, 3]) * poly([4, 5, 6])","key":"w9otyuj27C"},{"type":"output","id":"UVdDtD29VfP2axxv1iy6m","data":[{"output_type":"execute_result","execution_count":58,"metadata":{},"data":{"text/plain":{"content":"18*X^4 + 27*X^3 + 28*X^2 + 13*X + 4","content_type":"text/plain"}}}],"key":"FITviY0g4a"}],"key":"IXnwMbBP08"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5])\ndivmod(f1, f2)","key":"cQMmNXBGiC"},{"type":"output","id":"1fcDU77AZad95MWpjhne7","data":[{"output_type":"execute_result","execution_count":59,"metadata":{},"data":{"text/plain":{"content":"(108 + 155x, 148)","content_type":"text/plain"}}}],"key":"Eln8yg1oYq"}],"key":"mYIWrhgwuh"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(155*X + 108) * poly([4, 5]) + poly([148])","key":"VJ1bgQ02IV"},{"type":"output","id":"gpYrjA7mnGep6JMfghD-D","data":[{"output_type":"execute_result","execution_count":60,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"RyC7q6RoFr"}],"key":"ndtqTkgHpO"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 = UniPolynomial.vanishing_polynomial([Fp(1), Fp(2), Fp(3), Fp(4)]); z4","key":"cc3UuBBXjH"},{"type":"output","id":"KteBOHnoQKZH2wMNf9w6i","data":[{"output_type":"execute_result","execution_count":61,"metadata":{},"data":{"text/plain":{"content":"24 + 143x + 35x^2 + 183x^3 + x^4","content_type":"text/plain"}}}],"key":"o2X7JQO2qW"}],"key":"fyIaTIyrmI"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 // (UniPolynomial([-1, 1])), z4 % (UniPolynomial([-1, 1]))","key":"t16pRcEY9u"},{"type":"output","id":"ET96NBX51CD_rESC3CwVv","data":[{"output_type":"execute_result","execution_count":62,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"jg8IBlJBmQ"}],"key":"nzERw56Z7S"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4.division_by_linear_divisor(Fp(1))","key":"bLbILLXyhw"},{"type":"output","id":"dCzkLiTEhbuQZMF-Agk3J","data":[{"output_type":"execute_result","execution_count":63,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"hUZXRTc5e8"}],"key":"Jw3N19eyoD"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))","key":"yxoqdIFER1"},{"type":"output","id":"-XjumcVark_rZ8vAdaJg6","data":[{"output_type":"execute_result","execution_count":64,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"QSiAP0LGpe"}],"key":"ntizrQubd4"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([24, 143, 35, 183, 1], [Fp(-1), Fp(1)])","key":"Pw4Zxb3Whu"},{"type":"output","id":"MNa7K1989EaeAsdnMpOLh","data":[{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"text/plain":{"content":"([169, 26, 184, 1], [])","content_type":"text/plain"}}}],"key":"MbgtztE12q"}],"key":"FPPvfU36pE"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))\n","key":"cnrbvbOV5d"},{"type":"output","id":"3IT5WNV8VMPqjy74ho2TX","data":[{"output_type":"execute_result","execution_count":66,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"UoyfUWvtOi"}],"key":"wPKF0561iw"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X-1)*(X-2)*(X-3)*(X-4)","key":"b7E8eBTABf"},{"type":"output","id":"2BiFv6LZUzQSdT1WmwmTN","data":[{"output_type":"execute_result","execution_count":67,"metadata":{},"data":{"text/plain":{"content":"X^4 + 183*X^3 + 35*X^2 + 143*X + 24","content_type":"text/plain"}}}],"key":"GxpVdpC1BA"}],"key":"DWKoLydBUm"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.compute_coeffs_from_evals_fast([5, 3, 2, 4], [1, 2, 3, 4]); cof","key":"IfCnukiJor"},{"type":"output","id":"x30ESox3SObjjrsTVuUJE","data":[{"output_type":"execute_result","execution_count":68,"metadata":{},"data":{"text/plain":{"content":"[6, 161, 95, 129]","content_type":"text/plain"}}}],"key":"CF6tKAYLUh"}],"key":"RlZqyrAIWz"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"[poly(cof).subs(X=i+1) for i in range(4)]","key":"dvelM9HG4T"},{"type":"output","id":"dMEkWItpiiK94KizMUMAp","data":[{"output_type":"execute_result","execution_count":69,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"vvJeciwVO6"}],"key":"eKNSSTllPI"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.compute_evals_from_coeffs_fast(cof, [1, 2, 3, 4])","key":"wZTOvijHTu"},{"type":"output","id":"_3LKr0EYp-1nZFcefLQ1C","data":[{"output_type":"execute_result","execution_count":70,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"Uhj1Lklbsw"}],"key":"WndQSB3kFI"},{"type":"block","kind":"notebook-content","children":[],"key":"pGMOUqtv9A"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.ntt_coeffs_from_evals([5, 3, 2, 4], 2, H4[1]); cof","key":"EpKPIimEOq"},{"type":"output","id":"GUytYfmBf5Gv2NATCLTmt","data":[{"output_type":"execute_result","execution_count":71,"metadata":{},"data":{"text/plain":{"content":"[100, 77, 0, 21]","content_type":"text/plain"}}}],"key":"n6VvvaKO5L"}],"key":"ZRFdapXtF8"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.ntt_evals_from_coeffs(cof, 2, H4[1])","key":"Kvu9b4oTPZ"},{"type":"output","id":"DLu0FCvaLQBINu8L0ekCs","data":[{"output_type":"execute_result","execution_count":72,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"YCHCAdekTl"}],"key":"EDsTSSsTqJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uup1LbaDE7"}],"identifier":"optimization","label":"Optimization","html_id":"optimization","implicit":true,"key":"OQhcd5p7SU"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Prover doesn’t need to send ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"T7QkX2ocAy"},{"type":"inlineMath","value":"h^{(i)}(\\beta^2)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup><mo stretchy=\"false\">(</mo><msup><mi>β</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h^{(i)}(\\beta^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.138em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"It3Vf7L0Tm"}],"key":"kbPkUV3IvO"}],"key":"pjpuIy2TH2"}],"key":"BNHCQgBRCf"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"## Interpolate two points into a polynomial and evaluate it at X=r\n#\n#   f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n#\n#   f(r) = (a+b)/2 + r * (a-b) / (2*x)\n#\n# \n#(evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n\ndef interp_and_eval_line(a, b, r, x):\n    \"\"\"\n    Interpolate two points into a polynomial and evaluate it at X=r\n\n        f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n\n        f(r) = (a+b)/2 + r * (a-b) / (2*x)\n    Args:\n        a (int): The evaluation at -x\n        b (int): The evaluation at x\n        r (int): The point at which to evaluate the polynomial\n        x (int): The x-coordinate of the point\n\n    Returns:\n        int: The result of evaluating the polynomial at X=r\n    \"\"\"\n    return ((a + b) / 2 + r * (a - b) / (2 * x))","key":"AtrvZwQQQ9"},{"type":"output","id":"YChPwU1Pp25fuUPk4nu1t","data":[],"key":"n5Dxa6rjoF"}],"key":"e8fSY5MxC8"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt_opt(C, f, point, v, transcript, debug=0):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    if debug > 0: \n        coeffs = [coeffs[i] + point[k-1] * coeffs[i+1] for i in range(0, len(coeffs), 2)]\n        print(\"check: fully folded polynomial must be equal to the claimed evaluation: {} = {}\".format(coeffs[0], v))\n        assert (coeffs[0] == v)\n        assert len(coeffs) == 1\n        print(\"coeffs=\", coeffs)\n        print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n        print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n\n    # Sample randomness and reply evaluations\n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n    evals_pos = []\n    evals_neg = []    \n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_beta = uni_eval_from_coeffs(poly, beta)\n        poly_at_neg_beta = uni_eval_from_coeffs(poly, (-1) * beta)\n        poly_at_beta_sq = uni_eval_from_coeffs(poly, beta^2)\n        evals_pos.append(poly_at_beta)\n        evals_neg.append(poly_at_neg_beta)\n        evals_sq.append(poly_at_beta_sq)\n        transcript.absorb(poly_at_beta)\n        transcript.absorb(poly_at_neg_beta)\n\n    transcript.absorb(evals_sq[0])\n\n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n\n    gamma = transcript.squeeze()\n    \n    if debug > 0: \n        print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    if debug > 1: \n        print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_beta = uni_eval_from_coeffs(h_agg, beta)\n    h_agg_poly_at_neg_beta = uni_eval_from_coeffs(h_agg, -beta)\n    h_agg_poly_at_beta_sq = uni_eval_from_coeffs(h_agg, beta^2)\n\n    if debug > 1: \n        print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # DEBUG: verify h_agg\n    if debug > 0:\n        print(\"check: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\")\n        assert h_agg_poly_at_beta == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_neg_beta == sum([evals_neg[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_beta_sq == sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    # DEBUG: verify evaluations\n    if debug > 0:\n        dbg_evals_sq = evals_sq[:] + [v]\n        print(\"dbg_evals_sq=\", dbg_evals_sq)\n        for i in range(k):\n            print(\"check: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\")\n            print(\"i={}, {}, {}\".format(i, \n                dbg_evals_sq[i+1], interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta)))\n\n    h_agg_poly = UniPolynomial(h_agg)\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], [beta, -beta, beta^2])\n    vanishing_poly = UniPolynomial([-beta, 1])*UniPolynomial([beta, 1]) * UniPolynomial([-beta*beta, 1])\n    g_poly = h_agg_poly - interp_poly\n    quo_poly, rem = divmod(g_poly, vanishing_poly)\n\n    if debug > 0:\n        # assert rem == UniPolynomial([0])\n        pass\n\n    if debug > 1:\n        print(\"interp_poly=\", interp_poly)\n        print(\"vanishing_poly=\", vanishing_poly)    \n        print(\"quo={}, rem={}\".format(quo_poly, rem))\n        print(\"quo_poly={}\".format(quo_poly))\n        print(\"rem={}\".format(rem))\n        print(\"quo={}\".format(quo_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))=\", quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    if debug > 0:\n        print(\"check: `r(z)=0` argument must hold\")\n        assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq[:1], Cq, arg_r_poly_at_zeta)","key":"v3jawjNLy4"},{"type":"output","id":"Df_ovQXL2PGoAUQAwW44g","data":[],"key":"DEqDH7DO4J"}],"key":"VXiksxaKDk"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt_opt(C, arg, point, v, transcript, debug=0):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    if debug > 1:\n        print(\"C={}, arg={}, point={}, v={}\".format(C, arg, point, v))\n\n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    if debug > 1:\n        print(\"> beta = {}\".format(beta))\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        evals_sq.append(interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta))\n    transcript.absorb(evals_sq[0])\n\n    if debug > 1:\n        print(\"> evals_sq = {}\".format(evals_sq))\n    \n    # 1st check:\n    if debug > 0:\n        print(\"🛡️: check if the evaluation f({})={} is correct\".format(point, v))\n        print(\"    by computing the folded polynomial h_{}({}^2) ?= {}\".format(k, beta, v))\n        if (evals_sq[-1] == v): \n            print(\"😀 ✅\")\n    if not (evals_sq[-1] == v):\n        return False\n    \n    gamma = transcript.squeeze()\n    if debug > 1:\n        print(\"> gamma = {}\".format(gamma))\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n\n    if debug > 1:\n        print(\"> Commitment of h(X): Ch={}\".format(Ch))\n    \n    # Compute h_agg(beta), h_agg(-beta), h_agg(beta^2)\n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    if debug > 1:\n        print(\"> h_agg_poly_at_beta={}\".format(h_agg_poly_at_beta))\n        print(\"> h_agg_poly_at_neg_beta={}\".format(h_agg_poly_at_neg_beta))\n        print(\"> h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta_sq))\n\n    # Interpolate c(X) from three points: \n    #\n    #    [(beta, h_agg(beta)), (-beta, h_agg(-beta)), (beta^2, h_agg(beta^2))]\n\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    # h_agg(X) - c(X) = q(X) * (X-beta)(X+beta)(X-beta^2)\n    # \n    # Receive Cq = Commit(c(X)) \n    transcript.absorb(Cq)\n\n    # Sample randomness\n    zeta = transcript.squeeze()\n\n    if debug > 1:\n        print(\"> zeta = {}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    vanishing_poly_at_zeta = ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * vanishing_poly_at_zeta\n\n    if debug > 1:\n        print(\"> Cr={}\".format(Cr))\n        print(\"> Cq={}\".format(Cq))\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    \n    # 2. Check if r(z)=0\n    Cw_verified = kzg10.verify_eval(Cr, Cw, point=zeta, v=0)\n\n    if debug > 0:\n        if Cw_verified: print(\"🛡️: check if r(z)=0 😀 ✅\")\n        else: print(\"🛡️: check if r(z)=0 😢 ❌\")\n\n    if not Cw_verified:\n        return False\n\n    return True","key":"xV2qpydbar"},{"type":"output","id":"-0CoyrXWidMkZFwsTN-KP","data":[],"key":"lU3SYLzeEe"}],"key":"CWhTbWJ0Fj"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt_opt(ff_cm, [1, 3, 2, 1], \n            point=[91, 181], v=123, transcript=transcript.clone(), debug=1); arg","key":"A4JcLiQZO9"},{"type":"output","id":"opKKiXbnCEv9P3ycmWiIN","data":[{"name":"stdout","output_type":"stream","text":"check: fully folded polynomial must be equal to the claimed evaluation: 123 = 123\ncoeffs= [123]\nh_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\nbeta= 117\nevals_pos= [37, 154]\nevals_neg= [102, 8]\nevals_sq= [116, 130]\ngamma= 103\ncheck: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\ndbg_evals_sq= [116, 130, 123]\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=0, 130, 130\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=1, 123, 123\nzeta=159\ninterp_at_zeta=152\nh_agg_poly - UniPolynomial([interp_at_zeta])= 86 + 125x + 2x^2 + x^3\nquo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))= 146\nr_poly= 133 + 125x + 2x^2 + x^3\nr(zeta)=0\ncheck: `r(z)=0` argument must hold\n"},{"output_type":"execute_result","execution_count":76,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [37, 154],\n [102, 8],\n [116],\n Commitment(1),\n Commitment(X0^2 - 32*X0 + 55))","content_type":"text/plain"}}}],"key":"r91e5EPbL0"}],"key":"Sc4wxUc3mo"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone(), debug=1)","key":"chQPzULz9V"},{"type":"output","id":"BGy3Dwqe3M05aUxGG7JWm","data":[{"name":"stdout","output_type":"stream","text":"🛡️: check if the evaluation f([91, 181])=123 is correct\n    by computing the folded polynomial h_2(117^2) ?= 123\n😀 ✅\ninterp_at_zeta=152\n🛡️: check if r(z)=0 😀 ✅\n"},{"output_type":"execute_result","execution_count":77,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"PtubjUQHIc"}],"key":"RRAYoHRwDw"}],"key":"h5vBGm4bUv"},"references":{"cite":{"order":[],"data":{}}}}