{"version":2,"kind":"Notebook","sha256":"9de0aaef11366a3e7711ab4673207967e4c1569a1ce5714c5da22d1d3d0f69cc","slug":"src.bcho-pcs","location":"/src/bcho_pcs.ipynb","dependencies":[],"frontmatter":{"title":"BCHO PCS","content_includes_title":false,"kernelspec":{"name":"sagemath-10.4","display_name":"SageMath 10.4","language":"sage"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/executablebooks/jupyter-book/blob/main/src/bcho_pcs.ipynb","exports":[{"format":"ipynb","filename":"bcho_pcs.ipynb","url":"/bcho_pcs-5a2ca9078234ed554e223fbe629356e4.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"from group import DummyGroup\nfrom utils import log_2, pow_2\nfrom unipolynomial import UniPolynomial\nfrom mle2 import MLEPolynomial\nfrom kzg10 import Commitment, KZG10Commitment","key":"GCrdYViYTT"},{"type":"output","id":"B_eZv1P_eIAphKUXO2TAi","data":[],"key":"Tq28AhxqAD"}],"key":"Rl3Nd9SZ7h"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"F193.<a> = GF(193)\nR193.<X> = F193[]\nR193\nFp=F193\nFp","key":"iVW04Od15n"},{"type":"output","id":"RlSsuqWvZpC9fimSmpkpu","data":[{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"Finite Field of size 193","content_type":"text/plain"}}}],"key":"cCuXt6LJOq"}],"key":"xdVRJwrwbj"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.set_scalar(Fp(0), Fp)\nCommitment.set_scalar(Fp(0))","key":"vg4bZHmF8J"},{"type":"output","id":"p40y-wcCNGjLpiBsW9sk4","data":[],"key":"IUv4O33SUC"}],"key":"lTWMfUAFen"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# For symbolic calculation\n\nR_2.<X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2> = Fp[]; R_2","key":"ebgYFg1hsM"},{"type":"output","id":"TcttBhtCi92026ybi72m1","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"Multivariate Polynomial Ring in X0, X1, X2, X3, X4, X5, X6, X7, X8, X9, Y0, Y1, Y2, Y3, Y4, Y5, Y6, Y7, A0, A1, A2, B0, B1, B2 over Finite Field of size 193","content_type":"text/plain"}}}],"key":"ox9WhzLj3m"}],"key":"XCJ9bgdiW9"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp2 = Fp.extension(2, 'b'); Fp2","key":"T7xZ7KsnTw"},{"type":"output","id":"QxMAp_yL311GOn4RJVJJS","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"Finite Field in b of size 193^2","content_type":"text/plain"}}}],"key":"YQNbEOx97I"}],"key":"kC0NrNA3g6"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"omega = Fp.primitive_element()^3; omega, omega^64 == 1, omega^32 == -1","key":"RPBT5rl7qh"},{"type":"output","id":"m2SAh6zTCIbnU7dhhdU7y","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"(125, True, True)","content_type":"text/plain"}}}],"key":"Cy3UzzhheS"}],"key":"DnxSf01geK"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H16 = [(omega^4)^i for i in range(16)]; H16","key":"zxaTiSuf3Z"},{"type":"output","id":"wrTc4qWG68tMm4_8O06YD","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"[1, 64, 43, 50, 112, 27, 184, 3, 192, 129, 150, 143, 81, 166, 9, 190]","content_type":"text/plain"}}}],"key":"ez5rCVizdI"}],"key":"FubGx2U9lQ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H8 = [(omega^8)^i for i in range(8)]; H8","key":"fMCz6bOrYT"},{"type":"output","id":"oHXNPxYAs8fXZDym_gMmX","data":[{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"[1, 43, 112, 184, 192, 150, 81, 9]","content_type":"text/plain"}}}],"key":"lErakVSaG9"}],"key":"x7GPNlg2TJ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"H4 = [(omega^16)^i for i in range(4)]; H4","key":"VmcDZPhc1k"},{"type":"output","id":"Gfs3Rn1Ql4fGrrEZyUbev","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"[1, 112, 192, 81]","content_type":"text/plain"}}}],"key":"MJkkMwlF4c"}],"key":"dYI82FNTkN"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1 = DummyGroup(Fp)\nG1.generator(), G1.exp(2, 3), G1.order(), ","key":"kPjfnDxUDk"},{"type":"output","id":"kGepb_jJpS1odKNZ8NQBa","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"(5, 6, 193)","content_type":"text/plain"}}}],"key":"hxGWR5U227"}],"key":"cfjjFXM8mz"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G1.exp(X1, 3)","key":"Yhl51FmZLy"},{"type":"output","id":"3O0BgMJvrs6hvELtmVdQ_","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"3*X1","content_type":"text/plain"}}}],"key":"R3FvMOy8Kx"}],"key":"ZJuVcn5Yi0"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"G2 = DummyGroup(Fp2)\nFp2.random_element()\nG2.generator(), G2.exp(G2.generator(), 3), G2.order(), G2.field.polynomial()","key":"dBD1eXHIMJ"},{"type":"output","id":"aJKCxb7a_Dzr9Id6E-OBA","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/plain":{"content":"(b, 3*b, 37249, b^2 + 192*b + 5)","content_type":"text/plain"}}}],"key":"usnuFYOPli"}],"key":"cUaXza4Evu"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def is_power_of_two(n):\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    if n == 2**(k-1):\n        return True\n    else:\n        return False\n\ndef next_power_of_two(n):\n    assert n >= 0, \"No negative integer\"\n    if is_power_of_two(n):\n        return n\n    d = n\n    k = 0\n    while d > 0:\n        d >>= 1\n        k += 1\n    return k\n\nis_power_of_two(15), next_power_of_two(15)","key":"bp9VHxRKYh"},{"type":"output","id":"imAinULFtBSm4Z94U7NkN","data":[{"output_type":"execute_result","execution_count":13,"metadata":{},"data":{"text/plain":{"content":"(False, 4)","content_type":"text/plain"}}}],"key":"FNCXXU4rnF"}],"key":"Py50q1VlLs"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def bits_le_with_width(i, width):\n    if i >= 2**width:\n        return \"Failed\"\n    bits = []\n    while width:\n        bits.append(i % 2)\n        i //= 2\n        width -= 1\n    return bits\n        \nbits_le_with_width(6, 5)\n","key":"Jfe2oNku4x"},{"type":"output","id":"Tx5gr5obXne_Aq6KEe0Gn","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"[0, 1, 1, 0, 0]","content_type":"text/plain"}}}],"key":"r60BmaMSOv"}],"key":"o8DECg3h20"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Polynomial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y91gTQEJU7"}],"identifier":"polynomial","label":"Polynomial","html_id":"polynomial","implicit":true,"key":"HwXDjmhqnd"}],"key":"u67TXBXfLM"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# \n#  m = [1]\n#  m = [1] + [1 * X0, 1 * X1]\n#  m = m + [1 * X0^2, 1 * X0 * X1, 1 * X1]\ndef mle_eval_from_coeffs(f_coeffs, point):\n    k = len(point)\n    n = len(f_coeffs)\n    assert len(f_coeffs) == 1 << k\n    \n    e = Fp(0)\n    for i in range(n):\n        i_bits = bits_le_with_width(i, k)\n        monomial = product([point[j] if i_bits[j] == 1 else 1 for j in range(k)])\n        e += f_coeffs[i] * monomial\n    \n    return e\n\nmle_eval_from_coeffs([1, 3, 2, 1], [91, 181]) == Fp((1 + 3*X0 + 2*X1 + 1*X0*X1)(X0=91, X1=181))","key":"I7JXo5vRgR"},{"type":"output","id":"rLZ72BZAMgBS9hGpBGQ7S","data":[{"output_type":"execute_result","execution_count":15,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"XDxpssZ300"}],"key":"zf7R8OfWkM"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"mle_eval_from_coeffs([1, 3, 2, 1], [X0, X1])","key":"uTINrhjD6r"},{"type":"output","id":"R3n8dTUTUUSXTl8cV-NkZ","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"X0*X1 + 3*X0 + 2*X1 + 1","content_type":"text/plain"}}}],"key":"a4LyDrkG1D"}],"key":"Vzque1pBu2"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def uni_eval_from_coeffs(coeffs, z):\n    t = Fp(1)\n    eval = Fp(0)\n    for i in range(0, len(coeffs)):\n        eval += coeffs[i] * t\n        t *= z\n    return eval\n\nuni_eval_from_coeffs([1, 3, 2, 1], 91) == Fp(1 + 3*91 + 2*91^2 + 1*91^3) == Fp(144)","key":"X2Wp7qKJo0"},{"type":"output","id":"ul3o4JUvWukyOrTwBnb5j","data":[{"output_type":"execute_result","execution_count":17,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"EDxn5RI6Tv"}],"key":"bM3sA4LPUp"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def polynomial_division(dividend, divisor):\n    \"\"\"\n    Perform univariate polynomial division.\n\n    Args:\n        dividend (list): Coefficients of the dividend polynomial, in descending order of degree.\n        divisor (list): Coefficients of the divisor polynomial, in descending order of degree.\n\n    Returns:\n        tuple: (quotient, remainder), where quotient and remainder are lists of coefficients.\n\n    Raises:\n        ValueError: If the divisor is zero or of higher degree than the dividend.\n    \"\"\"\n    # Remove leading zeros\n    while dividend and dividend[0] == 0:\n        dividend = dividend[1:]\n    while divisor and divisor[0] == 0:\n        divisor = divisor[1:]\n\n    # Check for zero division\n    if not divisor:\n        raise ValueError(\"Division by zero polynomial\")\n\n    # Check degrees\n    if len(dividend) < len(divisor):\n        return [], dividend\n\n    # Initialize quotient and remainder\n    quotient = [0] * (len(dividend) - len(divisor) + 1)\n    remainder = dividend.copy()\n\n    # Perform polynomial long division\n    for i in range(len(quotient)):\n        if len(remainder) < len(divisor):\n            break\n        \n        # Compute the next term of the quotient\n        term = remainder[0] // divisor[0]\n        quotient[i] = term\n\n        # Subtract term * divisor from the remainder\n        for j in range(len(divisor)):\n            if j < len(remainder):\n                remainder[j] -= term * divisor[j]\n\n        # Remove leading zero from remainder\n        while remainder and remainder[0] == 0:\n            remainder.pop(0)\n\n    # Remove trailing zeros from quotient\n    while quotient and quotient[-1] == 0:\n        quotient.pop()\n\n    return quotient, remainder","key":"cimvvHNGq7"},{"type":"output","id":"YE1yDNTvL5gbWeuRoHk5R","data":[],"key":"C0HFEEK4T3"}],"key":"HDsMulKv0E"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"# Example usage\ndividend = [Fp(1), Fp(0), Fp(-2), Fp(0), Fp(1)]  # x^4 - 2x^2 + 1\ndivisor = [Fp(1), Fp(1)]  # x + 1\n\nquotient, remainder = polynomial_division(dividend, divisor)\n\nprint(\"Dividend:\", dividend)\nprint(\"Divisor:\", divisor)\nprint(\"Quotient:\", quotient)\nprint(\"Remainder:\", remainder)","key":"jzA4UyGqwm"},{"type":"output","id":"kJLMs-tye_oj_91i2NBOM","data":[{"name":"stdout","output_type":"stream","text":"Dividend: [1, 0, 191, 0, 1]\nDivisor: [1, 1]\nQuotient: [1, 192, 192, 1]\nRemainder: []\n"}],"key":"k95qcEWR6N"}],"key":"jjSro7GUzB"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X^4 - 2*X^2 + 1)/(X+1)","key":"UiZP3VJ4Vv"},{"type":"output","id":"jx4hywe_pXfKPblLPujVS","data":[{"output_type":"execute_result","execution_count":20,"metadata":{},"data":{"text/plain":{"content":"X^3 + 192*X^2 + 192*X + 1","content_type":"text/plain"}}}],"key":"c1qPKWyIAp"}],"key":"o3TwRczVGn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10 = KZG10Commitment(G1, G2, 10); ","key":"kyzgm9VvqI"},{"type":"output","id":"sugGRA0OM5lszQomNxzDK","data":[],"key":"WJOuFmZrPG"}],"key":"aN1nbm1qcV"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.setup(secret_symbol=X0, g1_generator=1, g2_generator=1)\nkzg10.srs\n","key":"JmDBqgA40O"},{"type":"output","id":"rzt1qbobcQ72lIhbBFWpy","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"[1, X0, X0^2, X0^3, X0^4, X0^5, X0^6, X0^7, X0^8, X0^9, X0^10]","content_type":"text/plain"}}}],"key":"VxHZY2N1El"}],"key":"CM1BNlPm0w"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.h, kzg10.h_s","key":"CVejcVVXnz"},{"type":"output","id":"13dC3xF-Ifimc42H35XTd","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"(1, X0)","content_type":"text/plain"}}}],"key":"eP6BnmD3Dd"}],"key":"iVlGE7rF1c"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.commit([3,2,1]), kzg10.commit([3,2,1])","key":"jI5tFCUndb"},{"type":"output","id":"SQII-2mUWRbmSWpyEX2c4","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/plain":{"content":"(Commitment(X0^2 + 2*X0 + 3), Commitment(X0^2 + 2*X0 + 3))","content_type":"text/plain"}}}],"key":"EQ1RvnCehq"}],"key":"pBTY5jjazm"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 = kzg10.commit([3,2,1]); C0","key":"ZRqkgJTO0p"},{"type":"output","id":"fXBj-ka2ft7Su2S2Me8mm","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^2 + 2*X0 + 3)","content_type":"text/plain"}}}],"key":"qFOWEGDepb"}],"key":"EbgFT9yjzJ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C1 = kzg10.commit([9,10,11]); C1","key":"y0bdPKDLZr"},{"type":"output","id":"_bqTbylSrO3_aV_4Do-Li","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"Commitment(11*X0^2 + 10*X0 + 9)","content_type":"text/plain"}}}],"key":"A2mDKqWv38"}],"key":"M9wyyE0xMI"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"C0 + C1","key":"QUoFN1B5db"},{"type":"output","id":"AAVLLDBSpTzGVUcQLaVVe","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"text/plain":{"content":"Commitment(12*X0^2 + 12*X0 + 12)","content_type":"text/plain"}}}],"key":"ASNThNEfyT"}],"key":"ofygVkRD1i"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"W = kzg10.prove_eval([3,2,1], 91, 167)","key":"hwNFq5f15D"},{"type":"output","id":"yOA_biVQd1Q75nz-tHFDn","data":[],"key":"TcJ1ip0Vs2"}],"key":"l97yHpwBmo"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"kzg10.verify_eval(C0, W, 91, 167)\n","key":"qNkSaYip0r"},{"type":"output","id":"FQxI37zT02LwAi9tEujva","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"HSOxXJJ1KP"}],"key":"HShvPIZfRj"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([93,1]) * UniPolynomial([-91, 1]) + UniPolynomial([167])","key":"Eiyzv7hht7"},{"type":"output","id":"_MhpVqp2do9ULcWLeYOOS","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"-8296 + 2x + x^2","content_type":"text/plain"}}}],"key":"EQYvwWuMEU"}],"key":"EuX4htDtV6"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def log_2(x):\n    \"\"\"\n    Compute the integer part of the logarithm base 2 of x.\n\n    Args:\n        x (int): The number to compute the logarithm of. Must be a positive integer.\n\n    Returns:\n        int: The floor of the logarithm base 2 of x.\n\n    Raises:\n        ValueError: If x is not a positive integer.\n    \"\"\"\n    if not isinstance(x, int) or x <= 0:\n        raise ValueError(\"x must be a positive integer\")\n    \n    result = 0\n    while x > 1:\n        x >>= 1  # Bit shift right (equivalent to integer division by 2)\n        result += 1\n    return result","key":"S6iqGE5fBA"},{"type":"output","id":"r2L_znjOxcZYrkUGbEtFC","data":[],"key":"aEfd2yU1hJ"}],"key":"VZkzc65BHy"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"BCHO PCS","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DvmeWYJe2S"}],"identifier":"bcho-pcs","label":"BCHO PCS","html_id":"bcho-pcs","implicit":true,"key":"CICuKwcUmW"}],"key":"uzn9MKXh2b"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"class ProofTranscript:\n    def __init__(self, field):\n        self.field = field\n        self.state = 0  # Initial state\n    \n    def absorb(self, element):\n        \"\"\"\n        Absorb a field element into the transcript.\n        \n        Args:\n            element: A field element to be absorbed. \n        \"\"\"\n        if isinstance(element, int):\n            element = self.field(element)\n        elif isinstance(element, sage.rings.integer.Integer):\n            element = self.field(element)\n        elif isinstance(element, Commitment):\n            element = element.value\n        elif isinstance(element, list):\n            element = sum(element)\n        elif not element.parent() == self.field:\n            raise TypeError(\"Must absorb a field element\")\n        \n        # if not isinstance(element, self.field.Element):\n        #     raise TypeError(\"Must absorb a field element\")\n        \n        # Simple hash function: multiply by a prime and add the element\n        bs = str(element).encode('utf-8')\n        n = int.from_bytes(bs, 'big')\n        self.state = (self.state * int(31) + n) % self.field.order()\n    \n    def squeeze(self):\n        \"\"\"\n        Generate a random field element based on the current state.\n        \n        Returns:\n            A field element.\n        \"\"\"\n        # Use the current state to generate a \"random\" field element\n        self.state = (self.state * 31 + 17) % self.field.order()\n        return self.field(self.state)\n    \n    def clone(self):\n        new = ProofTranscript(self.field)\n        new.state = self.state\n        return new\n","key":"lBJUHchkD1"},{"type":"output","id":"DmIPiow4hITNgHBAVFuM6","data":[],"key":"KMpchTa8hx"}],"key":"Nki935Qoob"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"Fp(1).parent() == Fp","key":"phBSnJM01K"},{"type":"output","id":"Aeb7QwW1aZNLXB1m3jfpb","data":[{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"rWw19kATGh"}],"key":"frAczKnLsd"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(30)","key":"dWXENpNMg7"},{"type":"output","id":"_4nTzVXMSZG83IvV8-AZb","data":[{"output_type":"execute_result","execution_count":34,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.integer.Integer'>","content_type":"text/plain"}}}],"key":"x2Rhz8Fomk"}],"key":"iFuUlJsfG3"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"    \ntranscript = ProofTranscript(Fp)\n\n# Absorb some elements\ntranscript.absorb(10)\ntranscript.absorb(20)\n\n# Squeeze some randomness\nr1 = transcript.squeeze()\nr2 = transcript.squeeze()\n\nprint(f\"Random element 1: {r1}\")\nprint(f\"Random element 2: {r2}\")\n\n# Absorb more elements\ntranscript.absorb(30)\n\n# Squeeze more randomness\nr3 = transcript.squeeze()\n\nprint(f\"Random element 3: {r3}\")","key":"MbmmCFVKfw"},{"type":"output","id":"JVYAuO7lM7gCN3KGDOBsW","data":[{"name":"stdout","output_type":"stream","text":"Random element 1: 151\nRandom element 2: 66\nRandom element 3: 98\n"}],"key":"UU4Dmz4OKK"}],"key":"vBBhS1qbSF"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_naive(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert coeffs == [Fp(v)]\n    assert len(coeffs) == 1\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        evals_pos.append(uni_eval_from_coeffs(poly, r))\n        evals_neg.append(uni_eval_from_coeffs(poly, (-1) * r))\n        evals_sq.append(uni_eval_from_coeffs(poly, r^2))\n    \n    \n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq)","key":"E0a8gLQWcr"},{"type":"output","id":"iXOWCMA-3D5bODevBJ4fG","data":[],"key":"jAYVeGBSEc"}],"key":"NNTakFtZoh"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_naive(C, arg, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    arg: argument to be verified\n    point: evaluation point\n    v: evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    r = transcript.squeeze()\n    \n    evals_sq.append(v)\n    verified = True\n    # Verify evaluations\n    for i in range(k):\n        b = evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)\n        print(\"i={}, {}\".format(i, b))\n        verified = verified and b\n    if verified:\n        print(\"✅ Verified!\")\n    return verified\n","key":"OEFQSJPnpL"},{"type":"output","id":"lGqOdUTtX62VPAHcB3O6I","data":[],"key":"JCjwJUGzIU"}],"key":"mjrjoOFik4"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"transcript = ProofTranscript(Fp); transcript.state","key":"RFDEZTxlXj"},{"type":"output","id":"Pg23ygrkatMMlA6tWWWEg","data":[{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"0","content_type":"text/plain"}}}],"key":"Gl2bfMhDAG"}],"key":"gTTQinl7Po"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"ff = [1, 3, 2, 1]\nff_cm = kzg10.commit(ff)\nff_cm","key":"C2UcTxfUiy"},{"type":"output","id":"MNBmR49k29mTcl7KlBqsL","data":[{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)","content_type":"text/plain"}}}],"key":"dnH8qkrQNr"}],"key":"jFE5VdSj07"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_naive(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone())","key":"HlVU57rBWv"},{"type":"output","id":"9jHBl0EZS2tYANCmZ-VZY","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81), Commitment(-70)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93], [123]]\ncoeffs= [123]\nr= 174\ni=0, True\ni=1, True\n"}],"key":"MlxRlEdtFp"}],"key":"HL5H33cUGn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([81, 93], 150)","key":"fs4j8XnQUy"},{"type":"output","id":"DDWjlcMDJzEr4zS9kwZgF","data":[{"output_type":"execute_result","execution_count":41,"metadata":{},"data":{"text/plain":{"content":"135","content_type":"text/plain"}}}],"key":"ZlB1U31wr6"}],"key":"Z0YskzvkNV"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_naive(ff_cm, arg, point=[91, 181], v=123, transcript=ProofTranscript(Fp))","key":"VJSYhvPfbp"},{"type":"output","id":"S3Oqqf62n22nXVjNJr-gL","data":[{"name":"stdout","output_type":"stream","text":"i=0, True\ni=1, True\n✅ Verified!\n"},{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"rwtElymFhV"}],"key":"Y16gpZJFDN"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimized version","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fU1MdQthWf"}],"identifier":"optimized-version","label":"Optimized version","html_id":"optimized-version","implicit":true,"key":"t6xMPtqbps"}],"key":"DHjIBfyI4h"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt(C, f, point, v, transcript):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n    print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n    assert Fp(v) == coeffs[0] + point[k-1] * coeffs[1]\n    assert len(coeffs) == 2\n    print(\"coeffs=\", coeffs)\n\n    # Sample randomness and reply evaluations\n    r = transcript.squeeze()\n    print(\"r=\", r)\n    evals_pos = []\n    evals_neg = []\n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_r = uni_eval_from_coeffs(poly, r)\n        poly_at_neg_r = uni_eval_from_coeffs(poly, (-1) * r)\n        poly_at_r_sq = uni_eval_from_coeffs(poly, r^2)\n        evals_pos.append(poly_at_r)\n        evals_neg.append(poly_at_neg_r)\n        evals_sq.append(poly_at_r_sq)\n        transcript.absorb(poly_at_r)\n        transcript.absorb(poly_at_neg_r)\n        transcript.absorb(poly_at_r_sq)\n    \n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n    \n    gamma = transcript.squeeze()\n    # gamma = 1\n    print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_r = uni_eval_from_coeffs(h_agg, r)\n    h_agg_poly_at_neg_r = uni_eval_from_coeffs(h_agg, -r)\n    h_agg_poly_at_r_sq = uni_eval_from_coeffs(h_agg, r^2)\n\n    print(\"h_agg_poly_at_r={}, h_agg_poly_at_neg_r={}, h_agg_poly_at_r_sq={}\".format(h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq))\n\n    # DEBUG: verify h_agg\n    assert h_agg_poly_at_r == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n\n\n    # DEBUG: verify evaluations\n    dbg_evals_sq = evals_sq[:] + [v]\n    for i in range(k):\n        print(\"dbg_evals_sq[i+1]={}, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])={}\".format(dbg_evals_sq[i+1], (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n        print(\"i={}, {}\".format(i, dbg_evals_sq[i+1] == (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_r, h_agg_poly_at_neg_r, h_agg_poly_at_r_sq], [r, -r, r^2])\n    print(\"interp_poly=\", interp_poly)\n    vanishing_poly = UniPolynomial([-r, 1])*UniPolynomial([r, 1]) * UniPolynomial([-r*r, 1])\n    print(\"vanishing_poly=\", vanishing_poly)\n\n    h_agg_poly = UniPolynomial(h_agg)\n\n    quo_poly, rem = divmod(h_agg_poly-interp_poly, vanishing_poly)\n    print(\"quo={}, rem={}\".format(quo_poly, rem))\n    # assert rem == UniPolynomial([0])\n    print(\"quo_poly={}\".format(quo_poly))\n    \n    g_poly = h_agg_poly - interp_poly\n    print(\"g_poly=\", g_poly.coeffs)\n    print(\"rem={}\".format(g_poly % vanishing_poly))\n    print(\"quo={}\".format(g_poly // vanishing_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))=\", quo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, arg_r_poly_at_zeta)","key":"zBruFfzkUz"},{"type":"output","id":"cFpKrjOq8AQKyEeoN7K8A","data":[],"key":"gELnm5ibjW"}],"key":"WnQKZA4qyL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt(C, arg, point, v, transcript):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    print(\"C=\", C)\n\n    print(\"arg=\", arg)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        transcript.absorb(evals_sq[i])\n    \n    gamma = transcript.squeeze()\n    print(\"gamma=\", gamma)\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n    print(\"Ch=\", Ch)\n    \n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n    print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # vanishing_poly = UniPolynomial([-beta, h_agg_poly_at_beta]) * UniPolynomial([beta, h_agg_poly_at_neg_beta]) * UniPolynomial([-beta*beta, h_agg_poly_at_beta_sq])\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"Cr=\", Cr)\n    print(\"Cq=\", Cq)\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    if not kzg10.verify_eval(Cr, Cw, point=zeta, v=0):\n        return False\n\n    # Verify evaluations\n    evals_sq = evals_sq + [v]\n    for i in range(k):\n        if evals_sq[i+1] != (evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*beta):\n            return False\n\n    return True","key":"gjRTLTogFI"},{"type":"output","id":"pFLOmY_uoNNPvGgEvurcq","data":[],"key":"MKrSLKzChg"}],"key":"aQxbwZ7TPF"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([46, 25, 25, 1], [123, 128, 170])","key":"PQMkNmhXEX"},{"type":"output","id":"u1Cs0K-Cc-r1G2lSf8kuT","data":[{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/plain":{"content":"([126, 151], [181, 64])","content_type":"text/plain"}}}],"key":"LqdngJo8Dp"}],"key":"gDv9kcOSbn"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([126, 151]) * UniPolynomial([123, 128, 170]) + UniPolynomial([181, 64])","key":"ez0n4PWoei"},{"type":"output","id":"_d0QVQb3y1f2Ap52o6esk","data":[{"output_type":"execute_result","execution_count":46,"metadata":{},"data":{"text/plain":{"content":"15679 + 34765x + 40748x^2 + 25670x^3","content_type":"text/plain"}}}],"key":"p54Ch143m2"}],"key":"dT5j1axSkD"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod( UniPolynomial([46, 25, 25, 1]),  UniPolynomial([123, 128, 170]))","key":"uPa7Bpu5YP"},{"type":"output","id":"PETuSkm-ISgZmGGQWI9Vn","data":[{"output_type":"execute_result","execution_count":47,"metadata":{},"data":{"text/plain":{"content":"(126 + 151x, 181 + 64x)","content_type":"text/plain"}}}],"key":"BkFEOFMLRy"}],"key":"LlzL9JwjxZ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial([46, 25, 25, 1]) % UniPolynomial([123, 128, 170])","key":"e5Zo2fCCbt"},{"type":"output","id":"_nB6l0n6ys-hh0fA_JfAD","data":[{"output_type":"execute_result","execution_count":48,"metadata":{},"data":{"text/plain":{"content":"181 + 64x","content_type":"text/plain"}}}],"key":"twYOPTpPpF"}],"key":"l7tuYthZWl"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(ff_cm)","key":"G0DeERuIHH"},{"type":"output","id":"ZiubMT0npqNZ8qW6dzagd","data":[{"output_type":"execute_result","execution_count":49,"metadata":{},"data":{"text/plain":{"content":"<class 'kzg10.Commitment'>","content_type":"text/plain"}}}],"key":"RVA2je0Jup"}],"key":"XOfdBN4E6P"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt(ff_cm, [1, 3, 2, 1], point=[91, 181], v=123, transcript=transcript.clone()); arg","key":"rJcC2jm1fH"},{"type":"output","id":"469PDCIa5Dz4gaBoKLHRS","data":[{"name":"stdout","output_type":"stream","text":"h_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\ncoeffs= [81, 93]\nr= 177\nevals_pos= [36, 137]\nevals_neg= [25, 25]\nevals_sq= [134, 150]\ngamma= 107\nh_agg= [176, 111, 2, 1]\nh_agg_poly_at_r=27, h_agg_poly_at_neg_r=191, h_agg_poly_at_r_sq=165\ndbg_evals_sq[i+1]=150, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=150\ni=0, True\ndbg_evals_sq[i+1]=123, interp_and_eval_line(evals_pos[i], evals_neg[i], r, point[i])=123\ni=1, True\ninterp_poly= 67 + 174x + 65x^2\nvanishing_poly= 109 + 130x + 130x^2 + x^3\nquo=1, rem=0\nquo_poly=1\ng_poly= [109, 130, 130, 1]\nrem=0\nquo=1\nzeta=143\ninterp_at_zeta=46\nh_agg_poly - UniPolynomial([interp_at_zeta])= 130 + 111x + 2x^2 + x^3\nquo_poly * ((zeta - r) * (zeta + r) * (zeta - r*r))= 30\nr_poly= 100 + 111x + 2x^2 + x^3\nr(zeta)=0\n"},{"output_type":"execute_result","execution_count":50,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [36, 137],\n [25, 25],\n [134, 150],\n Commitment(1),\n Commitment(X0^2 - 48*X0 + 2))","content_type":"text/plain"}}}],"key":"KlukRvfSZP"}],"key":"iJHlI5slqM"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone())","key":"AJgSBNxKra"},{"type":"output","id":"cucxNLS4aLhk9NuF1WZvd","data":[{"name":"stdout","output_type":"stream","text":"C= Commitment(X0^3 + 2*X0^2 + 3*X0 + 1)\narg= ([Commitment(93*X0 + 81)], [36, 137], [25, 25], [134, 150], Commitment(1), Commitment(X0^2 - 48*X0 + 2))\nbeta= 177\ngamma= 107\nCh= Commitment(X0^3 + 2*X0^2 - 82*X0 - 17)\nh_agg_poly_at_beta=27, h_agg_poly_at_neg_beta=191, h_agg_poly_at_beta_sq=165\nzeta=143\ninterp_at_zeta=46\nCr= Commitment(X0^3 + 2*X0^2 - 82*X0 - 93)\nCq= Commitment(1)\n"},{"output_type":"execute_result","execution_count":51,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"wF35BeIF9R"}],"key":"wysv9kIbMO"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"gamma=50\n(X0^3 + 2*X0^2 + 3*X0 + 1) + (93*X0 + 81) * gamma ","key":"BRDQ2RGLOU"},{"type":"output","id":"gMnTEY7p59OTw2ztF5Elw","data":[{"output_type":"execute_result","execution_count":52,"metadata":{},"data":{"text/plain":{"content":"X0^3 + 2*X0^2 + 21*X0 - 2","content_type":"text/plain"}}}],"key":"nQRcfPhuE8"}],"key":"zh5WXf66w7"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"uni_eval_from_coeffs([1, 3, 2, 1], 174), uni_eval_from_coeffs([81, 93], 174)","key":"CgBSh9SZ3i"},{"type":"output","id":"OPyVCM5Bb1L3MNcKN5w7f","data":[{"output_type":"execute_result","execution_count":53,"metadata":{},"data":{"text/plain":{"content":"(176, 51)","content_type":"text/plain"}}}],"key":"O8FPB6JHCA"}],"key":"qRhF68yF8T"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"type(transcript.squeeze())","key":"mcc25bQ8u3"},{"type":"output","id":"8qIqsUxZCDVJ8BzpDx_Xi","data":[{"output_type":"execute_result","execution_count":54,"metadata":{},"data":{"text/plain":{"content":"<class 'sage.rings.finite_rings.integer_mod.IntegerMod_int'>","content_type":"text/plain"}}}],"key":"ZO8A3OrOM6"}],"key":"a8tpx2S5NL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"","key":"l3TQgVu8ot"},{"type":"output","id":"IXhjQlhdunefaWs1BjgMm","data":[],"key":"NV8IlrdS0R"}],"key":"IPEljrJpcm"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 + f2\nf3","key":"vr6Ek6U4C1"},{"type":"output","id":"5Bj6tmyU-flXVMcfPdXSU","data":[{"output_type":"execute_result","execution_count":55,"metadata":{},"data":{"text/plain":{"content":"5 + 7x + 9x^2","content_type":"text/plain"}}}],"key":"dk3uPsyhjM"}],"key":"ntwE2LRWfx"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5, 6])\nf3 = f1 * f2\nf3","key":"Xf0de86jlb"},{"type":"output","id":"Ld0UekwwLv60-qxUcZ7IV","data":[{"output_type":"execute_result","execution_count":56,"metadata":{},"data":{"text/plain":{"content":"4 + 13x + 28x^2 + 27x^3 + 18x^4","content_type":"text/plain"}}}],"key":"twMbx39yBa"}],"key":"gzGT5lNJuZ"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def poly(cof):\n    return sum([cof[i] * X^i for i in range(len(cof))])\n\npoly([1, 2, 3])\n","key":"ypneYpztEl"},{"type":"output","id":"_Y2et7GweSB9Ix0pQdp83","data":[{"output_type":"execute_result","execution_count":57,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"AgmVSAG5xL"}],"key":"f6Oo9QxGGL"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"poly([1, 2, 3]) * poly([4, 5, 6])","key":"Ze4JQcDZ6e"},{"type":"output","id":"7M_fDvodWawsxiALCs5t7","data":[{"output_type":"execute_result","execution_count":58,"metadata":{},"data":{"text/plain":{"content":"18*X^4 + 27*X^3 + 28*X^2 + 13*X + 4","content_type":"text/plain"}}}],"key":"QvjSpEteWY"}],"key":"kb3doX1QyC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"f1 = UniPolynomial([1, 2, 3])\nf2 = UniPolynomial([4, 5])\ndivmod(f1, f2)","key":"U2LeoXxpyG"},{"type":"output","id":"hK4EYX1WOR-bC4gKGz3CN","data":[{"output_type":"execute_result","execution_count":59,"metadata":{},"data":{"text/plain":{"content":"(108 + 155x, 148)","content_type":"text/plain"}}}],"key":"csbM6NpFjy"}],"key":"ZPnBdBNDna"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(155*X + 108) * poly([4, 5]) + poly([148])","key":"DfnZncBIFA"},{"type":"output","id":"QxM9cyvRLcEg-Nm5C3wpS","data":[{"output_type":"execute_result","execution_count":60,"metadata":{},"data":{"text/plain":{"content":"3*X^2 + 2*X + 1","content_type":"text/plain"}}}],"key":"gjpO4Buybl"}],"key":"BHbiDtlGmP"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 = UniPolynomial.vanishing_polynomial([Fp(1), Fp(2), Fp(3), Fp(4)]); z4","key":"i4cGEwqVmc"},{"type":"output","id":"Wnhj0OHnHsn6HtmCrgEQs","data":[{"output_type":"execute_result","execution_count":61,"metadata":{},"data":{"text/plain":{"content":"24 + 143x + 35x^2 + 183x^3 + x^4","content_type":"text/plain"}}}],"key":"HOrNSArrCs"}],"key":"uUTKEV7iQq"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4 // (UniPolynomial([-1, 1])), z4 % (UniPolynomial([-1, 1]))","key":"P31R7mLyMc"},{"type":"output","id":"v7j1Of_XeauvW9OjisodI","data":[{"output_type":"execute_result","execution_count":62,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"CEYgLQe3rr"}],"key":"xrJJtGkmhW"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"z4.division_by_linear_divisor(Fp(1))","key":"IpUjn9bjBv"},{"type":"output","id":"i8TCDwzO2GHXeAdgPDEFb","data":[{"output_type":"execute_result","execution_count":63,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"LFotNXhC4K"}],"key":"hNiB0H4Rbf"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))","key":"yKbQouZqsa"},{"type":"output","id":"EUtdX8VUge9y1qS_lLtkC","data":[{"output_type":"execute_result","execution_count":64,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"VmAi9tEPJW"}],"key":"Kz3OUxmOs2"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.polynomial_division_with_remainder([24, 143, 35, 183, 1], [Fp(-1), Fp(1)])","key":"oiVEtkIhzR"},{"type":"output","id":"24HU_chE6H7llC6yCY_t-","data":[{"output_type":"execute_result","execution_count":65,"metadata":{},"data":{"text/plain":{"content":"([169, 26, 184, 1], [])","content_type":"text/plain"}}}],"key":"S5y4rXf1Uh"}],"key":"VWLjiaSEJY"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"divmod(z4, UniPolynomial([-1, 1]))\n","key":"O8VZWzhzQA"},{"type":"output","id":"EJtOEO36cVsS_YOHNGiZE","data":[{"output_type":"execute_result","execution_count":66,"metadata":{},"data":{"text/plain":{"content":"(169 + 26x + 184x^2 + x^3, 0)","content_type":"text/plain"}}}],"key":"Df2uyMjvID"}],"key":"tSpsGGgpkM"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"(X-1)*(X-2)*(X-3)*(X-4)","key":"GVImG62zGp"},{"type":"output","id":"n36BXkkD5ffxErC8UXUfa","data":[{"output_type":"execute_result","execution_count":67,"metadata":{},"data":{"text/plain":{"content":"X^4 + 183*X^3 + 35*X^2 + 143*X + 24","content_type":"text/plain"}}}],"key":"O9lvr9QWgB"}],"key":"URHiDhRXXC"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.compute_coeffs_from_evals_fast([5, 3, 2, 4], [1, 2, 3, 4]); cof","key":"MjnkXzS4sJ"},{"type":"output","id":"-S5wb91O_E_V2CgQTGBsw","data":[{"output_type":"execute_result","execution_count":68,"metadata":{},"data":{"text/plain":{"content":"[6, 161, 95, 129]","content_type":"text/plain"}}}],"key":"D8mYs4JnDc"}],"key":"Wr5FsfRG11"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"[poly(cof).subs(X=i+1) for i in range(4)]","key":"ErRjIVSTnW"},{"type":"output","id":"oBJDgDyvNAKtZjeG_t7FL","data":[{"output_type":"execute_result","execution_count":69,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"V0TpP2Lyp1"}],"key":"ONyz5Eix3S"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.compute_evals_from_coeffs_fast(cof, [1, 2, 3, 4])","key":"dJEfmpX3en"},{"type":"output","id":"NarEEUMOwNSxyL86aH2uQ","data":[{"output_type":"execute_result","execution_count":70,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"V8XEhZdkYl"}],"key":"xyqZgCjCSz"},{"type":"block","kind":"notebook-content","children":[],"key":"kgR0Lyc7AT"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"cof = UniPolynomial.ntt_coeffs_from_evals([5, 3, 2, 4], 2, H4[1]); cof","key":"bSPLZHpTeO"},{"type":"output","id":"gsxQA6W_DUqby8g9cNrm-","data":[{"output_type":"execute_result","execution_count":71,"metadata":{},"data":{"text/plain":{"content":"[100, 77, 0, 21]","content_type":"text/plain"}}}],"key":"ycZXMQ7Zdc"}],"key":"nJs01LBtov"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"UniPolynomial.ntt_evals_from_coeffs(cof, 2, H4[1])","key":"skxBGauip3"},{"type":"output","id":"dROuMviiMK2-27fCrmrpz","data":[{"output_type":"execute_result","execution_count":72,"metadata":{},"data":{"text/plain":{"content":"[5, 3, 2, 4]","content_type":"text/plain"}}}],"key":"F64KVisEnU"}],"key":"jeTi39H7Ad"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Optimization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xPd5xRV2BT"}],"identifier":"optimization","label":"Optimization","html_id":"optimization","implicit":true,"key":"HwMP6jtwSP"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Prover doesn’t need to send ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dgVkbpSHVd"},{"type":"inlineMath","value":"h^{(i)}(\\beta^2)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>h</mi><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow></msup><mo stretchy=\"false\">(</mo><msup><mi>β</mi><mn>2</mn></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h^{(i)}(\\beta^2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.138em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">h</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mclose mtight\">)</span></span></span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"lf9SAkhbq0"}],"key":"dK45Yc4enj"}],"key":"kislXWb0oZ"}],"key":"y6AxXqy4HW"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"## Interpolate two points into a polynomial and evaluate it at X=r\n#\n#   f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n#\n#   f(r) = (a+b)/2 + r * (a-b) / (2*x)\n#\n# \n#(evals_pos[i] + evals_neg[i])/2 + point[i] * (evals_pos[i] - evals_neg[i])/(2*r)))\n\n\ndef interp_and_eval_line(a, b, r, x):\n    \"\"\"\n    Interpolate two points into a polynomial and evaluate it at X=r\n\n        f(X) = [(-x, a), (x, b)] -> (a+b)/2 + ((a-b) / (2*x)) * X\n\n        f(r) = (a+b)/2 + r * (a-b) / (2*x)\n    Args:\n        a (int): The evaluation at -x\n        b (int): The evaluation at x\n        r (int): The point at which to evaluate the polynomial\n        x (int): The x-coordinate of the point\n\n    Returns:\n        int: The result of evaluating the polynomial at X=r\n    \"\"\"\n    return ((a + b) / 2 + r * (a - b) / (2 * x))","key":"Yp0B624751"},{"type":"output","id":"ZR3-gyWZcH6q88-QGQREc","data":[],"key":"XvbXM9H5p9"}],"key":"d22DpZXhsg"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def prove_eval_arg_opt_opt(C, f, point, v, transcript, debug=0):\n    \"\"\"\n    C: commitment to f\n    f: polynomial\n    point: evaluation point\n    v: evaluation value\n    Rng: randomness\n    \"\"\"\n    \n    n = len(f)\n    k = log_2(n)\n    if len(point) != k:\n        raise ValueError(\"Invalid evaluation point, k={}, while len(point)={}\".format(k, len(point)))\n    if not is_power_of_two(n):\n        raise ValueError(\"Invalid polynomial length\")\n    \n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    # Split and fold polynomials\n    coeffs = f[:]\n    h_uni_cm_vec = []\n    h_uni_poly_vec = [coeffs]\n    for i in range(k-1):\n        f_even = coeffs[::2]\n        f_odd = coeffs[1::2]\n        coeffs = [Fp(f_even[j] + point[i] * f_odd[j])  for j in range(len(f_even))]\n        h_cm = kzg10.commit(coeffs)\n\n        transcript.absorb(h_cm)\n\n        h_uni_poly_vec.append(coeffs)\n        h_uni_cm_vec.append(h_cm)\n\n    if debug > 0: \n        coeffs = [coeffs[i] + point[k-1] * coeffs[i+1] for i in range(0, len(coeffs), 2)]\n        print(\"check: fully folded polynomial must be equal to the claimed evaluation: {} = {}\".format(coeffs[0], v))\n        assert (coeffs[0] == v)\n        assert len(coeffs) == 1\n        print(\"coeffs=\", coeffs)\n        print(\"h_uni_cm_vec=\", h_uni_cm_vec)\n        print(\"h_uni_poly_vec=\", h_uni_poly_vec)\n\n    # Sample randomness and reply evaluations\n    beta = transcript.squeeze()\n    print(\"beta=\", beta)\n    evals_pos = []\n    evals_neg = []    \n    evals_sq = []\n    for i in range(k):\n        poly = h_uni_poly_vec[i]\n        poly_at_beta = uni_eval_from_coeffs(poly, beta)\n        poly_at_neg_beta = uni_eval_from_coeffs(poly, (-1) * beta)\n        poly_at_beta_sq = uni_eval_from_coeffs(poly, beta^2)\n        evals_pos.append(poly_at_beta)\n        evals_neg.append(poly_at_neg_beta)\n        evals_sq.append(poly_at_beta_sq)\n        transcript.absorb(poly_at_beta)\n        transcript.absorb(poly_at_neg_beta)\n\n    transcript.absorb(evals_sq[0])\n\n    print(\"evals_pos=\", evals_pos)\n    print(\"evals_neg=\", evals_neg)\n    print(\"evals_sq=\", evals_sq)\n\n    gamma = transcript.squeeze()\n    \n    if debug > 0: \n        print(\"gamma=\", gamma)\n\n    h_agg = [0] * n\n    for i in range(n):\n        for j in range(k):\n            poly = h_uni_poly_vec[j]\n            if i < len(poly):\n                h_agg[i] += poly[i] * (gamma**j)\n    if debug > 1: \n        print(\"h_agg=\", h_agg)\n    \n    h_agg_poly_at_beta = uni_eval_from_coeffs(h_agg, beta)\n    h_agg_poly_at_neg_beta = uni_eval_from_coeffs(h_agg, -beta)\n    h_agg_poly_at_beta_sq = uni_eval_from_coeffs(h_agg, beta^2)\n\n    if debug > 1: \n        print(\"h_agg_poly_at_beta={}, h_agg_poly_at_neg_beta={}, h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq))\n\n    # DEBUG: verify h_agg\n    if debug > 0:\n        print(\"check: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\")\n        assert h_agg_poly_at_beta == sum([evals_pos[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_neg_beta == sum([evals_neg[i]*(gamma**i) for i in range(k)])\n        assert h_agg_poly_at_beta_sq == sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    # DEBUG: verify evaluations\n    if debug > 0:\n        dbg_evals_sq = evals_sq[:] + [v]\n        print(\"dbg_evals_sq=\", dbg_evals_sq)\n        for i in range(k):\n            print(\"check: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\")\n            print(\"i={}, {}, {}\".format(i, \n                dbg_evals_sq[i+1], interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta)))\n\n    h_agg_poly = UniPolynomial(h_agg)\n    interp_poly = UniPolynomial.interpolate([h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], [beta, -beta, beta^2])\n    vanishing_poly = UniPolynomial([-beta, 1])*UniPolynomial([beta, 1]) * UniPolynomial([-beta*beta, 1])\n    g_poly = h_agg_poly - interp_poly\n    quo_poly, rem = divmod(g_poly, vanishing_poly)\n\n    if debug > 0:\n        # assert rem == UniPolynomial([0])\n        pass\n\n    if debug > 1:\n        print(\"interp_poly=\", interp_poly)\n        print(\"vanishing_poly=\", vanishing_poly)    \n        print(\"quo={}, rem={}\".format(quo_poly, rem))\n        print(\"quo_poly={}\".format(quo_poly))\n        print(\"rem={}\".format(rem))\n        print(\"quo={}\".format(quo_poly))\n    \n    Cq = kzg10.commit(quo_poly.coeffs)\n    transcript.absorb(Cq)\n\n    zeta = transcript.squeeze()\n    print(\"zeta={}\".format(zeta))\n    \n    interp_at_zeta =interp_poly.evaluate(zeta)\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n    \n    r_poly = h_agg_poly - UniPolynomial([interp_at_zeta]) - quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n    print(\"h_agg_poly - UniPolynomial([interp_at_zeta])=\", h_agg_poly - UniPolynomial([interp_at_zeta]))\n    print(\"quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))=\", quo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta)))\n    print(\"r_poly=\", r_poly)\n\n    print(\"r(zeta)={}\".format(r_poly.evaluate(zeta)))\n\n    Cr = kzg10.commit(r_poly.coeffs)\n\n    transcript.absorb(Cr)\n\n    arg_r_poly_at_zeta =kzg10.prove_eval(r_poly.coeffs, point=zeta, v=0)\n\n    # DEBUG: verify r_poly argument\n    if debug > 0:\n        print(\"check: `r(z)=0` argument must hold\")\n        assert kzg10.verify_eval(Cr, arg_r_poly_at_zeta, point=zeta, v=0)\n\n    return (h_uni_cm_vec, evals_pos, evals_neg, evals_sq[:1], Cq, arg_r_poly_at_zeta)","key":"pRhQfIBJcl"},{"type":"output","id":"LksXra6qRLZOEgI4caqCP","data":[],"key":"aPqZIvs6oe"}],"key":"vNyUVV5XmF"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"def verify_eval_arg_opt_opt(C, arg, point, v, transcript, debug=0):\n    \"\"\"\n    Verify an optimized evaluation argument proof.\n\n    Args:\n    C: commitment to f\n    arg: argument to be verified (output of prove_eval_arg_opt)\n    point: evaluation point\n    v: claimed evaluation value\n    transcript: proof transcript\n    \"\"\"\n    k = len(point)\n    n = 1 << k\n    \n    if debug > 1:\n        print(\"C={}, arg={}, point={}, v={}\".format(C, arg, point, v))\n\n    transcript.absorb(C)\n    transcript.absorb(point)\n    transcript.absorb(v)\n\n    h_uni_cm_vec, evals_pos, evals_neg, evals_sq, Cq, Cw = arg\n\n    for i in range(len(h_uni_cm_vec)):\n        transcript.absorb(h_uni_cm_vec[i])\n    \n    beta = transcript.squeeze()\n    if debug > 1:\n        print(\"> beta = {}\".format(beta))\n\n    for i in range(k):\n        transcript.absorb(evals_pos[i])\n        transcript.absorb(evals_neg[i])\n        evals_sq.append(interp_and_eval_line(evals_pos[i], evals_neg[i], point[i], beta))\n    transcript.absorb(evals_sq[0])\n\n    if debug > 1:\n        print(\"> evals_sq = {}\".format(evals_sq))\n    \n    # 1st check:\n    if debug > 0:\n        print(\"🛡️: check if the evaluation f({})={} is correct\".format(point, v))\n        print(\"    by computing the folded polynomial h_{}({}^2) ?= {}\".format(k, beta, v))\n        if (evals_sq[-1] == v): \n            print(\"😀 ✅\")\n    if not (evals_sq[-1] == v):\n        return False\n    \n    gamma = transcript.squeeze()\n    if debug > 1:\n        print(\"> gamma = {}\".format(gamma))\n\n    Ch = C\n    for i in range(0, k-1):\n        Ch = Ch + (gamma**(i+1)) * h_uni_cm_vec[i]\n\n    if debug > 1:\n        print(\"> Commitment of h(X): Ch={}\".format(Ch))\n    \n    # Compute h_agg(beta), h_agg(-beta), h_agg(beta^2)\n    h_agg_poly_at_beta = sum([evals_pos[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_neg_beta = sum([evals_neg[i]*(gamma**i) for i in range(k)])\n    h_agg_poly_at_beta_sq = sum([evals_sq[i]*(gamma**i) for i in range(k)])\n\n    if debug > 1:\n        print(\"> h_agg_poly_at_beta={}\".format(h_agg_poly_at_beta))\n        print(\"> h_agg_poly_at_neg_beta={}\".format(h_agg_poly_at_neg_beta))\n        print(\"> h_agg_poly_at_beta_sq={}\".format(h_agg_poly_at_beta_sq))\n\n    # Interpolate c(X) from three points: \n    #\n    #    [(beta, h_agg(beta)), (-beta, h_agg(-beta)), (beta^2, h_agg(beta^2))]\n\n    interp_poly = UniPolynomial.interpolate(\n        [h_agg_poly_at_beta, h_agg_poly_at_neg_beta, h_agg_poly_at_beta_sq], \n        [beta, -beta, beta**2])\n\n    # h_agg(X) - c(X) = q(X) * (X-beta)(X+beta)(X-beta^2)\n    # \n    # Receive Cq = Commit(c(X)) \n    transcript.absorb(Cq)\n\n    # Sample randomness\n    zeta = transcript.squeeze()\n\n    if debug > 1:\n        print(\"> zeta = {}\".format(zeta))\n    \n    # vanishing_poly_at_zeta= vanishing_poly.evaluate(zeta)\n    interp_at_zeta = interp_poly.evaluate(zeta)\n    vanishing_poly_at_zeta = ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))\n\n    print(\"interp_at_zeta={}\".format(interp_at_zeta))\n\n    Cr = Ch - kzg10.commit([interp_at_zeta]) - Cq * vanishing_poly_at_zeta\n\n    if debug > 1:\n        print(\"> Cr={}\".format(Cr))\n        print(\"> Cq={}\".format(Cq))\n\n    transcript.absorb(Cr)\n\n    # Verify r_poly argument\n    \n    # 2. Check if r(z)=0\n    Cw_verified = kzg10.verify_eval(Cr, Cw, point=zeta, v=0)\n\n    if debug > 0:\n        if Cw_verified: print(\"🛡️: check if r(z)=0 😀 ✅\")\n        else: print(\"🛡️: check if r(z)=0 😢 ❌\")\n\n    if not Cw_verified:\n        return False\n\n    return True","key":"Ibc9EG6Lmq"},{"type":"output","id":"xgbTn3nIZ9thrJuNKaVxw","data":[],"key":"Bxx4TyBdiv"}],"key":"VpyKkozgqg"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"arg = prove_eval_arg_opt_opt(ff_cm, [1, 3, 2, 1], \n            point=[91, 181], v=123, transcript=transcript.clone(), debug=1); arg","key":"EJUtytRB2S"},{"type":"output","id":"Vh4G05uopiVghtBckXLuV","data":[{"name":"stdout","output_type":"stream","text":"check: fully folded polynomial must be equal to the claimed evaluation: 123 = 123\ncoeffs= [123]\nh_uni_cm_vec= [Commitment(93*X0 + 81)]\nh_uni_poly_vec= [[1, 3, 2, 1], [81, 93]]\nbeta= 117\nevals_pos= [37, 154]\nevals_neg= [102, 8]\nevals_sq= [116, 130]\ngamma= 103\ncheck: aggregated h(X) must be equal to sum(h_i(X)) at (beta, -beta, beta^2)\ndbg_evals_sq= [116, 130, 123]\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=0, 130, 130\ncheck: h_{i+1}(r^2) = h_i(r) + h_i(-r))/2 + x_i * (h_i(r) - h_i(-r))/(2*r)\ni=1, 123, 123\nzeta=159\ninterp_at_zeta=152\nh_agg_poly - UniPolynomial([interp_at_zeta])= 86 + 125x + 2x^2 + x^3\nquo_poly * ((zeta - beta) * (zeta + beta) * (zeta - beta*beta))= 146\nr_poly= 133 + 125x + 2x^2 + x^3\nr(zeta)=0\ncheck: `r(z)=0` argument must hold\n"},{"output_type":"execute_result","execution_count":76,"metadata":{},"data":{"text/plain":{"content":"([Commitment(93*X0 + 81)],\n [37, 154],\n [102, 8],\n [116],\n Commitment(1),\n Commitment(X0^2 - 32*X0 + 55))","content_type":"text/plain"}}}],"key":"vdnc1X5Pj0"}],"key":"wdmcY87Cpb"},{"type":"block","kind":"notebook-code","data":{"vscode":{"languageId":"python"}},"children":[{"type":"code","lang":"sage","executable":true,"value":"verify_eval_arg_opt_opt(ff_cm, arg, point=[91, 181], v=123, transcript=transcript.clone(), debug=1)","key":"IHe308LSGn"},{"type":"output","id":"9vvXiyDGyIhudVl-Kg0c3","data":[{"name":"stdout","output_type":"stream","text":"🛡️: check if the evaluation f([91, 181])=123 is correct\n    by computing the folded polynomial h_2(117^2) ?= 123\n😀 ✅\ninterp_at_zeta=152\n🛡️: check if r(z)=0 😀 ✅\n"},{"output_type":"execute_result","execution_count":77,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"Ud4np9iUxs"}],"key":"WgKBDCHJC0"}],"key":"NtUja5N8lP"},"references":{"cite":{"order":[],"data":{}}}}