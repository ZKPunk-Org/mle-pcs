{"version":2,"kind":"Notebook","sha256":"ba9ea168444b586ff8337e83ba68a3e088e1e179a359dda77585189e3316f4c0","slug":"src.deepfold","location":"/src/deepfold.ipynb","dependencies":[],"frontmatter":{"title":"Commit phase","content_includes_title":true,"kernelspec":{"name":"SageMath-10.4","display_name":"SageMath 10.4","language":"sage"},"github":"https://github.com/executablebooks/jupyter-book","numbering":{"title":{"offset":1}},"edit_url":"https://github.com/executablebooks/jupyter-book/blob/main/src/deepfold.ipynb","exports":[{"format":"ipynb","filename":"deepfold.ipynb","url":"/deepfold-03bbfdbf2ea23623b0be0662513778bc.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"F193 = GF(64*3+1)\nTWO_ADICITY = 6\nORDER = 64*3+1\nMULTIPLICATIVE_GENERATOR = F193.primitive_element()\nROOT_OF_UNITY = F193(MULTIPLICATIVE_GENERATOR**3)\nF193.primitive_element()\nR193.<X, A, B, X0, X1, X2, X3, X4, X5, A0, A1, A2, A3, A4, A5, A6, A7, A8, A9, A10, A11, A12, A13, A14, A15> = PolynomialRing(F193)","key":"RiuGoPwnbt"},{"type":"output","id":"WJES6potOe5Qd_R15Esr9","data":[],"key":"OAL70cn2pn"}],"key":"KklfRXZkP4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"from typing import Union, Optional, TypeVar\nfrom random import randint, Random\nfrom utils import prime_field_inv, is_power_of_two, log_2, next_power_of_two","key":"knr6P55Gwh"},{"type":"output","id":"sXiEeYtGCAlQQixSRCPOJ","data":[],"key":"rGp6307aSX"}],"key":"FzuB0RVb0B"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"class Fp:\n    field_modulus = ORDER\n\n    ROOT_OF_UNITY = ROOT_OF_UNITY\n    MULTIPLICATIVE_GENERATOR = MULTIPLICATIVE_GENERATOR\n    TWO_ADICITY = TWO_ADICITY\n\n    def __init__(self, val: Integer | int) -> None:\n        if self.field_modulus is None:\n            raise AttributeError(\"Field Modulus hasn't been specified\")\n\n        if isinstance(val, Fp):\n            self.n = val.n % self.field_modulus\n        elif isinstance(val, Integer):\n            self.n = val % self.field_modulus\n        elif Integer(val) == Integer(val):\n            self.n = Integer(val) % self.field_modulus\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(val))\n            )\n\n    def __add__(self, other: Union[Integer, \"Fp\"]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)((self.n + on) % self.field_modulus)\n\n    def __mul__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)((self.n * on) % self.field_modulus)\n\n    def __rmul__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        return self * other\n\n    def __radd__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        return self + other\n\n    def __rsub__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)((on - self.n) % self.field_modulus)\n\n    def __sub__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)((self.n - on) % self.field_modulus)\n\n    def __div__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)(\n            self.n * prime_field_inv(on, self.field_modulus) % self.field_modulus\n        )\n\n    def __truediv__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        return self.__div__(other)\n\n    def __rdiv__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        if isinstance(other, Fp):\n            on = other.n\n        elif isinstance(other, Integer):\n            on = other\n        elif Integer(other) == Integer(other):\n            on = Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n        return type(self)(\n            prime_field_inv(self.n, self.field_modulus) * on % self.field_modulus\n        )\n\n    def __rtruediv__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n        return self.__rdiv__(other)\n\n    # def __pow__(self, other: Union[\"Fp\", Integer]) -> \"Fp\":\n    #     if other == 0:\n    #         return type(self)(1)\n    #     elif other == 1:\n    #         return type(self)(self.n)\n    #     elif other % 2 == 0:\n    #         return (self * self) ** (other // 2)\n    #     else:\n    #         return ((self * self) ** (other // 2)) * self\n\n    def __eq__(self, other: Union[\"Fp\", Integer]) -> bool:\n        if isinstance(other, Fp):\n            return self.n == other.n\n        elif isinstance(other, Integer):\n            return self.n == other\n        elif Integer(other) == Integer(other):\n            return self.n == Integer(other)\n        else:\n            raise TypeError(\n                \"Expected an int or Fp object, but got object of type {}\"\n                .format(type(other))\n            )\n\n    def __ne__(self, other: Union[\"Fp\", Integer]) -> bool:\n        return not self == other\n\n    def __neg__(self) -> \"Fp\":\n        return type(self)(-self.n)\n\n    def __str__(self) -> str:\n        return self.repr()\n        \n    def __repr__(self) -> str:\n        return self.repr()\n    \n    # Override the default (inefficient) __pow__ function in py_ecc.fields.field_elements.FQ\n    def __pow__(self: \"Fp\", other: int) -> \"Fp\":\n        return type(self)(pow(self.n, other, self.field_modulus))\n    \n    # def __repr__(self) -> str:\n    #     return repr(self.n)\n\n    def __int__(self) -> int:\n        return self.n\n\n    @classmethod\n    def one(cls) -> \"Fp\":\n        return cls(1)\n\n    @classmethod\n    def zero(cls) -> \"Fp\":\n        return cls(0)\n    \n    @classmethod\n    def neg_one(cls) -> \"Fp\":\n        return cls(cls.field_modulus - 1)\n\n    @classmethod\n    def rand(cls, rndg: Optional[Random] = None) -> \"Fp\":\n        if rndg is None:\n            return cls(randint(1, cls.field_modulus - 1))\n        return cls(rndg.randint(1, cls.field_modulus - 1))\n    \n    @classmethod\n    def random(cls) -> \"Fp\":\n        return cls.rand()\n    \n    @classmethod\n    def rands(cls, rndg: Random, n: int) -> list[\"Fp\"]:\n        return [cls(rndg.randint(1, cls.field_modulus - 1)) for _ in range(n)]\n    \n    @classmethod\n    def from_bytes(cls, b: bytes) -> \"Fp\":\n        i = int.from_bytes(b, \"big\")\n        return cls(i)\n    \n    def inv(self) -> \"Fp\":\n        return Fp(prime_field_inv(self.n, self.field_modulus))\n    \n    def repr(self) -> str:\n        k = self.field_modulus // 2\n        if self.n < k:\n            return f\"{self.n}\"\n        else:\n            return f\"-{self.field_modulus - self.n}\"\n        \n    def exp(self: \"Fp\", other: int) -> \"Fp\":\n        return type(self)(pow(self.n, other, self.field_modulus))\n    \n    @classmethod\n    def compute_root_of_unity(cls) -> \"Fp\":\n        return cls(pow(cls.MULTIPLICATIVE_GENERATOR, ((cls.field_modulus - 1) // 2 ** cls.TWO_ADICITY), cls.field_modulus))\n    \n    @classmethod\n    def root_of_unity(cls) -> \"Fp\":\n        return cls(cls.ROOT_OF_UNITY)\n    \n    @classmethod\n    def multiplicative_generator(cls) -> \"Fp\":\n        return cls(cls.MULTIPLICATIVE_GENERATOR)\n\n    @classmethod\n    def nth_root_of_unity(cls, n: int) -> \"Fp\":\n        assert is_power_of_two(n), \"n must be a power of two\"\n        return cls(pow(cls.ROOT_OF_UNITY, 2**(cls.TWO_ADICITY - log_2(n)), cls.field_modulus))","key":"Olzx8PoEqt"},{"type":"output","id":"Anub7I5iRlq71IZrqOA_g","data":[],"key":"fzGTRnCxY5"}],"key":"KrtjXs549K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"from unipoly2 import UniPolynomial, UniPolynomialWithFft, bit_reverse_permutation\nfrom mle2 import MLEPolynomial\nUniPolynomialWithFft.set_field_type(Fp)\nMLEPolynomial.set_field_type(Fp)\nfrom merkle import MerkleTree","key":"T408aEELon"},{"type":"output","id":"0f-xukGZ4CK4RYtKuCfPB","data":[],"key":"aMkdbWUU5I"}],"key":"UzUVpMf0eG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f_mle = MLEPolynomial([Fp(1), Fp(3), Fp(2), Fp(1),\n                    Fp(2), Fp(-2), Fp(1), Fp(2)], 3)\nf_cm = MerkleTree(f_mle.evals)\nus = [Fp(2), Fp(-1), Fp(2)]\nv = f_mle.evaluate(us)\nv, f_cm.root","key":"UmS1LptUqn"},{"type":"output","id":"BuC3hmpZnQL3LFC0ULFJf","data":[{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"(-40, 'c86117467dc48f44adcbdff0f6ccfd5e1edfbf358ff48efe3441f2cb8b34aca2')","content_type":"text/plain"}}}],"key":"zmag8N7yrt"}],"key":"fs3MXomuev"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"def rs_encode(f: list[Field], coset: Field, blowup_factor: int) -> list[Field]:\n    n = next_power_of_two(len(f))\n    N = n * blowup_factor\n\n    omega_Nth = Fp.nth_root_of_unity(N)\n    # print(f\"omega_Nth = {omega_Nth}\")\n    k = log_2(N)\n    # print(f\"n = {n}, N = {N}, k = {k}\")\n    vec = f + [Fp.zero()] * (N - len(f))\n    # print(f\"vec = {vec}, len(vec) = {len(vec)}\")\n    return UniPolynomialWithFft.fft_coset_rbo(vec, coset, k, omega=omega_Nth)\n     ","key":"Tuoi5WMwvO"},{"type":"output","id":"JLbXEl2A8lxahLE2a25fA","data":[],"key":"dvPjYs5a9u"}],"key":"PKEa5LoNNx"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f = f_mle.evals\nalpha = Fp(2)\nf_len = len(f)\ng = Fp.multiplicative_generator()\nblowup_factor = 2\nf_code_len = f_len * blowup_factor\nprint(f\"f_code_len = {f_code_len}, g={g}, blowup_factor={blowup_factor}\")","key":"mcEfsxYnUl"},{"type":"output","id":"AK8CHMZSlb51XPjH_r4Y7","data":[{"name":"stdout","output_type":"stream","text":"f_code_len = 16, g=5, blowup_factor=2\n"}],"key":"HL9ITTUNel"}],"key":"DuWEnoWwIg"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Commit phase","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"caiPdypf14"}],"identifier":"commit-phase","label":"Commit phase","html_id":"commit-phase","implicit":true,"key":"aN0oVFVoUe"}],"key":"VLUw5FFJNF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"debug = 2\ntwiddles = UniPolynomialWithFft.precompute_twiddles_for_fft(f_code_len, is_bit_reversed=True)\ncoset = Fp.multiplicative_generator()","key":"lZKnWHEQD2"},{"type":"output","id":"o_yhpvzwkXQPTFE6lYG8W","data":[],"key":"IEPdrCV0ov"}],"key":"eebHA9C1Hh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f = f_mle.evals.copy()\n\n# Sumcheck Round 0\n\neq = MLEPolynomial.eqs_over_hypercube(us)\nn = len(f)\nhalf = n >> 1\nsum0 = v\nv, f, eq","key":"VPd2BEDIlG"},{"type":"output","id":"uPO7Xj535s5iqpBUPwavh","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"(-40, [1, 3, 2, 1, 2, -2, 1, 2], [2, -4, -1, 2, -4, 8, 2, -4])","content_type":"text/plain"}}}],"key":"heLf5MFRp2"}],"key":"juE2kHrAIz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"alpha = Fp(31)","key":"ykV1YERhIq"},{"type":"output","id":"0oVYWrb1s-n2asg-iCWFk","data":[],"key":"ItDG76TJX4"}],"key":"Uvayw1ilje"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"def compute_alpha_powers(alpha: Fp, n: int) -> list[Fp]:\n    return [alpha**(2**i) for i in range(n)]\nalpha_powers = compute_alpha_powers(alpha, 3)\nalpha_powers","key":"MY0S06DLbZ"},{"type":"output","id":"w26pHoBolCVpB5L4qnaEA","data":[{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"[31, -4, 16]","content_type":"text/plain"}}}],"key":"vOgLAje6s8"}],"key":"pqFI0Hmacj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"def fold(f: list[Fp], r: Fp) -> list[Fp]:\n    n = len(f)\n    assert n % 2 == 0, f\"n = {n}, n must be even\"\n    half = n >> 1\n    f_even = f[::2]\n    f_odd = f[1::2]\n    return [f_even[i] + r * (f_odd[i] - f_even[i]) for i in range(half)]\nfold([A0, A1, A2, A3, A4, A5, A6, A7], X0)","key":"tglNlMcwR7"},{"type":"output","id":"vupBgE1GBG2-k-1lEBxDu","data":[{"output_type":"execute_result","execution_count":40,"metadata":{},"data":{"text/plain":{"content":"[-X0*A0 + X0*A1 + A0,\n -X0*A2 + X0*A3 + A2,\n -X0*A4 + X0*A5 + A4,\n -X0*A6 + X0*A7 + A6]","content_type":"text/plain"}}}],"key":"Pho8vEgtqu"}],"key":"pj9NbHMqI0"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"def expanded_partial_evaluate(f: list[Fp], us: list[Fp]) -> list[Fp]:\n    \"\"\"\n    Evaluate mle polynomial *partially* from x_{n-1}, x_{n-2}, ..., x_{n-k}\n    \"\"\"\n    k, n = len(us), len(f)\n    assert n == 2**k, f\"n = {n}, k = {k}\"\n\n    rs, e = [], f.copy()\n    half = n >> 1\n    for i in range(k):\n        e_low, e_high = e[:half], e[half:]\n        e = [e_low[j] + us[k-i-1] * (e_high[j] - e_low[j]) for j in range(half)]\n        rs += e\n        half >>= 1\n    return rs\n\nexpanded_partial_evaluate([A0, A1, A2, A3], [X0, X1])","key":"lZaxAhSx9o"},{"type":"output","id":"xkI-sd0tFHOXkfGBrilwi","data":[{"output_type":"execute_result","execution_count":72,"metadata":{},"data":{"text/plain":{"content":"[-X1*A0 + X1*A2 + A0,\n -X1*A1 + X1*A3 + A1,\n X0*X1*A0 - X0*X1*A1 - X0*X1*A2 + X0*X1*A3 - X0*A0 - X1*A0 + X0*A1 + X1*A2 + A0]","content_type":"text/plain"}}}],"key":"u6WNQD0UCd"}],"key":"ZKGvqZ3ay6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"expanded_partial_evaluate([Fp(1), Fp(2), Fp(3), Fp(4)], [Fp(3), Fp(2)])","key":"injH1kT819"},{"type":"output","id":"HzY8E4YbqrhIL-gevOaqR","data":[{"output_type":"execute_result","execution_count":73,"metadata":{},"data":{"text/plain":{"content":"[5, 6, 8]","content_type":"text/plain"}}}],"key":"DXfFjwwx5W"}],"key":"UyKzzJA83n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"MLEPolynomial([Fp(1), Fp(2), Fp(3), Fp(4)], 2).evaluate([Fp(3), Fp(2)])","key":"xe9pRKHnL9"},{"type":"output","id":"rOyHxDcchjVsPSYxIxiky","data":[{"output_type":"execute_result","execution_count":74,"metadata":{},"data":{"text/plain":{"content":"8","content_type":"text/plain"}}}],"key":"SbC5GMYaIK"}],"key":"IyF04tKIJP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"expanded_partial_evaluate([Fp(1), Fp(2), Fp(3), Fp(4), Fp(5), Fp(6), Fp(7), Fp(8)], [Fp(4), Fp(2), Fp(3)])","key":"BLxxI1M04C"},{"type":"output","id":"eODpKJD9NvPj-yXdRsYdq","data":[{"output_type":"execute_result","execution_count":75,"metadata":{},"data":{"text/plain":{"content":"[13, 14, 15, 16, 17, 18, 21]","content_type":"text/plain"}}}],"key":"NjnMzR1bU2"}],"key":"muEWc5Uvne"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"MLEPolynomial([Fp(1), Fp(2), Fp(3), Fp(4), Fp(5), Fp(6), Fp(7), Fp(8)], 3).evaluate([Fp(4), Fp(2), Fp(3)])","key":"gmLUHR1B6t"},{"type":"output","id":"KPwbe1McHRYJ_ghG4WaGT","data":[{"output_type":"execute_result","execution_count":76,"metadata":{},"data":{"text/plain":{"content":"21","content_type":"text/plain"}}}],"key":"NbH9p6w9p8"}],"key":"b9ZhHSw7j7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f_at_alpha = f_mle.evaluate(alpha_powers)\nf_at_alpha\n","key":"JXwSu6j6Xz"},{"type":"output","id":"s43NZets7JbCcf6aL264f","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/plain":{"content":"62","content_type":"text/plain"}}}],"key":"xGWhY4Isj7"}],"key":"bkXFHgcRLr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# FRI Round 0\n\nf0_code = rs_encode(f, coset, 2)\nif debug > 1:\n    print(f\"P> check f0_code\")\n    f_orig_evals = bit_reverse_permutation(f0_code)\n    f_orig_coeffs = UniPolynomialWithFft.ifft_coset(f_orig_evals, coset, log_2(f_code_len))\n    f_orig = UniPolynomial(f_orig_coeffs)\n    assert f_orig.coeffs == f, f\"f_orig != f0, f_orig = {f_orig.coeffs}, f = {f}\"\n    print(f\"P> check f0_code passed\")","key":"yicCWApCdq"},{"type":"output","id":"BJzl697cS3RbMsQjQt3GH","data":[{"name":"stdout","output_type":"stream","text":"P> check f0_code\nP> check f0_code passed\n"}],"key":"oF7zHUVVGD"}],"key":"FwAMwBzekO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"alpha0 = Fp(32)\nalpha0_powers = compute_alpha_powers(alpha0, 3)\nalpha0_powers","key":"D06towjqSq"},{"type":"output","id":"CMm3B8U8cJ0kQ0swfEPOg","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"[32, 59, 7]","content_type":"text/plain"}}}],"key":"f6WB1afGPJ"}],"key":"xMTTesi9KI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 1\n\nf0_even = f[::2]\nf0_odd = f[1::2]\nf0_even_mle = MLEPolynomial(f0_even, f_mle.num_var-1)\nf0_odd_mle = MLEPolynomial(f0_odd, f_mle.num_var-1)\n\n# construct hz(X): hz(X) = f(X, u1, u2,...)\nhz_at_0 = f0_even_mle.evaluate(us[1:])\nhz_at_1 = f0_odd_mle.evaluate(us[1:])\nhz = [hz_at_0, hz_at_1]\n\nassert (UniPolynomial.evaluate_from_evals(hz, us[0], [Fp(0), Fp(1)])) == v, \\\n    f\"hz(us[0]) = {UniPolynomial.evaluate_from_evals(hz, us[0])}, v = {v}\"","key":"vNituF8BEC"},{"type":"output","id":"nVKFAEu_N3ApW6Kquv3LV","data":[],"key":"fgiraKA6dH"}],"key":"kTs2SAhZNS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# alpha0 = Fp.rand()\nr0 = Fp(-30)\nr0","key":"sSrgDobi7b"},{"type":"output","id":"WlX29iTJB5ltPs5LK87jE","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/plain":{"content":"-30","content_type":"text/plain"}}}],"key":"o5mKUPL942"}],"key":"nQbvidlNbq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck fold \n\nf1 = [(Fp(1) - r0) * f0_even[i] + r0 * f0_odd[i] for i in range(half)]\n\n# compute the new sum = h(r0)\nhz_r0 = UniPolynomial.evaluate_from_evals(hz, r0, [Fp(0), Fp(1)])","key":"jzpzDEhhPa"},{"type":"output","id":"A_-Ztr5yC-7FXDDK59LNz","data":[],"key":"c6QQ4xdKaG"}],"key":"hShimtKRgo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"half >>= 1","key":"nn6tVUMvIj"},{"type":"output","id":"wp8uMGnA8R8zX8aG_7-2q","data":[],"key":"lezRTtUhCB"}],"key":"t5uGb5bKfd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 2\n\nf1_even = f1[::2]\nf1_odd = f1[1::2]\nf1_even_mle = MLEPolynomial(f1_even, f_mle.num_var-2)\nf1_odd_mle = MLEPolynomial(f1_odd, f_mle.num_var-2)\n\n# construct hz(X): hz(X) = f1(X, u1, u2,...)\nhz_at_0 = f1_even_mle.evaluate(us[2:])\nhz_at_1 = f1_odd_mle.evaluate(us[2:])\nhz = [hz_at_0, hz_at_1]\n\nassert (UniPolynomial.evaluate_from_evals(hz, us[1], [Fp(0), Fp(1)])) == hz_r0, \\\n    f\"hz(us[1]) = {UniPolynomial.evaluate_from_evals(hz, us[1])}, hz_r0 = {hz_r0}\"\n","key":"G1YdwsavaJ"},{"type":"output","id":"eLnOWXzsxw7OoR33lqEvF","data":[],"key":"jEq4Ae1jYf"}],"key":"sVrTd04oEE"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# alpha0 = Fp.rand()\nr1 = Fp(-32)\nr1","key":"JalPl8q0Hy"},{"type":"output","id":"0rvYRq_OK83sXmgm1Nzvr","data":[{"output_type":"execute_result","execution_count":22,"metadata":{},"data":{"text/plain":{"content":"-32","content_type":"text/plain"}}}],"key":"PMdKrfjVu3"}],"key":"uXkX0yWnKY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck fold \n\nf2 = [(Fp(1) - r1) * f1_even[i] + r1 * f1_odd[i] for i in range(half)]\n\n# compute the new sum = h(r1)\nhz_r1 = UniPolynomial.evaluate_from_evals(hz, r1, [Fp(0), Fp(1)])\nhz_r1","key":"ZB0OniPSOd"},{"type":"output","id":"-36V9rcH6f7-bd6woY9Cd","data":[{"output_type":"execute_result","execution_count":23,"metadata":{},"data":{"text/plain":{"content":"-52","content_type":"text/plain"}}}],"key":"l88UJNka45"}],"key":"aqSZGc3y3b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"half >>= 1","key":"y0eJ0XttUz"},{"type":"output","id":"hv9EehyKORR-OUL0gI-_7","data":[],"key":"dajT65gfQX"}],"key":"zwxXczgXNG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 2\n\nf2_even = f2[::2]\nf2_odd = f2[1::2]\nf2_even_mle = MLEPolynomial(f2_even, f_mle.num_var-3)\nf2_odd_mle = MLEPolynomial(f2_odd, f_mle.num_var-3)\n\n# construct hz(X): hz(X) = f2(X) = f(r0, r1, X)\nhz_at_0 = f2_even_mle.evaluate(us[3:])\nhz_at_1 = f2_odd_mle.evaluate(us[3:])\nhz = [hz_at_0, hz_at_1]\n\nassert (UniPolynomial.evaluate_from_evals(hz, us[2], [Fp(0), Fp(1)])) == hz_r1, \\\n    f\"hz(us[2]) = {UniPolynomial.evaluate_from_evals(hz, us[2])}, hz_r1 = {hz_r1}\"","key":"OCYgIgf2vO"},{"type":"output","id":"9tAkl6Pg_kmimIZX3flcC","data":[],"key":"RDk0gUgAmh"}],"key":"wx8QXyAx7P"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# alpha0 = Fp.rand()\nr2 = Fp(-33)\nr2\n","key":"gaQn8iyNmh"},{"type":"output","id":"QvC2dJSj2t4xYWeB6gy8W","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"-33","content_type":"text/plain"}}}],"key":"zyRVuSx9Sx"}],"key":"XpVThx4FOH"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck fold \n\nf3 = [(Fp(1) - r2) * f2_even[i] + r2 * f2_odd[i] for i in range(half)]\n\n# compute the new sum = h(r2)\nhz_r2 = UniPolynomial.evaluate_from_evals(hz, r2, [Fp(0), Fp(1)])\nhz_r2","key":"QgsHuJdlhA"},{"type":"output","id":"_ve6AiUivkAGM9ISD8B0Q","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"text/plain":{"content":"-86","content_type":"text/plain"}}}],"key":"jGekLWxjpy"}],"key":"gsV2XEdOvv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Check the final result: h(r0, r1, r2) = f(r0, r1, r2)\n\nhz_r2 == f_mle.evaluate([r0, r1,r2])","key":"SvP5c7rUYl"},{"type":"output","id":"WaNL-54MKM_DaOXNmGYWL","data":[{"output_type":"execute_result","execution_count":28,"metadata":{},"data":{"text/plain":{"content":"True","content_type":"text/plain"}}}],"key":"G1GyjyRlD8"}],"key":"WDYq54Fn8T"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Simplified Sumcheck","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q4KF2VUvOS"}],"identifier":"simplified-sumcheck","label":"Simplified Sumcheck","html_id":"simplified-sumcheck","implicit":true,"key":"U6FZD6zMpu"}],"key":"HpvcyuhlaL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"sum_checked = v\nhalf = n >> 1\nk = len(us)\n# f_code = f0_code\n# coset = self.coset_gen\nconstant = None\nr_vec = []\nsumcheck_h_vec = []\n# code_commitments = []\n# trees = [MerkleTree(f_code)]\n# codes = [f_code]","key":"DCArpFQdRb"},{"type":"output","id":"Gn1hrcyDW642goihS1-Wg","data":[],"key":"T5J0mIzM6v"}],"key":"bOXGJv7Ln8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f_partial_evals = expanded_partial_evaluate(f, us)\nf_partial_evals","key":"BwkRhMJMLr"},{"type":"output","id":"hYSJ_7rmQhHdYEYfsbDEV","data":[{"name":"stdout","output_type":"stream","text":"rs=[]\nrs=[3, -7, 0, 3]\nrs=[3, -7, 0, 3, 6, -17]\n"},{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"[3, -7, 0, 3, 6, -17, -40]","content_type":"text/plain"}}}],"key":"x64CJpzJ9m"}],"key":"BV1M9U19M9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 0\ni = 0 \n\nf_even = f[::2]\nf_odd = f[1::2]\nprint(f\"P> f = {f}\")\n\n# construct h_i(X) = f_i(r0,r1,...,X,u_{i+1},u_{i+2},...,u_k)\nh_at_0 = f_partial_evals[-3]\nh_at_1 = f_partial_evals[-2]\nh_at_u = f_partial_evals[-1]\nh_at_u_plus_1 = h_at_u + (h_at_1 - h_at_0)\n\nprint(f\"P> h_at_0 = {h_at_0}\")\nprint(f\"P> h_at_1 = {h_at_1}\")\nprint(f\"P> h_at_u = {h_at_u}\")\nprint(f\"P> h_plus_1_at_u = {h_at_u_plus_1}\")\n\nif debug > 0:\n    print(f\"P> check h(0), h(1), h(u), h(u+1)\")\n    partial_f_mle = MLEPolynomial(f, k-i)\n    assert h_at_0 == partial_f_mle.evaluate([Fp(0)]+us[i+1:]), \\\n        f\"h_at_0 = {h_at_0}, partial_f_mle.evaluate([Fp(0)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\"\n    assert h_at_1 == partial_f_mle.evaluate([Fp(1)]+us[i+1:]), \\\n        f\"h_at_1 = {h_at_1}, partial_f_mle.evaluate([Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(1)]+us[i+1:])}\"\n    assert h_at_u == partial_f_mle.evaluate(us[i:]), \\\n        f\"h_at_u = {h_at_u}, partial_f_mle.evaluate(us[i:]) = {partial_f_mle.evaluate(us[i:])}\"\n    assert h_at_u_plus_1 == partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]), \\\n        f\"h_plus_1_at_u = {h_at_u_plus_1}, partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\"\n    # print(f\"P> f(0) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\")\n    # print(f\"P> f(u) = {partial_f_mle.evaluate(us[i:])}\")\n    # print(f\"P> f(u+1) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\")\n    assert h_at_u == sum_checked, \\\n        f\"h_at_u = {h_at_u}, sum_checked = {sum_checked}\"\n    print(f\"P> check h_at_u passed, {h_at_u} = {sum_checked}\")\nsumcheck_h_vec.append(h_at_u)\n\n# tr.absorb(b\"h(X)\", h_eval_at_u_plus_1)\n\n# check sum\n# assert UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)]) == sum_checked, \\\n#     f\"h(us[{i}]) = {UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)])}, sum_checked = {sum_checked}\"\n\n# Receive a random number from the verifier\nr = Fp(-12)\n\nif debug > 0:\n    print(f\"P> r[{i}] = {r}\")\n\n\n# NOTE: The verifier compute f_i(r), which is *equal to* f_{i+1}(u_i). And then in \n#   the next round, the prover will only need to send f_{i+1}(u_i+1) to the verifier.\n#   The computation of f_{i+1}(r) at the verifier's side costs only one multiplication.\nh_at_r = h_at_u + (h_at_u_plus_1 - h_at_u) * (r - us[i])\n\nif debug > 0:\n    print(f\"P> check new sumcheck passed\")\n    assert h_at_r == MLEPolynomial(f, k-i).evaluate([r]+us[i+1:]), \\\n        f\"h_at_r = {h_at_r}, f(r) = {MLEPolynomial(f, k-i).evaluate([r]+us[i+1:])}\"\n    new_sum = UniPolynomial.evaluate_from_evals([h_at_u, h_at_u_plus_1], r, [us[i], us[i]+Fp(1)])\n    assert h_at_r == new_sum\n    print(f\"P> check new sumcheck passed, {h_at_r} = {new_sum}\")\n\n# fold f\n\n# f_folded = [(Fp(1) - r) * f_even[i] + r * f_odd[i] for i in range(half)]\nf_folded = fold(f, r)\n\nf_parital_evals_trimmed = f_partial_evals[:-1]\nf_parital_even = f_parital_evals_trimmed[::2]\nf_parital_odd = f_parital_evals_trimmed[1::2]\nprint(f\"P> f_parital_evals_trimmed = {f_parital_evals_trimmed}\")\nf_parital_evals_folded = fold(f_parital_evals_trimmed, r)\n","key":"tpDxMf2hhD"},{"type":"output","id":"7HqZgnd_iEIEkgo-1f2do","data":[{"name":"stdout","output_type":"stream","text":"P> f = [1, 3, 2, 1, 2, -2, 1, 2]\nP> h_eval_at_0 = 6\nP> h_eval_at_1 = -17\nP> h_eval_at_u = -40\nP> h_eval_at_u_plus_1 = -63\nP> check h(0), h(1), h(u), h(u+1)\nP> check h_eval_at_u passed, -40 = -40\nP> r[0] = -12\nP> check new sumcheck passed\nP> check new sumcheck passed, 89 = 89\nP> f_parital_evals_trimmed = [3, -7, 0, 3, 6, -17]\n"}],"key":"FNVfADKtp7"}],"key":"wsRC9P96lz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# # update parameters for the next round\nsum_checked = h_at_r\nr_vec.append(r)\nf = f_folded\nf_partial_evals = f_parital_evals_folded\n# f_code = f_code_folded\nhalf >>= 1\ncoset *= coset","key":"V186sb4kim"},{"type":"output","id":"PcpblOWkN5sGYignv-Tdw","data":[],"key":"oddSdomOrv"}],"key":"V1o8l3tSu9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"f_partial_evals, half","key":"OksMX36pDr"},{"type":"output","id":"unSKQ3XSOaBg_k_6LrJpE","data":[{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/plain":{"content":"([-70, -36, 89], 2)","content_type":"text/plain"}}}],"key":"phmOWRWwCq"}],"key":"RgUqnC2hY9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 1\ni = 1\n\nf_even = f[::2]\nf_odd = f[1::2]\nprint(f\"P> f = {f}\")\n\n# construct h(X)\nh_eval_at_0 = f_partial_evals[-3]\nh_eval_at_1 = f_partial_evals[-2]\nh_eval_at_u = f_partial_evals[-1]\nh_eval_at_u_plus_1 = h_eval_at_u + (h_eval_at_1 - h_eval_at_0)\n\nprint(f\"P> h_eval_at_0 = {h_eval_at_0}\")\nprint(f\"P> h_eval_at_1 = {h_eval_at_1}\")\nprint(f\"P> h_eval_at_u = {h_eval_at_u}\")\nprint(f\"P> h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}\")\n\nif debug > 0:\n    print(f\"P> check h(0), h(1), h(u), h(u+1)\")\n    partial_f_mle = MLEPolynomial(f, k-i)\n    assert h_eval_at_0 == partial_f_mle.evaluate([Fp(0)]+us[i+1:]), \\\n        f\"h_eval_at_0 = {h_eval_at_0}, partial_f_mle.evaluate([Fp(0)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\"\n    assert h_eval_at_1 == partial_f_mle.evaluate([Fp(1)]+us[i+1:]), \\\n        f\"h_eval_at_1 = {h_eval_at_1}, partial_f_mle.evaluate([Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(1)]+us[i+1:])}\"\n    assert h_eval_at_u == partial_f_mle.evaluate(us[i:]), \\\n        f\"h_eval_at_u = {h_eval_at_u}, partial_f_mle.evaluate(us[i:]) = {partial_f_mle.evaluate(us[i:])}\"\n    assert h_eval_at_u_plus_1 == partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]), \\\n        f\"h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}, partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\"\n    # print(f\"P> f(0) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\")\n    # print(f\"P> f(u) = {partial_f_mle.evaluate(us[i:])}\")\n    # print(f\"P> f(u+1) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\")\n    assert h_eval_at_u == sum_checked, \\\n        f\"h_eval_at_u = {h_eval_at_u}, sum_checked = {sum_checked}\"\n    print(f\"P> check h_eval_at_u passed, {h_eval_at_u} = {sum_checked}\")\nsumcheck_h_vec.append(h_eval_at_u_plus_1)\n\n# tr.absorb(b\"h(X)\", h_eval_at_u_plus_1)\n\n# check sum\n# assert UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)]) == sum_checked, \\\n#     f\"h(us[{i}]) = {UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)])}, sum_checked = {sum_checked}\"\n\n# Receive a random number from the verifier\nr = Fp(-13)\n\nif debug > 0:\n    print(f\"P> r[{i}] = {r}\")\n\nh_eval_at_r = h_eval_at_u + (h_eval_at_u_plus_1 - h_eval_at_u) * (r - us[i])\n\nif debug > 0:\n    print(f\"P> check new sumcheck passed\")\n    assert h_eval_at_r == MLEPolynomial(f, k-i).evaluate([r]+us[i+1:]), \\\n        f\"h_eval_at_r = {h_eval_at_r}, f(r) = {MLEPolynomial(f, k-i).evaluate([r]+us[i+1:])}\"\n    new_sum = UniPolynomial.evaluate_from_evals([h_eval_at_u, h_eval_at_u_plus_1], r, [us[i], us[i]+Fp(1)])\n    assert h_eval_at_r == new_sum\n    print(f\"P> check new sumcheck passed, {h_eval_at_r} = {new_sum}\")\n\n# fold f\n\n# f_folded = [(Fp(1) - r) * f_even[i] + r * f_odd[i] for i in range(half)]\nf_folded = fold(f, r)\n\nf_parital_evals_trimmed = f_partial_evals[:-1]\nf_parital_even = f_parital_evals_trimmed[::2]\nf_parital_odd = f_parital_evals_trimmed[1::2]\nprint(f\"P> f_parital_evals_trimmed = {f_parital_evals_trimmed}\")\nf_parital_evals_folded = fold(f_parital_evals_trimmed, r)\nprint(f\"P> f_parital_evals_folded = {f_parital_evals_folded}\")\n","key":"SVr4BapEy4"},{"type":"output","id":"haa0fB7xDuCgjFUwtlArj","data":[{"name":"stdout","output_type":"stream","text":"P> f = [-23, 14, 50, -11]\nP> h_eval_at_0 = -70\nP> h_eval_at_1 = -36\nP> h_eval_at_u = 89\nP> h_eval_at_u_plus_1 = -70\nP> check h(0), h(1), h(u), h(u+1)\nP> check h_eval_at_u passed, 89 = 89\nP> r[1] = -13\nP> check new sumcheck passed\nP> check new sumcheck passed, 67 = 67\nP> f_parital_evals_trimmed = [-70, -36]\nP> f_parital_evals_folded = [67]\n"}],"key":"PNh5RNdgxN"}],"key":"rUnGV90qtF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# # update parameters for the next round\nsum_checked = h_eval_at_r\nr_vec.append(r)\nf = f_folded\nf_partial_evals = f_parital_evals_folded\n# f_code = f_code_folded\nhalf >>= 1\ncoset *= coset","key":"VBNIBrsHXb"},{"type":"output","id":"B9UAulP0dUurL3h5cJP3c","data":[],"key":"MCZP6z20yF"}],"key":"kIJ8Zg24zA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# Sumcheck Round 2 (final round)\ni = 2\n\nf_even = f[::2]\nf_odd = f[1::2]\nprint(f\"P> f = {f}\")\n\n# construct h(X)\nh_eval_at_0 = f_partial_evals[0]\nh_eval_at_1 = f_partial_evals[0]\nh_eval_at_u = f_partial_evals[0]\nh_eval_at_u_plus_1 = h_eval_at_u + (h_eval_at_1 - h_eval_at_0)\n\nprint(f\"P> h_eval_at_0 = {h_eval_at_0}\")\nprint(f\"P> h_eval_at_1 = {h_eval_at_1}\")\nprint(f\"P> h_eval_at_u = {h_eval_at_u}\")\nprint(f\"P> h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}\")\n\nif debug > 0:\n    print(f\"P> check h(0), h(1), h(u), h(u+1)\")\n    partial_f_mle = MLEPolynomial(f, k-i)\n    assert h_eval_at_0 == partial_f_mle.evaluate([Fp(0)]+us[i+1:]), \\\n        f\"h_eval_at_0 = {h_eval_at_0}, partial_f_mle.evaluate([Fp(0)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\"\n    assert h_eval_at_1 == partial_f_mle.evaluate([Fp(1)]+us[i+1:]), \\\n        f\"h_eval_at_1 = {h_eval_at_1}, partial_f_mle.evaluate([Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(1)]+us[i+1:])}\"\n    assert h_eval_at_u == partial_f_mle.evaluate(us[i:]), \\\n        f\"h_eval_at_u = {h_eval_at_u}, partial_f_mle.evaluate(us[i:]) = {partial_f_mle.evaluate(us[i:])}\"\n    assert h_eval_at_u_plus_1 == partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]), \\\n        f\"h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}, partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\"\n    # print(f\"P> f(0) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\")\n    # print(f\"P> f(u) = {partial_f_mle.evaluate(us[i:])}\")\n    # print(f\"P> f(u+1) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\")\n    assert h_eval_at_u == sum_checked, \\\n        f\"h_eval_at_u = {h_eval_at_u}, sum_checked = {sum_checked}\"\n    print(f\"P> check h_eval_at_u passed, {h_eval_at_u} = {sum_checked}\")\nsumcheck_h_vec.append(h_eval_at_u_plus_1)\n\n# tr.absorb(b\"h(X)\", h_eval_at_u_plus_1)\n\n# check sum\n# assert UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)]) == sum_checked, \\\n#     f\"h(us[{i}]) = {UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)])}, sum_checked = {sum_checked}\"\n\n# Receive a random number from the verifier\nr = Fp(-13)\n\nif debug > 0:\n    print(f\"P> r[{i}] = {r}\")\n\n# NOTE: The verifier compute f_i(r), which is *equal to* f_{i+1}(u_i). And then in \n#   the next round, the prover will only need to send f_{i+1}(u_i+1) to the verifier.\nh_eval_at_r = h_eval_at_u + (h_eval_at_u_plus_1 - h_eval_at_u) * (r - us[i])\n\nif debug > 0:\n    print(f\"P> check new sumcheck passed\")\n    assert h_eval_at_r == MLEPolynomial(f, k-i).evaluate([r]+us[i+1:]), \\\n        f\"h_eval_at_r = {h_eval_at_r}, f(r) = {MLEPolynomial(f, k-i).evaluate([r]+us[i+1:])}\"\n    new_sum = UniPolynomial.evaluate_from_evals([h_eval_at_u, h_eval_at_u_plus_1], r, [us[i], us[i]+Fp(1)])\n    assert h_eval_at_r == new_sum\n    print(f\"P> check new sumcheck passed, {h_eval_at_r} = {new_sum}\")\n\n# fold f\n\n# f_folded = [(Fp(1) - r) * f_even[i] + r * f_odd[i] for i in range(half)]\nf_folded = fold(f, r)\n\nf_parital_evals_trimmed = f_partial_evals[:-1]\nf_parital_even = f_parital_evals_trimmed[::2]\nf_parital_odd = f_parital_evals_trimmed[1::2]\nprint(f\"P> f_parital_evals_trimmed = {f_parital_evals_trimmed}\")\nf_parital_evals_folded = fold(f_parital_evals_trimmed, r)\nprint(f\"P> f_parital_evals_folded = {f_parital_evals_folded}\")\n","key":"sy96o7kvWd"},{"type":"output","id":"Ptid01XT8aN9T9GQ6c135","data":[],"key":"q0XIzvQ1Ep"}],"key":"aa8D3uV9yh"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"# # Sumcheck Round 1\n# i = 0 \n\n# f_even = f[::2]\n# f_odd = f[1::2]\n# print(f\"P> f = {f}\")\n\n# # construct h(X)\n# h_eval_at_0 = MLEPolynomial(f_even, k-i-1).evaluate(us[i+1:])\n# h_eval_at_1 = MLEPolynomial(f_odd, k-i-1).evaluate(us[i+1:])\n# h_eval_at_u = (Fp(1) - us[i]) * h_eval_at_0 + us[i] * h_eval_at_1\n# h_eval_at_u_plus_1 = h_eval_at_u + (h_eval_at_1 - h_eval_at_0)\n\n# print(f\"P> h_eval_at_0 = {h_eval_at_0}\")\n# print(f\"P> h_eval_at_1 = {h_eval_at_1}\")\n# print(f\"P> h_eval_at_u = {h_eval_at_u}\")\n# print(f\"P> h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}\")\n\n# if debug > 0:\n#     print(f\"P> check h(0), h(1), h(u), h(u+1)\")\n#     partial_f_mle = MLEPolynomial(f, k-i)\n#     assert h_eval_at_0 == partial_f_mle.evaluate([Fp(0)]+us[i+1:]), \\\n#         f\"h_eval_at_0 = {h_eval_at_0}, partial_f_mle.evaluate([Fp(0)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\"\n#     assert h_eval_at_1 == partial_f_mle.evaluate([Fp(1)]+us[i+1:]), \\\n#         f\"h_eval_at_1 = {h_eval_at_1}, partial_f_mle.evaluate([Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([Fp(1)]+us[i+1:])}\"\n#     assert h_eval_at_u == partial_f_mle.evaluate(us[i:]), \\\n#         f\"h_eval_at_u = {h_eval_at_u}, partial_f_mle.evaluate(us[i:]) = {partial_f_mle.evaluate(us[i:])}\"\n#     assert h_eval_at_u_plus_1 == partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]), \\\n#         f\"h_eval_at_u_plus_1 = {h_eval_at_u_plus_1}, partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:]) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\"\n#     # print(f\"P> f(0) = {partial_f_mle.evaluate([Fp(0)]+us[i+1:])}\")\n#     # print(f\"P> f(u) = {partial_f_mle.evaluate(us[i:])}\")\n#     # print(f\"P> f(u+1) = {partial_f_mle.evaluate([us[i]+Fp(1)]+us[i+1:])}\")\n#     assert h_eval_at_u == sum_checked, \\\n#         f\"h_eval_at_u = {h_eval_at_u}, sum_checked = {sum_checked}\"\n#     print(f\"P> check h_eval_at_u passed, {h_eval_at_u} = {sum_checked}\")\n# sumcheck_h_vec.append(h_eval_at_u_plus_1)\n\n# # tr.absorb(b\"h(X)\", h_eval_at_u_plus_1)\n\n# # check sum\n# # assert UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)]) == sum_checked, \\\n# #     f\"h(us[{i}]) = {UniPolynomial.evaluate_from_evals(h, us[i], [Field(0), Field(1)])}, sum_checked = {sum_checked}\"\n\n# # Receive a random number from the verifier\n# r = Fp(-12)\n\n# if debug > 0:\n#     print(f\"P> r[{i}] = {r}\")\n\n# h_eval_at_r = h_eval_at_u + (h_eval_at_u_plus_1 - h_eval_at_u) * (r - us[i])\n\n# if debug > 0:\n#     print(f\"P> check new sumcheck passed\")\n#     assert h_eval_at_r == MLEPolynomial(f, k-i).evaluate([r]+us[i+1:]), \\\n#         f\"h_eval_at_r = {h_eval_at_r}, f(r) = {MLEPolynomial(f, k-i).evaluate([r]+us[i+1:])}\"\n#     new_sum = UniPolynomial.evaluate_from_evals([h_eval_at_u, h_eval_at_u_plus_1], r, [us[i], us[i]+Fp(1)])\n#     assert h_eval_at_r == new_sum\n#     print(f\"P> check new sumcheck passed, {h_eval_at_r} = {new_sum}\")\n\n# # fold f\n\n# f_folded = [(Fp(1) - r) * f_even[i] + r * f_odd[i] for i in range(half)]\n","key":"rDKh7PeHNu"},{"type":"output","id":"ZUhQUnaoVCrPdaqCHmjTg","data":[],"key":"Kmw5FcFD9E"}],"key":"gcuE5Odc3D"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"sage","executable":true,"value":"","key":"qedA79RO47"},{"type":"output","id":"9EZ7qz5P27uwnLTJKNZj3","data":[],"key":"bWZnHAiqG7"}],"key":"DDIu4MZ2jP"}],"key":"t7uGCzghud"},"references":{"cite":{"order":[],"data":{}}}}